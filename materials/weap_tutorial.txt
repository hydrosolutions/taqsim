
============================================================
PAGE 1
============================================================

 
 
WEAP 
Water Evaluation And Planning System 
 
Tutorial  
 
A collection of stand-alone modules to aid in learning  
the WEAP software 
 
 
 
 
 
 
 
 
October 2023 
 
 
 
 


============================================================
PAGE 2
============================================================

 2 
 
Tutorial Overview 
October 2023 
 
 
WEAP Tutorial 
 
WEAP 
Water Evaluation And Planning System 
 
Tutorial Modules 
Tutorial Overview ....................................................... 3 
WEAP in One Hour................................................ 15 
Basic Tools................................................................ 41 
Scenarios ................................................................... 51 
Refining the Demand Analysis ............................... 73 
Refining the Supply ................................................. 93 
Data, Results and Formatting ............................... 115 
Reservoirs and Power Production ....................... 135 
Water Quality ......................................................... 147 
Linking WEAP to QUAL2K ............................... 169 
Hydrology ............................................................... 177 
Catchment Calibration .......................................... 201 
Snow Hydrology .................................................... 255 
Glaciers .................................................................... 271 
Financial Analysis ................................................... 287 
Linking WEAP to MODFLOW .......................... 299 
Linking WEAP to LEAP ...................................... 353 
 
 


============================================================
PAGE 3
============================================================

 
 
WEAP 
Water Evaluation And Planning System 
 
Tutorial Overview 
 
Introduction ............................................................... 4 
Background ............................................................... 4 
WEAP Development ................................................ 5 
The WEAP Approach ............................................. 5 
Program Structure ...................................................... 6 
The Tutorial Structure ............................................... 9 
 
October 2023 
 
 
 
 
 
 
 


============================================================
PAGE 4
============================================================

 4 
 
Tutorial Overview 
October 2023 
 
 
WEAP Tutorial 
Introduction 
WEAP© is a microcomputer tool for integrated water resources planning. It 
provides a comprehensive, flexible and user-friendly framework for policy analysis. 
A growing number of water professionals are finding WEAP to be a useful 
addition to their toolbox of models, databases, spreadsheets and other software.  
This overview summarizes WEAP’s purpose, approach and structure. The 
contents of the WEAP tutorial are also introduced; the tutorial is constructed 
as a series of modules that takes you through all aspects of WEAP modeling 
capabilities. Although the tutorial itself is built on very simple examples, it 
covers most aspects of WEAP. A more complex model presenting those 
aspects in the context of a real situation is included with WEAP under the 
name “Weeping River Basin.” A detailed technical description is also available 
in a separate publication, the WEAP User Guide. 
Background 
Many regions are facing formidable freshwater management challenges. 
Allocation of limited water resources, environmental quality, and policies for 
sustainable water use are issues of increasing concern. Conventional supply-
oriented simulation models are not always adequate. Over the last decade, an 
integrated approach to water development has emerged that places water supply 
projects in the context of demand-side issues, water quality and ecosystem 
preservation. 
WEAP aims to incorporate these values into a practical tool for water resources 
planning. WEAP is distinguished by its integrated approach to simulating water 
systems and by its policy orientation. WEAP places the demand side of the 
equation—water use patterns, equipment efficiencies, re-use, prices and 
allocation—on an equal footing with the supply side—streamflow, 
groundwater, reservoirs and water transfers. WEAP is a laboratory for 
examining alternative water development and management strategies. 
WEAP is comprehensive, straightforward, and easy-to-use, and attempts to 
assist rather than substitute for the skilled planner. As a database, WEAP 
provides a system for maintaining water demand and supply information. As a 
forecasting tool, WEAP simulates water demand, supply, flows, and storage, 
and pollution generation, treatment and discharge. As a policy analysis tool, 
WEAP evaluates a full range of water development and management options 
and takes account of multiple and competing uses of water systems. 


============================================================
PAGE 5
============================================================

WEAP Development 
 5 
Stockholm Environment Institute 
 
October 2023 
WEAP Development 
The Stockholm Environment Institute provided primary support for the 
development of WEAP. The Hydrologic Engineering Center of the US Army 
Corps of Engineers funded significant enhancements. A number of agencies, 
including the World Bank, USAID and the Global Infrastructure Fund of Japan 
have provided project support. WEAP has been applied in water assessments 
in over one hundred countries. 
The WEAP Approach 
Operating on the basic principle of a water balance, WEAP is applicable to 
municipal and agricultural systems, single catchments or complex 
transboundary river systems. Moreover, WEAP can address a wide range of 
issues, e.g., sectoral demand analyses, water conservation, water rights and 
allocation priorities, groundwater and streamflow simulations, reservoir 
operations, hydropower generation, pollution tracking, ecosystem requirements, 
vulnerability assessments, and project benefit-cost analyses. 
The analyst represents the system in terms of its various supply sources (e.g., 
rivers, creeks, groundwater, reservoirs, and desalination plants); withdrawal, 
transmission, and wastewater treatment facilities; water demands and ecosystem 
requirements; and pollution generation. The data structure and level of detail 
may be easily customized to meet the requirements of a particular analysis, and 
to reflect the limits imposed by restricted data. 
WEAP applications generally include several steps. The study definition sets up 
the time frame, spatial boundary, system components and configuration of the 
problem. The Current Accounts, which can be viewed as a calibration step in the 
development of an application, provide a snapshot of actual water demand, 
pollution loads, resources and supplies for the system. Key assumptions may be 
built into the Current Accounts to represent policies, costs and factors that 
affect demand, pollution, supply and hydrology. Scenarios build on the Current 
Accounts and allow one to explore the impact of alternative assumptions or 
policies on future water availability and use. Finally, the scenarios are evaluated 
with regard to water sufficiency, costs and benefits, compatibility with 
environmental targets, and sensitivity to uncertainty in key variables. 


============================================================
PAGE 6
============================================================

 6 
 
Tutorial Overview 
October 2023 
 
 
WEAP Tutorial 
Program Structure 
WEAP consists of five main views: Schematic, Data, Results, Scenario Explorer 
and Notes. These five views are presented below. 
Schematic:  
This view contains GIS-based tools for easy configuration of your system. 
Objects (e.g., demand nodes, reservoirs) can be created and positioned within 
the system by dragging and dropping items from a menu. ArcView or other 
standard GIS vector or raster files can be added as background layers. You can 
quickly access data and results for any node by clicking on the object of interest. 
 


============================================================
PAGE 7
============================================================

Program Structure 
 7 
Stockholm Environment Institute 
 
October 2023 
Data:  
The Data view allows you to create variables and relationships, enter 
assumptions and projections using mathematical expressions, and dynamically 
link to Excel.  
 
Results:  
The Results view allows detailed and flexible display of all model outputs, in 
charts and tables, and on the Schematic.  
 


============================================================
PAGE 8
============================================================

 8 
 
Tutorial Overview 
October 2023 
 
 
WEAP Tutorial 
 
Scenario Explorer:  
You can highlight key data and results in your system for quick viewing. 
 
Notes:  
The Notes view provides a place to document your data and assumptions.  


============================================================
PAGE 9
============================================================

The Tutorial Structure 
 9 
Stockholm Environment Institute 
 
October 2023 
 
The Tutorial Structure 
This complete tutorial guides you through the wide range of applications that 
can be covered with WEAP. The first three modules (WEAP in One Hour, 
Basic Tools, and Scenarios) present the essential elements needed for any 
WEAP modeling effort. The other modules present refinements that may or 
may not apply to your situation. 
Aside from the three basic modules, the tutorial modules can be completed 
in any order and independently, as you see fit. They all start with the same 
model that you will create after completing the first three modules.  
Below is a list of all modules, starting with the three basic modules; the 
bulleted points indicate the aspects covered in each module.  
WEAP in One Hour 
 
Creating a New, Blank Study Area 
 
Setting General Parameters 
 
Entering Elements into the Schematic 
 
Getting First Results 
Basic Tools 
 
Creating and Using Key Assumptions 


============================================================
PAGE 10
============================================================

 10 
 
Tutorial Overview 
October 2023 
 
 
WEAP Tutorial 
 
Using the Expression Builder 
Scenarios 
 
Preparing the Ground for Scenarios 
 
Creating the Reference Scenario 
 
Creating and Running Scenarios 
 
Using the Water Year Method 
Refining the Demand Analysis 
 
Disaggregating Demand 
 
Modeling Demand Side Management, Losses and Reuse 
 
Setting Demand Allocation Priorities 
Refining the Supply 
 
Changing Supply Priorities 
 
Modeling Reservoir Supply 
 
Adding Flow Requirements 
 
Modeling Groundwater Resources 
Data, Results and Formatting 
 
Exchanging Data 
 
Importing Time Series 
 
Working with Results 
 
Formatting 
Reservoirs and Power Production 
 
Modeling Reservoir Operation 
 
Adding Hydropower Computation 


============================================================
PAGE 11
============================================================

The Tutorial Structure 
 11 
Stockholm Environment Institute 
 
October 2023 
 
Modeling Run-of-River Power Plants 
Water Quality 
 
Setting up Quality Modeling 
 
Entering Water Quality Data 
 
Using Water Quality Inflow Constraints for a Demand Site 
 
Entering Pollution Generating Activity for Demand Sites 
 
Modeling a Wastewater Treatment Plant 
Linking WEAP to QUAL2K 
 
Linking to QUAL2K 
 
Running Scenarios 
Hydrology 
 
Modeling Catchments: The Simplified Coefficient Method 
 
Understanding the Soil Moisture Method 
 
Modeling Catchments: The Soil Moisture Method 
 
Simulating Surface Water-Groundwater Interaction 
Catchment Calibration 
 
Gather Observed Data and Select the Model Calibration 
Locations 
 
Complete Observed Data and Select the Model Calibration 
Period 
 
Visually Assess Model Calibration 
 
Adjust key parameters and conduct model sensitivity analysis 
 
Optimize calibration based on visual and statistical assessment 
 
Model Calibration Tips 


============================================================
PAGE 12
============================================================

 12 
 
Tutorial Overview 
October 2023 
 
 
WEAP Tutorial 
Snow Hydrology 
 
Explore the Pre-Existing Model 
 
Enter Catchment Climate and Calibration Data 
 
Explore the Model Sensitivity 
 
Calibrate with PEST 
 
Appendix 
Glaciers 
 
Modeling a Glacier 
 
Enter Catchment Climate 
 
Effect of Cooling Temperatures 
 
Effect of Warming Temperatures 
 
Parameter Sensitivity (Radiation Coefficient) 
Financial Analysis 
 
Setting up the Cost and Benefit Model 
 
Modeling Cost 
 
Modeling Benefits 
Linking WEAP to MODFLOW 
 
Linking to MODFLOW 
 
Running MODFLOW and Viewing Results 
 
Scenario: Increased Population 
 
Scenario: Irrigation 
 
Scenario: Artificial Recharge 


============================================================
PAGE 13
============================================================

The Tutorial Structure 
 13 
Stockholm Environment Institute 
 
October 2023 
Linking WEAP to LEAP 
 
Linking WEAP and LEAP 
 
Scenario: Hydropower Generation from WEAP 
 
Scenario: Demand for Cooling Water from LEAP 
 
Scenario: Electricity Demand from WEAP 
 


============================================================
PAGE 14
============================================================



============================================================
PAGE 15
============================================================

 
 
WEAP 
Water Evaluation And Planning System 
 
WEAP in One Hour 
 
A TUTORIAL ON 
Creating a New, Blank Study Area ......................... 16 
Setting General Parameters ...................................... 20 
Entering Elements into the Schematic ....................... 23 
Getting First Results ................................................ 37 
 
October 2023 
 
 
 
 
 
 


============================================================
PAGE 16
============================================================

 16 
 
WEAP in One Hour 
October 2023 
 
 
WEAP Tutorial 
Creating a New, Blank Study Area 
1.   Establish a New, Blank Area  
You are now going to practice creating a new, blank area. When you open 
WEAP for the first time, a project area called “Weaping River Basin” will 
appear.  Use the Area, Create Area menu option to make a new, blank area. 
 
A window, as shown below, will appear in which you should click on the 
“Initially Blank” option.  In the next steps, you will be defining this area for 
a specific geographic area of the world - so you can name the area based on 
this selection if you like (e.g., My Ghana Area). You can also save it as another 
version of model under construction, in the event you wanted multiple 
versions. Note that you can choose whether to have it password protected.  
 
After clicking “OK” you may be prompted to save changes to the Weaping 
River Basin. After clicking yes or no, you will get the following screen: 


============================================================
PAGE 17
============================================================

Creating a New, Blank Study Area 
 17 
Stockholm Environment Institute 
 
October 2023 
 
Click “OK” again. In the next screen, you will select the geographic area for 
your project from the world map that appears. Use your cursor to draw a 
rectangle around the area that your project will represent. The boundaries will 
appear as a green rectangle. 
 
You can then use the slider bar on the lower left of the window to zoom into 
this selected area. 


============================================================
PAGE 18
============================================================

 18 
 
WEAP in One Hour 
October 2023 
 
 
WEAP Tutorial 
 
You can redraw your green rectangle to best capture the area you want in this 
view. Click on “OK” when you are satisfied with your area boundaries. Note 
that you can modify these boundaries later by choosing “Set Area Boundaries” 
on the pull-down menu under Schematic on the top menu bar. 
 


============================================================
PAGE 19
============================================================

Creating a New, Blank Study Area 
 19 
Stockholm Environment Institute 
 
October 2023 
2.   Add a GIS layer to the Area 
You can add GIS-based Raster and Vector maps to your project area - these 
maps can help you to orient and construct your system and refine area 
boundaries. To add a Raster or Vector layer, right click in the middle window 
to the left of the Schematic and select “Add a Raster Layer” or “Add a Vector 
Layer.”   
 
A window will appear in which you can input the name of this file and where 
WEAP can find it on your computer or on the internet.  For now, close the 
window by pressing the “Cancel” button.  
 
Background vector data can be added by clicking “Add Vector Layer.” WEAP reads vector 
information in the SHAPEFILE format. This format can be created by most GIS software.  
A large amount of georeferenced data (both in vector and raster format) is available on the 
Internet, sometimes for free. Beware that some of the downloadable data might need GIS 
processing before being usable in WEAP, especially to adapt the projection and/or 
coordinate system. 
 
In WEAP, models are called “areas.”    
Areas are limited by boundaries, which define the extent of the project area. If you create a 
new area by copying an existing one, the boundary is kept identical to that of the existing 
area. To modify boundaries once you have established a New Area, go to Schematic on the 
menu, and choose “Set Area Boundaries.” 
Note that if you want to start with a “blank” area, you can use the steps above to select a 
geographic area over one of the oceans instead of a land mass. 


============================================================
PAGE 20
============================================================

 20 
 
WEAP in One Hour 
October 2023 
 
 
WEAP Tutorial 
3.   Saving an Area 
If you want to save this Area for your own use later, Use the “Area”, “Save…” 
menu or press Ctrl+S. 
 
Setting General Parameters 
We are now going to proceed with learning how to navigate through WEAP 
and its functionalities. For the remaining exercises in this tutorial, we will be 
using a pre-defined Area called “Tutorial.”  
To open this Area, on the Main Menu, go to Area and select “Open.” You 
should see a list of Areas that includes “Tutorial”. Select this Area.  You 
should now see the Schematic as shown below—with blue lines for rivers and 
a yellow polygon for the city.   


============================================================
PAGE 21
============================================================

Setting General Parameters 
 21 
Stockholm Environment Institute 
 
October 2023 
 
If you do not see this, go to the Area Menu, select “Revert to Version” and 
choose the version named “Starting Point for ‘WEAP in One Hour’ module” 
(it will have a date and time before the title). 
4.   Set the General Parameters 
Once the Area opens, use the “General” menu to set Years and Time Steps.  
Set the Current Accounts Year to 2000 and the Last Year of Scenarios to 2005.  
Set the Time Steps per year to 12.  Set the Time Step Boundary to “Based on 
calendar month” and starting in January (see below) Keep the default (SI units) for 
now. 


============================================================
PAGE 22
============================================================

 22 
 
WEAP in One Hour 
October 2023 
 
 
WEAP Tutorial 
 
Under “General”, the units also be set. We will leave them in the default (SI 
units) for now. 
 
The year 2000 will serve as the “Current Accounts” year for this project. The Current 
Accounts year is chosen to serve as the base year for the model, and all system information 
(e.g., demand, supply data) is input into the Current Accounts.  The Current Accounts is the 
dataset from which scenarios are built. Scenarios explore possible changes to the system in 
future years after the Current Accounts year. A default scenario, the “Reference Scenario” 
carries forward the Current Accounts data into the entire project period specified (here, 2000 
to 2005) and serves as a point of comparison for other scenarios in which changes may be 
made to the system data. There will be a more detailed discussion of scenarios in an 
upcoming module.  
 
 
The time steps should be chosen to reflect the level of precision of the data available. A 
shorter time step will increase the calculation time, especially when several scenarios have to 
be calculated.  
5.   Save a version of your Area 
Select “Save Version” under the “Area” menu. A window will appear asking 
for a comment to describe this version. Type “general parameters set.” 


============================================================
PAGE 23
============================================================

Entering Elements into the Schematic 
 23 
Stockholm Environment Institute 
 
October 2023 
 
Entering Elements into the Schematic 
6.   Draw a River 
Click on the “River” symbol in the Element window and hold the click as you 
drag the symbol over to the map. Release the click when you have positioned 
the cursor over the upper left starting point of the main section of the river.  
Move the cursor, and you will notice a line being generated from that starting 
point.  
 
As with any other program, it is usually a good idea to regularly save your work in WEAP.  
WEAP manages all the files pertaining to an area for you. Saving a new area will 
automatically save the related files. The files are saved in the WEAP program installation 
folder. You can manage the areas, export and import them, back them up and send them per 
email using the Area…, Manage Areas menu. 
WEAP also has a very convenient versioning feature that allow saving versions of a model 
within the same area. Use the “Area”, “Save Version…:” menu to save a version, and the 
“Area”, “Revert to Version” to switch to another version. You can switch between recent and 
older versions without losing data. WEAP will automatically create versions of your model 
every time you save. It is however better to manually create a version of a status you really 
want to keep since WEAP will eventually delete old automatic versions to save disk space, 
keeping only a few.   


============================================================
PAGE 24
============================================================

 24 
 
WEAP in One Hour 
October 2023 
 
 
WEAP Tutorial 
 
 
Follow the main river, drawing from the upstream (upper left) to the downstream 
(lower right), clicking once to end each segment that you draw. You can follow the 
line of the river as closely as you like, or you can draw a less detailed representation 
(below). Note though, that how closely you follow the actual course of the river will 
have implications for the performance of certain functionalities in WEAP. For 
example, if you plan to model water quality parameters along the river, it would be 
advantageous to construct the river element as closely as possible to the actual river 
course, because WEAP will need to calculate residence times in the river (a function 
of reach lengths) to perform water quality simulations. Zooming in on the river 
(using the zooming bar in the lower schematic window) can help if you want to 
follow the rivers path more closely. You do not need to draw a river on the branch 
coming horizontally from the left. You can also adjust the river later if you want to 
add more detail.  
 
The direction of drawing matters: the first point you draw will be the head of the river from 
where water will flow. You can edit the river course later on by simply clicking-moving any 
part of the river to create a new point, or right-clicking any point to delete it.  


============================================================
PAGE 25
============================================================

Entering Elements into the Schematic 
 25 
Stockholm Environment Institute 
 
October 2023 
 
When you double click to finish drawing the river, a dialog box appears for 
naming the river (see below).   
Name the river “Main River.”  
 
You may also enter an optional label for the schematic presentation (a shorter 
label can help to keep the schematic from becoming cluttered). 
You can move the river label to another location by right clicking anywhere 
on the river and selecting “Move Label.”  The label will follow the cursor  -
single click when the label is in the desired location. 


============================================================
PAGE 26
============================================================

 26 
 
WEAP in One Hour 
October 2023 
 
 
WEAP Tutorial 
 
7.   Enter Data for the Main River 
There are two ways to navigate to the data entry section of WEAP to enter 
data for the Main River.  
Right-click on the Main River and select Edit data and any item in the list. 
Switch to the Data view by clicking on the Data symbol on the left of the 
main screen. Select: Supply and Resources/ River /Main River in the Data tree.  
You may have to click on the “plus sign” icon beside the Supply and 
Resources branch in order to view all of the additional branches below it in 
the tree.  
 


============================================================
PAGE 27
============================================================

Entering Elements into the Schematic 
 27 
Stockholm Environment Institute 
 
October 2023 
Alternatively, you can use the Tree pull-down menu and select “Expand 
All” to view all branches. 
  
 
The “Inflows and Outflows” window should be open - if it isn't, click on the 
appropriate button. Click on the “Headflow” tab. Click on the area just 
beneath the bar labeled “2000” in the data input window to view a pull-down 
menu icon.  Select the “Monthly Time-Series Wizard” from the drop--down 
menu. 


============================================================
PAGE 28
============================================================

 28 
 
WEAP in One Hour 
October 2023 
 
 
WEAP Tutorial 
 
 
Use the Monthly Time Series Wizard to enter the following data series: 
MonthFlow (CMS)  
Jan 
12 
Feb 
7 
Mar 
11 
Apr 
17 
May 
80 
Jun 
136 
Jul 
45 
Aug 
32 
Sep 
38 
Oct 
18 
Nov 
9 
Dec 
7 
Note that as you enter each data point, the data is shown graphically also. Do 
not input or change any other data yet. Push Finish to close the wizard. 
 
 
WEAP divides up rivers into reaches (segments). Originally your river has only one reach; as 
you add withdrawal and return points, WEAP will automatically create new reaches.  


============================================================
PAGE 29
============================================================

Entering Elements into the Schematic 
 29 
Stockholm Environment Institute 
 
October 2023 
8.   Create an Urban Demand Site and Enter the Related Data 
Creating a demand node is similar to the process you used to create a river.  
Return to the Schematic view and pull a demand node symbol onto the 
schematic from the Element window, releasing the click when you have 
positioned the node on the left bank of the river (facing downstream) in the 
yellow area that marks the city’s extent.   
 
Enter the name of this demand node as “Big City” in the dialog box, and set the 
demand priority to 1. 
 
Right click on the Big City demand site and select “Edit data” and “Annual 
Activity Level.” This is the alternative way to edit data, rather than clicking 
on the “Data” view icon on the side bar menu and searching through the data 
tree. 
 
The Demand Priority represents the level of priority for allocation of constrained resources 
among multiple demand sites. WEAP will attempt to supply all demand sites with highest 
Demand Priority (1), moving to progressively lower priority sites until all of the demand is 
met or all of the resources are used—whichever happens first. 


============================================================
PAGE 30
============================================================

 30 
 
WEAP in One Hour 
October 2023 
 
 
WEAP Tutorial 
 
You must first select the units before entering data. Click on the “N/A” 
under Unit in the Annual Activity level tab. Pull down the arrow that 
appears, select “People”, and click “OK.” 
 
In the space under the field labeled “2000”, enter the Annual Activity Level as 
800,000. 


============================================================
PAGE 31
============================================================

Entering Elements into the Schematic 
 31 
Stockholm Environment Institute 
 
October 2023 
 
Next, click on the “Annual Water Use Rate” tab and enter 300 under the year 
2000. 
 
 
The monthly variation is expressed as a percentage of the yearly value.  The values for all of 
the months have to sum to 100% over the full year. If you don’t specify monthly variation, 
WEAP will prescribe a monthly variation based on the number of days in each month.  
We will not edit these values for the city demand, but we will edit them later for the 
agricultural demand. 
Finally, click on the “Consumption” tab and enter 15. Note that the units are pre-set 
to “percent.” 


============================================================
PAGE 32
============================================================

 32 
 
WEAP in One Hour 
October 2023 
 
 
WEAP Tutorial 
9.   Create an Agriculture Demand Site 
Pull another demand node symbol into the project area and position it on the 
other side of the Main River opposite and downstream of Big City. 
 Name this demand node “Agriculture” and set the demand priority to 1.  
 
 
Consumption represents the amount of water that is actually consumed (i.e. is not returned 
in the form of wastewater). 
 
 
In the same manner as for Big City, enter the Annual Activity Level and 
Annual Water Use Rate in the Data View for the Agriculture demand site 
after first selecting “hectares” as the units (you may have to click on the “plus” 
sign to the left in the tree in order to see all of the options for area units). 
 
Annual Activity Level 
100,000 hectares 
Annual Water Use rate 
3,500 m3/hectare 


============================================================
PAGE 33
============================================================

Entering Elements into the Schematic 
 33 
Stockholm Environment Institute 
 
October 2023 
 
Select the Monthly Variation tab and the Monthly Time Series Wizard to 
enter the data below for the monthly variation in the water use rate. 
Monthly Variation:  
- 5% in April 
- 10% in May and June 
- 20% in July 
- 30% in August 
- 25% in September 
- 0% for the rest of the year 
 


============================================================
PAGE 34
============================================================

 34 
 
WEAP in One Hour 
October 2023 
 
 
WEAP Tutorial 
Finally, click on the Consumption tab and enter 90. 
 
You could have created one single demand site integrating both urban and agriculture 
demand. However, we will see later that this removes some of the flexibility in the water 
supply priorities allocation.  
10.   
Connect the Demand with a Supply 
You now need to tell WEAP how demand is satisfied; this is accomplished 
by connecting a supply resource to each demand site. Return to the Schematic 
view and create a Transmission Link from the Main River to Big City and to 
Agriculture.  Do this by dragging the Transmission Link first to a position on 
the river, releasing the click, then pulling the link to Big City and double 
clicking on this demand node. Do the same for Agriculture, but start the 
Transmission Link downstream of the one created for Big City. 
 Select a Supply Preference of 1 for each Transmission Link. 
 
11.   
Create Return Flow Links 
 
 
The Supply Preference parameter allows you to define which source should be used in 
priority to supply water to this Demand Site. WEAP will attempt to supply all of the demand 
with sources having the highest preference level (1), only using lower-level sources if the 
high-level sources do not have sufficient supply.  


============================================================
PAGE 35
============================================================

Entering Elements into the Schematic 
 35 
Stockholm Environment Institute 
 
October 2023 
Now create a Return Flow from Big City to the Main River. Do the same for 
Agriculture to the Main River. Follow the same “drag and release” procedure 
as for the Transmission Links. 
 The return flow for the urban demand site should be positioned downstream of the 
agriculture withdrawal point. In the flow direction, the sequence should be: withdrawal 
for Big City, withdrawal for Agriculture, return from Big City, return from Agriculture.  
 
Next, set the Return Flow Routing for the Big City Return Flow. Do this by 
right-clicking on each Return Flow and selecting “edit data” and “Return 
Flow Routing” or by going to the Data view\Supply and Resources\Return 
Flows\from Big City.  
Set the Return Flow Routing to 100%. 
Do the same for the Agriculture Return Flow. 
 
Return Flow Routing is the percent of total outflow from a demand site that is directed 
through a Return Flow Link.  If only one Return Flow Link is created for a demand node, 
then the Return Flow Routing for that link must be 100%.  Likewise, if multiple Return Flow 
links are created for a demand node, then Routing factors for all of the links must sum to 
100%. Losses within the Return Flow Links are specified separately. 


============================================================
PAGE 36
============================================================

 36 
 
WEAP in One Hour 
October 2023 
 
 
WEAP Tutorial 
 
12.   
Check your Model 
At this point, your model should look similar to the figure below.  
 


============================================================
PAGE 37
============================================================

Getting First Results 
 37 
Stockholm Environment Institute 
 
October 2023 
Getting First Results 
13.   
Run the Model 
Click on the “Results” view to start the computation. When asked whether 
to recalculate, click yes. This will compute the entire model for the Reference 
Scenario - the default scenario that is generated using Current Accounts 
information for the period of time specified for the project (here, 2000 to 
2005). When the computation is complete, the Results view will appear. 
 
14.   
Check your Results 
Click on the “Table” tab and select “Demand” and “Water Demand” from 
the primary variable pull-down menu in the upper center of the window (see 
below).   
 
Also, click the “Annual Total” Box. 


============================================================
PAGE 38
============================================================

 38 
 
WEAP in One Hour 
October 2023 
 
 
WEAP Tutorial 
If you have entered all data as listed in previous steps, you should obtain the 
following annual demand values for each year (2000 to 2005) of the Reference 
scenario: 
Annual Demand for Agriculture 
 
350 M m3 
Annual Demand for Urban Area  
240 M m3 
 
15.   
Look at Additional Results 
Now, look at the monthly Demand Coverage rates in graphical form. Click 
on the “Chart” tab.  Select “Coverage” from the primary variable pull-down 
menu in the upper center of the window.  Right now, the Demand variables 
are shown at the top of the menu, since Demand is checked below. If you 
were in another variable subsection, such as Supply and Resources, you would 
have to go into Demand to find the Coverage variable. 
 
If you do not obtain those values go back to the “Data” view and check your inputs.  
If you obtain an error or warning message read it carefully as it might reveal where in your 
inputs is the discrepancy, or which step you skipped. 


============================================================
PAGE 39
============================================================

Getting First Results 
 39 
Stockholm Environment Institute 
 
October 2023 
 
Format the graph by selecting the 3-D option on the right side-bar menu, and 
ensure that “All months” is selected in the pull-down menu above the graph 
(also keep the “Monthly Average” option checked). Note that the 3-D option 
allows the viewer to see both data sets even while they overlap. The graph 
should like the one below.   
 
During the months of December and February, which have little flow in the river, 
Big City lacks water, and therefore demands go unmet. We modeled agriculture to 
only require water March-September, so it registers 100% coverage in the December-
February shortage because it has no water demand. Agriculture only has a shortfall 
in supply in the month of August and September, when the plants require the most 


============================================================
PAGE 40
============================================================

 40 
 
WEAP in One Hour 
October 2023 
 
 
WEAP Tutorial 
water. Note that because Agriculture and Big City both have a supply preference of 
1, when there is water shortage they will have equal percentages of unmet demand, 
assuming they are both demanding water at that time. 
 
You can fully customize the way WEAP charts are displayed, as well as print or copy graphs 
to the clipboard using the toolbox located to the right of the graph.  


============================================================
PAGE 41
============================================================

 
 
WEAP 
Water Evaluation And Planning System 
 
Basic Tools 
 
A TUTORIAL ON 
Creating and Using Key Assumptions ...................... 42 
Using the Expression Builder ................................... 45 
 
October 2023 
 
 
 
 
 
 
 
 
 
 


============================================================
PAGE 42
============================================================

 42 
 
Basic Tools 
October 2023 
 
 
WEAP Tutorial 
Note: 
For this module you will need to have completed the previous module (“WEAP in 
one hour”) or have a basic knowledge of WEAP (creating an area, drawing a model, 
entering basic data, obtaining first results). To begin this module, go to the Main 
Menu, select “Revert to Version” and choose the version named “Starting Point for 
‘Basic Tools’ module.” 
Creating and Using Key Assumptions 
1.   Using Key Assumptions 
Key Assumptions are pieces of data that may be useful to apply across 
multiple elements.  The use of key assumptions is especially worthwhile when 
the model has a large number of similar objects, for example demand sites, 
and when performing scenario analyses. In this case, you can easily set all your 
demand sites to have the same unit domestic consumption. Then, you can 
create scenarios to vary this consumption without having to edit each and 
every demand site – simply by changing the key assumption value. 
Key Assumptions are created by going to the Data view and right-clicking on 
the Key Assumptions branch of the Data Tree.  Select “Add” - this will create 
a new Key Assumption variable below the Key Assumption branch.   
 
After clicking Add, you can name your Key assumptions in the Data Tree. 
Name them and enter the data as follows: (be sure to select the appropriate 


============================================================
PAGE 43
============================================================

Creating and Using Key Assumptions 
 43 
Stockholm Environment Institute 
 
October 2023 
units from the Units pull-down menu. Cubic meters will be found under 
“Volume,”):  
Unit Domestic Water Use 
300 m3 
Unit Irrigation Water Needs 
3,500 m3 
 
With Key Assumptions, it is important to ensure that the units designated in 
a Key Assumption variable match the units indicated for the variable as it 
occurs elsewhere in the data tree. In this case, the 300 m3 domestic water use 
matches the 300 m3/person use specified in Big City/Water Use/Annual Use 
Rate. Similarly, the key assumption Unit Irrigation Water Needs matches the 
units in Agriculture/Water Use/Annual Water Use Rate. 
Create one more Key Assumption, Domestic Variation, that is unitless (“No  
Unit”), and use the Monthly Time Series Wizard to populate it with values: 
Domestic Variation  
 - Jan to Feb & Nov. to Dec.:  
0.9  
 - Mar. to May & Sept. to Oct.: 
1.0 
 - June 
1.1 
 - Jul, Aug 
1.15 
 


============================================================
PAGE 44
============================================================

 44 
 
Basic Tools 
October 2023 
 
 
WEAP Tutorial 
2.   Creating References to Key Assumption 
Create a Key Assumption reference for “Big City Annual Water Use.” Do 
this by going to the “Annual Water Use Rate” window for Big City in the 
Data view. Click on the Expression Builder pull-down menu in the space 
where you entered the “Annual Water Use Rate” (300 m3) previously.  
 
In the Expression Builder window, delete the value of 300 from the text field 
at the bottom of the Expression Builder window, click on the “Branches” tab 
towards the bottom left of the screen, then click on the “Unit Domestic 
Water Rate” under Key Assumption (you may have to expand the data tree 
to see all of the branches) in the Data tree field and drag it down to the text 
field so it shows up as Key\Unit Domestic Use[m^3].  Click on “Finish.” 


============================================================
PAGE 45
============================================================

Using the Expression Builder 
 45 
Stockholm Environment Institute 
 
October 2023 
 
Repeat this procedure to replace the 3500 m3/ha water use rate for the 
“Agriculture” Demand Site with the newly created “Unit Irrigation Water 
Needs” Key Assumption. 
If you check the results now by re-recalculating, you should have the same 
annual total values for demand as obtained in the WEAP in One Hour 
module: 
 - Annual Demand for Agriculture 
350 M m3 
 - Annual Demand for Urban Area 
240 M m3 
 
 
Using the same process, references to other objects’ data can also be created. This can be 
helpful in certain cases. Upon dragging and dropping the object to be referenced from the 
tree to the expression builder’s text field, a list of all available variables appears. 
Using the Expression Builder 
3.   Creating Mathematical Expressions 
You will now alter the monthly variation in water demand for Big City using 
a mathematical expression. In the Data view, click on the Big City demand 
site, then “Water Use” and the “Monthly Variation” tab and select the 
Expression Builder from the pull-down menu in the data entry bar.  


============================================================
PAGE 46
============================================================

 46 
 
Basic Tools 
October 2023 
 
 
WEAP Tutorial 
 
Create the following expression by pulling down the “Domestic Variation” 
Key Assumption and typing in the modifying terms:  
Key\Domestic Variation * 100 / 12 
 
 
Note that if you had made a mistake in typing the expression, such as entering a 
space instead of a division sign, an error message would have appeared after clicking 
“Finish.” You would then be given the opportunity to review and correct the 
expression. After the correction of an error, you must click “Verify” before “Finish.” 


============================================================
PAGE 47
============================================================

Using the Expression Builder 
 47 
Stockholm Environment Institute 
 
October 2023 
View the new results for “Demand Site Coverage” after making these changes. 
Click on the Results view and click on “Yes” to recalculate. The results should 
appear as below: 
 
 
Note that there is no longer unmet demand in December for Big City because 
the fraction of demand in December decreased from 8.5% (originally based 
on the number of days in the month) to 7.5% (now based on the expression 
using the “Domestic Variation” Key Assumption).  You can review the 
numerical values calculated from the “Monthly Variation” expression by 
selecting the “Table” tab in the data review panel at the bottom of the data 
window. Remember it is calculated from the original data we entered in the 
Key Assumptions/Domestic Variation, subjected to the equation we entered 
in the Expression Builder. 


============================================================
PAGE 48
============================================================

 48 
 
Basic Tools 
October 2023 
 
 
WEAP Tutorial 
 
5 
4.   Using Built-In Functions 
We will assume that the current population of Big City (2000) is not known, 
but we know its population during the last census and the growth estimate. 
We can use the built-in “GrowthFrom” function to compute the current 
population of Big City.  Do this by selecting the Expression Builder from the 
pull-down menu in the year 2000 data input field within the “Annual Activity 
Level” window for Big City. Delete the present value of 800000, click on the 
“Function” tab rather than the “Branch” tab and drag down into the text field 
the “GrowthFrom” expression selected from the list of built in expressions. 


============================================================
PAGE 49
============================================================

Using the Expression Builder 
 49 
Stockholm Environment Institute 
 
October 2023 
 
 
Input the following data into the “GrowthFrom” expression, using the 
format indicated in the description window next to the expression list. 
Date of last Census 
1990 
Population at last census 
733,530 
Estimated growth rate 
1.75% 


============================================================
PAGE 50
============================================================

 50 
 
Basic Tools 
October 2023 
 
 
WEAP Tutorial 
This results in the following format for the expression: 
GrowthFrom(1.75%, 1990, 733530) 
Be sure to include the percentage sign in your expression. 
 
 
The Expression Builder is only a simple way of entering expressions and functions. Savvy 
users can by-pass it and enter functions, references and mathematical expressions directly in 
the main Expression window.  
 


============================================================
PAGE 51
============================================================

 
 
WEAP 
Water Evaluation And Planning System 
 
Scenarios 
 
A TUTORIAL ON 
Preparing the Ground for Scenarios .......................... 52 
Creating the Reference Scenario ................................. 53 
Creating and Running Scenarios ............................... 58 
Using the Water Year Method ................................. 61 
 
October 2023 
 
 
 
 
 
 
 
 


============================================================
PAGE 52
============================================================

 52 
 
Scenarios 
October 2023 
 
 
WEAP Tutorial 
Note: 
For this module you will need to have completed the previous modules (WEAP in 
One Hour and Basic Tools) or have a fair knowledge of WEAP (data structure, Key 
Assumptions, Expression Builder). To begin this module, go to the Main Menu, 
select “Revert to Version” and choose the version named “Starting Point for 
‘Scenarios' module.”  
Preparing the Ground for Scenarios 
1.   Understand the Structure of Scenarios in WEAP 
In WEAP the typical scenario modeling effort consists of three steps. First, a 
“Current Accounts” year is chosen to serve as the base year of the model; 
Current Accounts has been what you have been adding data to in the previous 
modules. A “Reference” scenario is established from the Current Accounts 
to simulate likely evolution of the system without intervention. Finally, “what-
if” scenarios can be created to alter the “Reference Scenario” and evaluate 
the effects of changes in policies and/or technologies.  
Read the “Scenarios” help topic (under the Data subheading in the Help Contents) 
for a more detailed description of the WEAP approach.  
2.   Change the Time Horizon for the Area 
In the Data or Schematic view, under the General\Years and Time Steps 
menu, change the “Time Horizon” of the Area.  
Current Accounts Year 
2000 (unchanged) 
Last Year of Scenarios 
2015 
3.   Create an Additional Key Assumption 
Create the following key assumption: 
Population Growth Rate 
2.2 
There is no unit for this Key Assumption, but remember to change the “Scale” 
field to Percent. 


============================================================
PAGE 53
============================================================

Creating the Reference Scenario 
 53 
Stockholm Environment Institute 
 
October 2023 
Creating the Reference Scenario 
4.   Describe the Reference Scenario 
The “Reference” Scenario always exists. Change its description in the 
Area\Manage Scenarios menu to reflect its actual role.  Note that you must 
be in the Data View or Schematic view to have access to the “Manage 
Scenarios” option in the Area menu. 
For example, “Base Case Scenario with population growth continuing at the 1960-
1995 rate and slight irrigation technology improvement.”  
 
5.   Change the Unit Irrigation Water Use 
In the Data View, change the “Unit Irrigation Water Needs” Key Assumption 
to reflect a new annual pattern for the period (2001-2015) after the Current 
Accounts year. To make the change, you will need to select the “Reference” 
scenario from the drop-down menu at the top of the screen. Use the “Yearly 
Time-Series Wizard” to construct the time series.    
 


============================================================
PAGE 54
============================================================

 54 
 
Scenarios 
October 2023 
 
 
WEAP Tutorial 
 
First, select the function “Linear Interpolation” by clicking on it, then click “Next.”  
 
Click on “Enter Data” in the next window, click “Next”, then click “Add” to 
add the following data to the time series: 


============================================================
PAGE 55
============================================================

Creating the Reference Scenario 
 55 
Stockholm Environment Institute 
 
October 2023 
Enter Time-Series Data: 
 Linear Interpolation 
Data:  
 
2000 3500 
 
2005 3300 
 
2010 3200 
 
2015 3150 
 
Growth after last year: 0% 
Note that the first data point, for the year 2000, should already be listed in 
the data input window because it was input when the “Unit Irrigation Water 
Needs” Key Assumption was created in the Current Accounts (see Exercise 
1 under Creating and Using Key Assumptions, Basic Tools Module). 
 
 
As you can see while running the Yearly Time Series Wizard, WEAP offers a wide range of 
techniques to build time series, including importing from Excel files, creating step 
functions, using forecasting equations etc.  
The Yearly Time Series Wizard helps you create expressions. You can also simply type or 
edit the expression (in this case, “Interp( 2000,3300,  2005,3300,  2010,3200, 2015,3150 )” 
without running the wizard, either directly or through the Expression Builder.  
6.   Set the Population Growth 
Change the population of Big City to grow by the rate defined by the 
“Population Growth Rate” Key Assumption defined in an earlier step. Here 
again you will have to select the “Reference” scenario in the drop-down menu 
at the top of the Data view.  


============================================================
PAGE 56
============================================================

 56 
 
Scenarios 
October 2023 
 
 
WEAP Tutorial 
Make sure you have the Big City Demand Site and its Annual Activity Level tab 
selected. Delete the current expression and select the “Growth” function in the 
Expression Builder in the pull-down menu below the 2001-2015 field (Note that 
the present expression in this field is the same as that for the Current Accounts 
year). Then click on the “Branch” tab above the text field. Either double click on 
the “Population Growth Rate” Key Assumption in the Data Tree, or drag it down 
into the expression window. Your final function should read 
“Growth(Key\Population Growth Rate/100)”  
Note that you have to divide the “Population Growth Rate” by 100 in order for 
WEAP to recognize the value of 2.2 in the Key Assumption as 0.022 in the 
calculation. 
  
 
The same effect could have been modeled without creating a Key Assumption in the first 
place. We will see however that doing so provides more flexibility when adding other 
scenarios.  
Any value for which no time series is defined for the “Reference” scenario is assumed to 
remain constant. In our case for example, the Agriculture demand will remain constant until 
2015 unless we change this variable as well.  


============================================================
PAGE 57
============================================================

Creating the Reference Scenario 
 57 
Stockholm Environment Institute 
 
October 2023 
7.   Run the Reference Scenario 
Run the Reference Scenario by clicking the “Results” view. Look at a 3-D 
graph of “Unmet Demand” (select “Annual Total”) for both demand sites. It 
should be similar to the figure below. Think about the following points.  
How does the demand evolve compared to the unmet demand? 
Why is the total unmet demand decreasing at first and then increasing? 
 
 


============================================================
PAGE 58
============================================================

 58 
 
Scenarios 
October 2023 
 
 
WEAP Tutorial 
Creating and Running Scenarios 
8.   Create a New Scenario to Model High Population Growth 
Create a new scenario to evaluate the impact of a population growth rate for 
Big City higher than 2.2% for the period 2001-2015.  
For this you will have to return to the Data View or the Schematic View. Choose 
the menu “Area”, “Manage Scenario”, right-click the “Reference” scenario and 
select “Add.” Name this scenario “High Population Growth” and add the 
description “This scenario looks at the impact of increasing the population growth 
rate for Big City from a value of 2.2% to 5.0%.” 
 
9.   Enter the Data for this Scenario 
Make the following changes in the Data view after having chosen your new 
scenario in the drop-down menu at the top of the screen: 
Select the “Population Growth Rate” Key Assumption and change the value under 
the 2001-2015 field to 5.0. Note that the color of the data field changes to red after 
the change - this occurs for any values that are changed to deviate from the 
“Reference” scenario value. 


============================================================
PAGE 59
============================================================

Creating and Running Scenarios 
 59 
Stockholm Environment Institute 
 
October 2023 
  
10.   
Compare Results: Reference and Higher Population Growth 
Scenarios 
Compare, graphically, the results for the two scenarios we have established 
so far (Reference and Higher Population Growth).  
For example, select “Water Demand” from the primary variable pull-down menu.  
Click in the drop-down menu to the right of the chart area (above the graph legend), 
and select “All Scenarios.” Choose to show only Big City demand by selecting it 
from the pull-down list in the upper left pull-down menu of the Results window. 
Your graph should be similar to the one below.  


============================================================
PAGE 60
============================================================

 60 
 
Scenarios 
October 2023 
 
 
WEAP Tutorial 
 
Note the higher Water Demand for Big City in the “Higher Population 
Growth” scenario, as expected. 
  
Next, compare “Unmet Demand” for the two scenarios. Use the primary 
variable pull-down menu to select “Unmet Demand.” 
 
Again, note the higher Unmet Demand for the Higher Population Growth 
scenario. 


============================================================
PAGE 61
============================================================

Using the Water Year Method 
 61 
Stockholm Environment Institute 
 
October 2023 
 
When creating many scenarios in the same area, the computation can become lengthy. In 
this case you can exclude some of the scenarios from the calculation by unchecking the 
“Show results for this scenario” box in the scenario manager for those scenarios. 
Using the Water Year Method 
11.   
Create the Water Year Definitions 
The previous exercise only varied demand, not supply. In this step we now want 
to see how natural variation in climate data (stream flow, rainfall etc.) can be 
taken into account in WEAP through scenario analyses. We will use the 
“Water Year Method” as an example.  The Water Year Method is a simple 
means to represent variation in climate data such as streamflow, rainfall, and 
groundwater recharge.  The method first involves defining how different 
climate regimes (e.g., very dry, dry, very wet) compare relative to a normal 
year, which is given a value of 1. Dry years have a value less than 1, very wet 
years have a value larger than 1.  
With the “Reference” scenario selected, go into the data view and click on 
the “Water Year Method” branch under “Hydrology” in the Data tree. 
  
Select the “Definitions” tab and expand the window, if necessary, to see all 
five definitions. Enter the following data: 


============================================================
PAGE 62
============================================================

 62 
 
Scenarios 
October 2023 
 
 
WEAP Tutorial 
Very Dry 
0.7 
Dry 
0.8 
Normal 
1.0 
Wet 
1.3 
Very wet 
1.45 
 
 
Monthly variations can be entered with the Water Year Monthly Fluctuation Wizard in the 
drop-down menu. 
12.   
Create the Water Year Sequence 
The next step in using the “Water Year Method” is to create the sequence of 
climatic variation for the scenario period.  Each year of the period is assigned 
one of the climate categories (e.g., wet).  Select the “Sequence” tab under the 
“Water Year Method” branch. 
Set the Current Account as Normal 


============================================================
PAGE 63
============================================================

Using the Water Year Method 
 63 
Stockholm Environment Institute 
 
October 2023 
 
Then, select the “Reference” scenario and input the following sequence.  
2001-2003 normal 
2004  
very dry 
2005 
wet 
2006-2008 normal 
2009-2010 dry 
2011  
very wet 
2012  
normal 
2013  
wet 
2014  
normal 
2015  
dry 


============================================================
PAGE 64
============================================================

 64 
 
Scenarios 
October 2023 
 
 
WEAP Tutorial 
 
 
In order to let the inflows to the model (in our case, the headflow of the main river) vary in 
time, WEAP offers two strategies. If detailed forecasts are available, those can be read using 
the ReadFromFile function (refer to the Tutorial module on Format and Data for more 
details). Another method, which is the one presented here, is the “Water Year Method.” 
Under this method every year in the model’s duration can be defined as normal, wet, very 
wet, dry or very dry. Different scenarios can then alter the chosen sequence of dry and wet 
years to assess the impact of natural variation on water resources management.  
13.   
Set up the Model to Use the Water Year Method 
In the Data tree, change the “Headflow” for the Main River in the “Reference” 
scenario to use the “Water Year Method.”  Note that before, the monthly 
values of Headflow were the same for the period 2001-2015 as for 2000, the 
Current Accounts year. 
Use the drop down menu in the “Get Values from” to select this method. You may 
have to scroll left in this window to get the “Get Values from” field to appear 


============================================================
PAGE 65
============================================================

Using the Water Year Method 
 65 
Stockholm Environment Institute 
 
October 2023 
 
14.   
Re-run the Model 
Run the model again and compare “Unmet Demand” for the “Reference” 
and “Higher Population Growth” scenarios, as before (of course, “Water 
Demand” will not have changed after altering the supply side of the model 
with the Water Year Method).  
 
Note that Big City “Unmet Demand” for both scenarios is much more erratic 
using the Water Year Method than assuming a constant headflow to the Main 


============================================================
PAGE 66
============================================================

 66 
 
Scenarios 
October 2023 
 
 
WEAP Tutorial 
River, as observed in the previous exercise.  In the present case, Unmet 
Demand varies as the future climate varies. During years wetter or much 
wetter than normal (2000, the Current Accounts year), Unmet Demand is 
actually lower than in 2000 for both scenarios, even with the increase in Water 
Demand from population growth (2.2% for the Reference and 5.0% for the 
Higher Population Growth scenarios). The increased precipitation, and 
headflow to the river, mitigates this increased demand in the wetter years.   
The opposite occurs in the dry to very dry years, where the population growth 
is exacerbated by the lower precipitation and headflow in the river in these 
years. This leads to even higher Unmet Demand than is simulated assuming 
a constant climate (as performed in the previous exercise). 
 
Since unmet demand is the difference between a large demand and a large supply, even a 
rather small change in the supply at nearly-constant demand can have a very large impact 
on the unmet demand.  
This model does not take any kind of inter-year storage into consideration (reservoirs, 
groundwater). Therefore, there is no way that the shortage in a dry year can be alleviated by 
using surplus from previous, wetter years. For more details on how to model storage, refer to 
the “Refining the Supply” WEAP tutorial module.  
If you had wanted to compare, in the same graph in WEAP, results for the Water 
Year Method to that generated assuming a constant climate, you could have 
created a new scenario that used the Water Year Method rather than changing 
the data in the “Reference” scenario to accommodate the Water Year Method. 
This new scenario would be inherited from the “Reference” scenario, and the 
Scenario tree in the “Scenarios Manager would look as follows: 


============================================================
PAGE 67
============================================================

Using the Water Year Method 
 67 
Stockholm Environment Institute 
 
October 2023 
 
Note that in this case, both the “Reference” (constant climate) and “Water 
Year Method” scenarios (variable climate) would use a Population Growth 
Rate equal to 2.2% for Big City, since the “Water Year Method” scenario is 
inherited from the “Reference” scenario.  
If one wanted to compare, in the same WEAP graph, constant climate and 
variable climate using a 5% Population Growth Rate, you could create 
another new scenario inherited from the “Water Year Method” scenario and 
change the “Population Growth Rate” Key Assumption in this scenario to 
5%. The tree structure would look as follows: 


============================================================
PAGE 68
============================================================

 68 
 
Scenarios 
October 2023 
 
 
WEAP Tutorial 
 
 
WEAP allows for unlimited versatility in the arrangement of scenarios. Note that you can 
output results to Excel, which also facilitates results comparisons among scenarios.  This 
feature will be discussed in greater detail in the “Data, Results, and Formatting” module. 
15.   
Change Scenario Inheritance 
The following example demonstrates the utility of changing scenario 
inheritance within WEAP.   
Create a new scenario inherited from the “Reference” scenario, and name it 
“Extended Dry Climate Sequence.” The scenario tree structure should look 
as follows: 
 


============================================================
PAGE 69
============================================================

Using the Water Year Method 
 69 
Stockholm Environment Institute 
 
October 2023 
 
Go to the Data view and select this new scenario for editing.  Click on the 
“Water Year Method” branch of the data tree (below Hydrology) to edit the 
climate sequence as follows: 
2001-2003 normal 
2004  
wet 
2005-2008 normal 
2009-2010 very dry 
2011  
normal 
2012  
dry 
2013  
normal 
2014  
normal 
2015  
dry 
The results (shown below) indicate that Big City “Unmet Demand” for the 
“Extended Dry Climate Sequence” (new climate sequence and a 2.2 % Population 
Growth Rate) falls somewhat in between those for the “Reference” scenario (original 
climate sequence and a 2.2 % Population Growth Rate) and the “Higher 
Population Growth Rate” scenario (original climate sequence, but a 5% Population 
Growth Rate). 
 


============================================================
PAGE 70
============================================================

 70 
 
Scenarios 
October 2023 
 
 
WEAP Tutorial 
 
Now, we will change the Scenario Inheritance of the “Extended Dry Climate 
Sequence” scenario, placing it under the “Higher Population Growth Rate” 
scenario so that it inherits the 5% Population Growth Rate of that scenario. 
In the Scenario Manager, select the “Extended Dry Climate Sequence” 
scenario, click on the drop-down list to the right (below the text saying 
“Extended Dry Climate Sequence is based on:”) and select “Higher 
Population Growth” as the new parent scenario.  
 


============================================================
PAGE 71
============================================================

Using the Water Year Method 
 71 
Stockholm Environment Institute 
 
October 2023 
Now, recalculate the results and look again at “Unmet Demand” for Big City. 
What changes do you notice to the unmet demand for the “Extended Dry Climate 
Sequence” scenario? 
 
 
With the higher population growth rate and dryer climate, Unmet Demand increases 
substantially. 


============================================================
PAGE 72
============================================================



============================================================
PAGE 73
============================================================

 
 
WEAP 
Water Evaluation And Planning System 
 
Refining the 
Demand Analysis 
 
A TUTORIAL ON 
Disaggregating Demand ........................................... 74 
Modeling Demand Side Management, Losses 
and Reuse ................................................................ 80 
Setting Demand Allocation Priorities ........................ 89 
 
October 2023 
 
 
 
 
 
 


============================================================
PAGE 74
============================================================

 74 
 
Refining the Demand Analysis 
October 2023 
 
 
WEAP Tutorial 
Note: 
For this module you will need to have completed the previous modules (“WEAP in 
One Hour, Basic Tools, and Scenarios) or have a fair knowledge of WEAP (data 
structure, Key Assumptions, Expression Builder, creating scenarios). To begin this 
module, go to the Main Menu, select “Revert to Version” and choose the version 
named “Starting Point for all modules after ‘Scenarios’ module.” 
Disaggregating Demand 
1.   Create a new Demand Site 
In the Current Accounts, create a new demand site downstream of Big City 
to simulate rural demand. Name this node “Rural” and give it a Demand Priority 
= 1.  Provide a Transmission Link from the Main River positioned 
downstream of both the Big City and Agriculture Return Flows.  The Supply 
Preference should be set to 1. Also provide a Return Flow for Rural that is 
positioned further downstream.  
Your area should now look as follows: 
 


============================================================
PAGE 75
============================================================

Disaggregating Demand 
 75 
Stockholm Environment Institute 
 
October 2023 
2.   Create the Data Structure for “Rural” demand node 
In order to create a data structure, right-click the “Rural” demand site in the 
data view tree, and select “Add” to implement the following structure (do not 
enter any data yet):  
 
Note that “Showers”, “Toilets”, “Washing”, and “Others” are added as sub-
branches below “Single Family Houses.”  
 


============================================================
PAGE 76
============================================================

 76 
 
Refining the Demand Analysis 
October 2023 
 
 
WEAP Tutorial 
3.   Enter the Annual Activity Level data 
Enter the following data under the Rural Demand Site, Annual Activity Level 
tab (You will have to click on Single Family House in the Data Tree):  
Rural 
 
 
 
120,000 Households 
 
Single Family Houses  
70% Share 
 
 
Showers 
 
80% Saturation 
 
 
Toilets  
 
90% Saturation 
 
 
Washing 
 
55% Saturation 
 
 
Others  
 
35% Saturation 
 
Apartment Buildings  
Remainder share (use the Expression Builder) 
 
Share vs. Saturation: even though both types of percentages are treated mathematically the 
same by WEAP, they are conceptually different. At a given level of the tree, shares should 
always sum up to 100%. They also allow the use of the “remainder” function. Saturation 
indicates the penetration rate for a particular device and is independent of the penetration 
rate for other devices (i.e., saturation rates for all sub-branches within a given branch do not 
have to sum to 100.)  
 


============================================================
PAGE 77
============================================================

Disaggregating Demand 
 77 
Stockholm Environment Institute 
 
October 2023 
 
4.   Enter the Annual Water Use Rate data 
Enter the following data under the “Rural” demand site, “Annual Water Use 
Rate” tab.  
Rural  
 
Single Family Houses 
 
 
 
Showers 
80 m3/household 
 
 
Toilets 
120 m3/household 
 
 
Washing 
60 m3/household 
 
 
Others 
40 m3/household 
 
Apartment Buildings 
220 m3/household 
Consumption (in consumption tab) 80% 
Note that the “Consumption” value is entered for the entire Rural demand 
node, and not the sub-branches. 
5.   Check the results 
Recalculate your results. In the Results view, choose “Water Demand” as the 
primary variable from the pull-down menu. Select “All Branches” from the 
pull-down menu directly above the graph legend. Select 3-D and bar graph as 
the format using the pull-down menu for the “Chart Type” icon on the 
vertical graphing toolbar.   


============================================================
PAGE 78
============================================================

 78 
 
Refining the Demand Analysis 
October 2023 
 
 
WEAP Tutorial 
 
To see the results stacked, click on the bar icon in the far-right menu, and 
click the option “stacked.” 
 
To view Water Demand results for all of the Rural sub-branches (e.g., Single 
Family Houses\Showers; Apartment Buildings), select 2 on the “Levels” box 
(directly above the center of the graph).  
 


============================================================
PAGE 79
============================================================

Disaggregating Demand 
 79 
Stockholm Environment Institute 
 
October 2023 
Change the branch of demand to the Rural demand. 
 
 
 
Do you understand why the Rural demand varies through the year even though we have not 
entered any variation? 


============================================================
PAGE 80
============================================================

 80 
 
Refining the Demand Analysis 
October 2023 
 
 
WEAP Tutorial 
 
The variation in Rural demand is due to the fact that WEAP assumes a constant daily 
demand per day (no monthly demand was specified by the user), so months that have less 
days (like February) have a lower demand than months that have more days (like January).  
Now create a 3-D graph of “Demand Site Coverage” and select all demand 
sites for presentation (the pull-down menu to do the latter is to the right of 
the graph; see below). 
 
Do you understand why Coverage is always 100% for Rural but not for Big City and 
Agriculture, even though they all have the same demand priority level? 
Modeling Demand Side Management, Losses and 
Reuse 
6.   Implement Demand Side Management—the disaggregated approach 
We will now create a new scenario that explores a demand side management 
strategy.  Call this scenario “New Washing Machines DSM”; it is to be 
inherited from the “Reference” scenario so it will have the same climate and 
Big City population growth rate as the “Reference” scenario. We deleted the 
 
The Rural withdrawal point is downstream of the return flow point for the Big City, which 
means there is an additional volume of water available in the river; this return flow can easily 
cover the rather small Rural demand.  


============================================================
PAGE 81
============================================================

Modeling Demand Side Management, Losses and Reuse 
 81 
Stockholm Environment Institute 
 
October 2023 
scenarios we are not using by clicking the “delete” button. The scenario tree 
in the Manage Scenarios window should look like this: 
 
We will assume that a new type of washing machines allows a 1/3 reduction 
(33.3% less) in washing water consumption. This new scenario will evaluate 
the impact of this Demand Side Management measure if 50% of the 
households can be convinced to purchase the water-saving machine.  
First, go back to Current Accounts in the Data view, where you will create 
two new branches (Old Machines and New Machines) in the Rural data 
structure.  Effectively, you are disaggregating the “Washing” variable to now 
include two new sub-categories. Note that you must return to Current Accounts 
because all new data structures must be entered in Current Accounts, even if the variable is 
not to be activated (i.e., given non-zero activity levels) in the Current Accounts and 
“Reference” scenario.  
When you go to add the first sub-branch under Washing, you will get the 
following message: 
 


============================================================
PAGE 82
============================================================

 82 
 
Refining the Demand Analysis 
October 2023 
 
 
WEAP Tutorial 
Click “Yes,” and add the following structure: 
 
Change the units for “Old Machines” and “New Machines” to “Shares.” Under 
Annual Water Use, reenter the Water Use Rate for Old Machines (60 m3/household), 
as was the value for the original higher-level variable “Washing.”  
 
Enter a value of 100% for the “Old Machines Annual Activity Level.” Leave 
blank the Annual Activity Level for “New Machines” - this is the same as 
entering a zero. Remember, you are entering these in the Current Accounts, 
so you want only the “Old Machines” to be active in the “Reference” scenario. 
This recreates the same effect as having the aggregated variable “Washing” in 
the original Current Accounts and “Reference” scenario. The “New 
Machines” variable will be activated in the “New Washing Machines DSM” 
scenario (see below).  


============================================================
PAGE 83
============================================================

Modeling Demand Side Management, Losses and Reuse 
 83 
Stockholm Environment Institute 
 
October 2023 
 
Now, switch to the “New Washing Machines DSM” scenario.   
Input 50 for New Machines (50% of all washing machines will be the new variety) 
and Remainder(100) for Old Machines, using the Expression Builder for the 
latter. 
 
You will have to input again the original Water Use Rate for the Old Machines 
(60 m3/household) as well as the new Water Use Rate for the New Machines:  


============================================================
PAGE 84
============================================================

 84 
 
Refining the Demand Analysis 
October 2023 
 
 
WEAP Tutorial 
Old Machines 
 
60 m3/household 
New Machines 
 
60*0.667 m3/household 
View the data as “Bar,” selected from the top icon on the right hand side. 
Now compare the numerical Water Demand results for the Washing branch 
of the Rural demand site for the “Reference” and “New Washing Machines 
DSM” scenarios. In the Results view, click on the Table tab and select the 
Water Demand variable. Also select “Annual Total” rather than “Monthly 
Average” and choose 2001 (you can only view numerical results for one 
individual year at a time when comparing scenarios in the Table view, but this 
does not present a difficulty for this example, as we do not try to model any 
growth with time for the Washing variable). Choose Demand Sites\Rural\ 
Washing\Single Family Houses\Washing from the upper left pull-down 
menu and “All Branches” from the upper right pull-down menu. Select 
“Reference” and “New Washing Machines DSM” from the pull-down menu 
at the bottom of the window. The table should look like the following: 
 
Note that the use of the New Machines in 2001 (and all subsequent years in 
the “New Washing Machines DSM” scenario period) results in about 460,000 
m3 less water demand than if only Old Machines are used (Reference 
scenario). 


============================================================
PAGE 85
============================================================

Modeling Demand Side Management, Losses and Reuse 
 85 
Stockholm Environment Institute 
 
October 2023 
 
Demand-side management (DSM) refers to measures that can be taken on the consumer’s 
side of the meter to change the amount or timing of water consumption (as compared to the 
utility company's, or supply, side of the meter). 
Another way of modeling disaggregated DSM is to reduce the unit consumption for the 
affected category (in this case washing). There is no right or wrong way to model DSM, 
although some ways can show more information than others within WEAP. 
7.   Implement Demand Side Management—the aggregated approach 
If disaggregated data is not available, an equivalent value of DSM can be 
computed. In this example, assuming we had not disaggregated the Rural 
water demand, we could come to the same result by using the “Demand 
Management” option for this Demand Site in the Data view. In this case the 
reduction would amount to: 
Original contribution of washing to rural water use 
2,772/26,316 10.5% 
Share of New Machines 
50% 
Reduction of New Machines 
66.6% 
Multiplying all of these percentages together = 
3.5% 
This value could be entered in the “Demand Management/Demand Savings” 
tab for the Rural branch of a Demand Side Management scenario. 
 
 
Demand Side Management (DSM) measures are not taken into account in the demand 
view. To see the effect of a DSM measure, look at the change in Supply Requirement rather 
than Water Demand.  


============================================================
PAGE 86
============================================================

 86 
 
Refining the Demand Analysis 
October 2023 
 
 
WEAP Tutorial 
8.   Model Reuse 
Another water conservation strategy that could be studied with scenarios is 
water reuse. Create a new scenario inherited from the “Reference” scenario 
and name it “Big City Reuse.” Make sure you are in this new scenario and 
click on the Big City branch. Click on the “Loss and Reuse” button and click 
the “Reuse Rate” tab.  
 
Enter the following expression in the 2001-2015 field using the Expression 
Builder: 
Smooth(2001,5, 2005,18, 2015,25) 
First, pull the “Smooth” function into the text field of the Expression builder 
and select “Smooth Curve” from the options. Click “Next” and enter the data 
values. You should get a plot like the one below. Note that Reuse in the 
Current Accounts (2000) remains zero. Click “Finish.” 


============================================================
PAGE 87
============================================================

Modeling Demand Side Management, Losses and Reuse 
 87 
Stockholm Environment Institute 
 
October 2023 
 
In the Results View, compare Unmet Demand for Big City before (Reference) 
and after (Big City Reuse) instituting this conservation strategy. You should 
get the graph below, which shows substantial reductions in Big City Unmet 
Demand when the water reuse strategy is used. 
 
9.   Model Losses 
Re-edit the model to account for a 20% loss rate in the network of Big City.  
Make this change for the Current Accounts so that it will be carried through 


============================================================
PAGE 88
============================================================

 88 
 
Refining the Demand Analysis 
October 2023 
 
 
WEAP Tutorial 
the “Reference” scenario, and as a result of the inheritance feature, 
throughout all scenarios. 
 
What happens to the unmet demand for the Big City, both in the “Reference” scenario and 
the “Big City Reuse” scenario compared to the earlier exercise without losses? 
 


============================================================
PAGE 89
============================================================

Setting Demand Allocation Priorities 
 89 
Stockholm Environment Institute 
 
October 2023 
 
Losses can happen in Transmission Link, in the Demand Site itself or in the Return flow. 
Losses in the Transmission Link will affect the supply to the Demand Site. Losses in the 
Demand Site will affect the required Supply Requirements of this Demand Site. Losses in 
the Return Flow will only affect the flow returned.  
Setting Demand Allocation Priorities 
10.   
Edit Demand Site Priority 
Create a new scenario, inherited from the “Reference”, and name it 
“Changing Demand Priorities.” Change the Demand Priority of the 
Agriculture Demand Site in the Data view by clicking on the Agriculture 
branch and then clicking on the Priority button, or by clicking on the node in 
the Schematic View and selecting “General Info.” 
Change the Demand Priority from 1 to 2. 
 


============================================================
PAGE 90
============================================================

 90 
 
Refining the Demand Analysis 
October 2023 
 
 
WEAP Tutorial 
 
A demand priority can be any whole number between 1 and 99 (1 is the default) and allows 
the user to specify the order in which the water requirements of demand sites are satisfied.  
WEAP will attempt to satisfy the water requirement of a demand site with a demand priority 
of 1 before a demand site with a demand priority of 2 or greater. If two demand sites have 
the same priority, WEAP will attempt to satisfy their water requirements equally. Absolute 
values have no significance for the priority levels; only the relative order matters.  For 
example, if there are two demand sites, the same result will occur if demand priorities are 
set to 1 and 2 or 1 and 99.  
Demand Priorities allow the user to represent in WEAP water allocation as it actually occurs 
in their system. For example, a downstream farmer may have historical water rights to river 
water, even though another demand site positioned upstream could extract as much river 
water as it desired, leaving the farmer with little water in the absence of such water rights. 
The Demand Priority setting allows the user to set the farmer's priority for water above that 
of the upstream demand site.  Demand Priorities can also change with time or change in a 
scenario - more advanced subject matter to be dealt with later in the tutorial. 
You can also change the Demand Priority in the Data View\”Priority” screen\”Demand 
Priority” tab.  
11.   
Compare Results 
Display graphically the Unmet Demand for Agriculture for the “Reference” 
and “Changing Demand Priorities” scenarios. It should look like the graph 
below”: 
 
Notice that the Unmet Demand for Agriculture increases when its Demand 
Priority is raised to 2.  This is because Big City now has preference for having 
its demand met first. Evidence of this can be observed by generating a graph 
of the monthly average Demand Coverage for Big City and Agriculture across 
all years of the Reference scenario. 


============================================================
PAGE 91
============================================================

Setting Demand Allocation Priorities 
 91 
Stockholm Environment Institute 
 
October 2023 
 
Now compare these results to the same graph generated for the “Changing 
Demand Priorities” scenario. 
 
Notice that in the “Reference” scenario, for April and August, both Big City 
and Agriculture do not get full coverage of their demand because they both 
compete equally for Main River flow. When Big City is given preference for 
meeting demand (Changing Demand Priorities scenario), however, its 
coverage improves relative to Agriculture.  At times, coverage is 100% for 
Agriculture, but not for Big City. That is because there is no Agriculture 


============================================================
PAGE 92
============================================================

 92 
 
Refining the Demand Analysis 
October 2023 
 
 
WEAP Tutorial 
demand (primarily observed for the winter months).  Note that the Demand 
Coverage for the Rural demand site is always 100% because the return flows 
for Big City and Agriculture satisfy the water demand created by the Rural 
demand site. 
 


============================================================
PAGE 93
============================================================

 
 
WEAP 
Water Evaluation And Planning System 
 
Refining the 
Supply 
 
A TUTORIAL ON 
Changing Supply Priorities ....................................... 94 
Modeling Reservoir Supply ....................................... 97 
Adding Flow Requirements .................................... 104 
Modeling Groundwater Resources ........................... 108 
 
October 2023 
 
 
 
 
 
 


============================================================
PAGE 94
============================================================

 94 
 
Refining the Supply 
October 2023 
 
 
WEAP Tutorial 
Note: 
For this module you will need to have completed the previous modules (“WEAP in 
One Hour, Basic Tools, and Scenarios) or have a fair knowledge of WEAP (data 
structure, Key Assumptions, Expression Builder, creating scenarios). To begin this 
module, go to the Main Menu, select “Revert to Version” and choose the version 
named “Starting point for all modules after ‘Scenarios’ module.” 
Changing Supply Priorities 
1.   Create a new Transmission Link for water reuse 
Create a new transmission link starting at the Big City Demand Site and 
ending at the Agriculture Demand Site. This is a conceptual model of reuse 
of urban wastewater for agriculture purposes. Set the Supply Preference on 
this Transmission Link to 2.  
Supply Preference 
 
2 
 
 
If water quality were a concern, a wastewater treatment plant could have been added to treat 
the water from Big City before Agriculture received it. Having the treatment plant in the 
schematic would make it possible to simulate the changes in water quality before and after 
treatment.  


============================================================
PAGE 95
============================================================

Changing Supply Priorities 
 95 
Stockholm Environment Institute 
 
October 2023 
2.   Results when you change Supply Preferences 
Try changing the Supply Preferences of the two links that now supply 
Agriculture and look at the related results for Demand Site Coverage.  To 
change Supply Preferences, either right click on the Transmission Link in the 
Schematic view or go to the Data view and click on the appropriate 
Transmission link below Supply and Resources\Linking Demands and 
Supply\Agriculture. 
 
Try the following combinations:  


============================================================
PAGE 96
============================================================

 96 
 
Refining the Supply 
October 2023 
 
 
WEAP Tutorial 
Supply Preferences = 1 from the Main River, 2 from Big City 
    
Supply Preferences = 2 from the Main River, 1 from Big City 
 


============================================================
PAGE 97
============================================================

Modeling Reservoir Supply 
 97 
Stockholm Environment Institute 
 
October 2023 
Supply Preferences = 1 from the Main River and 1 from Big City 
 
Do you understand why the differences in Demand Coverage occur when the Supply 
Preferences are changed? 
 
You can modify the display of preferences on the schematic by using the 
“Schematic\Change the Priority View” menu. The “View Allocation Order” option will 
display the actual priority order in which WEAP computes supply. This is a function of the 
Supply Preference of the link as well as the Demand Priority of the demand site. 
Note that you can study the impact of changing Supply Preferences, like Demand Priorities, 
by creating alternative scenarios. 
3.   Revert to original model 
You can do this using the “Revert to Version” option under the Area menu.  
Choose “Starting point for all modules after “Scenarios” module” as you did 
at the beginning of this exercise. 
Modeling Reservoir Supply 
4.   Create a Reservoir and enter the related data 
First, create a new scenario inherited from “Reference”, and name it 
“Reservoir Added.”   


============================================================
PAGE 98
============================================================

 98 
 
Refining the Supply 
October 2023 
 
 
WEAP Tutorial 
While in Manage Scenarios, highlight the High Population Growth scenario 
and uncheck the box “show results for this scenario.” This will enable WEAP 
to make calculations faster. 
 
Then add a reservoir object on the Main River upstream of Big City, and 
name it “Main River Reservoir.” Unclick the box where it asks if this object 
is active in Current Accounts. 
Leave the Demand Priority at 99 (default).  
 
 


============================================================
PAGE 99
============================================================

Modeling Reservoir Supply 
 99 
Stockholm Environment Institute 
 
October 2023 
 
Right click on Main River Reservoir and select “Edit Data.”  Select the 
“Storage Capacity” variable to enter the Data view (Make sure you have the 
“Reservoir Added” scenario selected). Once you are in the Data view, you 
will first have to click on the “Startup Year” button before you can alter any 
other parameters.  Note: you may have to click on the data tree before the 
year will save. 
Choose 2002 as the startup year for Main River Reservoir 
 


============================================================
PAGE 100
============================================================

 100 
 
Refining the Supply 
October 2023 
 
 
WEAP Tutorial 
Then click on the “Physical” button and change the following parameters: 
Storage Capacity 
70 M m3 
Note that the Scale is set to “Million” 
 
 
More details about reservoirs operation and hydropower production are provided in the 
“Reservoirs and Power Production” module of the WEAP tutorial.  
5.   Run the Model and Evaluate the Results 
Compare the Demand Site Coverage for Agriculture in the “Reference” and 
“Reservoir Added” scenarios.  
Demand Coverage: why does Agriculture have higher coverage with the Main River 
Reservoir in place? 


============================================================
PAGE 101
============================================================

Modeling Reservoir Supply 
 101 
Stockholm Environment Institute 
 
October 2023 
 
Reservoir Storage Volume: does the solution of building a reservoir appear to be sustainable? 
Use the primary variable pull down menu to select Reservoir Storage Volume (under Supply 
and Resources\Reservoir), and select “All Years” from the pull down menu at the bottom 
of the graph.  
 


============================================================
PAGE 102
============================================================

 102 
 
Refining the Supply 
October 2023 
 
 
WEAP Tutorial 
 
Flow in the River: how does having the reservoir on the Main River change the flow 
downstream compared to the Reference scenario? Select Streamflow (under Supply and 
Resources\River) from the primary variable pull-down menu and click on “Monthly 
Average.”  
 
Choose the year 2002 from the “Selected Years” option on the bottom menu, and choose 
the reach below Withdrawal Node 2 for comparison. 


============================================================
PAGE 103
============================================================

Modeling Reservoir Supply 
 103 
Stockholm Environment Institute 
 
October 2023 
 
You may want to switch to a logarithmic axis (the button is located on the 
vertical toolbar on the far right) to see more clearly the differences in flow 
upstream and downstream of the Main River Reservoir.  
 
Now select the reach below Return Flow Node 1 for comparison. Why is streamflow 
along this reach more similar for the two scenarios? 


============================================================
PAGE 104
============================================================

 104 
 
Refining the Supply 
October 2023 
 
 
WEAP Tutorial 
 
Adding Flow Requirements 
6.   Create a Flow Requirement  
Create another new scenario: “Flow Requirement Added.” This scenario is 
inherited from the “Reservoir Added” scenario. The scenario tree should look 
like the one below: 
 
The creation of a large reservoir allows storage of “excess” water during high flow periods to 
cover water demand during low flow periods. The price to pay is, however, a potentially 
large impact on the hydrological regime of the river downstream of the reservoir. The 
Return Flows from Big City and Agriculture provide the flow in the Main River during the 
spring and winter months. A reservoir’s operation variables and flow requirements can be 
used to mitigate the reservoir’s downstream impact.   


============================================================
PAGE 105
============================================================

Adding Flow Requirements 
 105 
Stockholm Environment Institute 
 
October 2023 
 
Now add a “Flow Requirement” to the Schematic view below the withdrawal 
node for the Big City, but upstream of the withdrawal node for Agriculture.  
Demand Priority  
1 (default) 
 
Right click on the Flow Requirement and select Edit Data\Minimum Flow 
Requirement. Add the value below (make sure you still have the “Flow 
Requirement Added” scenario selected): 
Minimum Flow Requirement 5 CMS 


============================================================
PAGE 106
============================================================

 106 
 
Refining the Supply 
October 2023 
 
 
WEAP Tutorial 
 
7.   Run the Model and Evaluate the Results 
Look at the results and think about the related questions. 
- How does adding the flow requirement change streamflow in the reach below the 
flow requirement?  
Compare streamflow below the flow requirement for the “Reference”, 
“Reservoir Added”, and “Flow Requirement Added” scenarios for the same 
year (2002). You should obtain a graph like the one below: 


============================================================
PAGE 107
============================================================

Adding Flow Requirements 
 107 
Stockholm Environment Institute 
 
October 2023 
 
What is the Flow Requirement coverage? 
You can view these data by selecting “Instream Flow Requirement Coverage” 
under Demand. (Switch off the logarithmic display for the y axis and select 
only the “Flow Requirement Added” scenario for viewing). 
 
Why has the coverage now changed for the Big City? 


============================================================
PAGE 108
============================================================

 108 
 
Refining the Supply 
October 2023 
 
 
WEAP Tutorial 
Select “Demand Coverage” from the primary variable pull-down menu, select 
the Big City demand site, and select the “Reference”, “Reservoir Added”, and 
“Flow Requirement Added” scenarios for viewing. 
 
Assuming this flow requirement was more important than supplying the Big City, how 
should the model be changed to ensure that the flow requirement is fulfilled? 
 
The relative level of Demand Priority for Big City, Agriculture and the Flow Requirement 
will determine which demand is covered first. To ensure that the Flow Requirement is 
covered first, change the Demand Priority of Big City to a higher number (lower priority) 
than for the Flow Requirement, since it is upstream of the Flow Requirement.  
Modeling Groundwater Resources 
8.   Create a Groundwater Resource 
Create a Groundwater node next to the City and name it “Big City 
Groundwater.” Also, make it active in Current Accounts. 


============================================================
PAGE 109
============================================================

Modeling Groundwater Resources 
 109 
Stockholm Environment Institute 
 
October 2023 
 
Give Big City Groundwater the following properties (make sure you are in 
Current Accounts when entering these data; you will know you are not if there 
is no tab for Initial Storage): 
Storage Capacity 
Unlimited (default, leave empty) 
Initial Storage 
100M m3 
Natural Recharge (use the Monthly Time Series Wizard, accessed in the field under 
“2000”) 
 
- Nov. to Feb. 
0M m3/month 
 
- Mar. to Oct.  
10M m3/month 


============================================================
PAGE 110
============================================================

 110 
 
Refining the Supply 
October 2023 
 
 
WEAP Tutorial 
 
9.   Connect Big City Groundwater with Big City 
Use a Transmission Link to connect Big City Groundwater to the Big City 
demand site and provide it with a Supply Preference of 2. 
Your model should look similar to the figure below:  
 


============================================================
PAGE 111
============================================================

Modeling Groundwater Resources 
 111 
Stockholm Environment Institute 
 
October 2023 
10.   
Update the characteristics of the Transmission Link between the 
Main River and Big City 
Change the characteristics of the Transmission Link connecting the Main 
River (Withdrawal Node 1) and Big City (make sure you are in Current 
Accounts): 
Supply Preference 
1 (default) 
Maximum Flow Volume 
6 m3/sec 
 
 
The Maximum Flow Volume or Percent of Demand parameter represents restrictions in the 
capacity of a resource (due, for example to equipment limits).  
11.   
Run the Model and Evaluate the Results 
Look at the following results and think about the related questions. 
Is the groundwater extraction required to meet demands under these conditions sustainable? 
To view these results, select “Groundwater Storage” from the pull-down 
menu under “Supply and Resources\Groundwater.” 


============================================================
PAGE 112
============================================================

 112 
 
Refining the Supply 
October 2023 
 
 
WEAP Tutorial 
 
How does the relative use of water from Big City Groundwater and the Main River evolve 
at the Big City demand site? 
To view these graphical results for Big City specifically, first select “Supply 
Delivered” under Demand using the primary variable pull-down menu. Then 
choose “All Sources” in the pull-down menu on the right side of the window 
above the graph legend. Next, select Big City as the demand site to view using 
the pull-down menu above the graph. Click on “Annual Total.” 
 


============================================================
PAGE 113
============================================================

Modeling Groundwater Resources 
 113 
Stockholm Environment Institute 
 
October 2023 
 
Groundwater recharge and interaction with rainfall and surface water can be modeled rather 
that entered as inputs. Refer to the “Hydrological Modeling” tutorial for more details.  
Other resources can be modeled using the “Other Supply” object, which is characterized by 
a monthly “production” curve. This object can be used to simulate a desalination plant or 
inter-basin transfers, for example.  


============================================================
PAGE 114
============================================================



============================================================
PAGE 115
============================================================

 
 
WEAP 
Water Evaluation And Planning System 
 
Data, Results and 
Formatting 
 
A TUTORIAL ON 
Exchanging Data .................................................. 116 
Importing Time Series ............................................ 119 
Working with Results ............................................ 123 
 
October 2023 


============================================================
PAGE 116
============================================================

 116 
 
Data, Results and Formatting 
October 2023 
 
 
WEAP Tutorial 
Note: 
For this module you will need to have completed the previous modules (“WEAP in 
One Hour, Basic Tools, and Scenarios) or have a fair knowledge of WEAP (data 
structure, Key Assumptions, Expression Builder, creating scenarios). To begin this 
module, go to the Main Menu, select “Revert to Version” and choose the version 
named “Starting point for all modules after ‘Scenarios’ module.” 
Exchanging Data 
1.   Export Data to Excel 
Export the entire model to Excel by going to the Data view and selecting 
“Edit”, “Export Expressions to Excel.”  
Export all branches, and all variables of the “Current Accounts” only (don’t 
export any of the scenarios for this example) to a new workbook. Keep other options 
at default values.  
 
 


============================================================
PAGE 117
============================================================

Exchanging Data 
 117 
Stockholm Environment Institute 
 
October 2023 
 
 
This instruction creates a new Excel workbook that contains all the variables that can be 
changed in the “Data” view, using the same structure as in the Data tree. In large models, 
you can choose to export only the current branch and/or variable. 
2.   Use Excel’s Auto Filtering Option 
In the Excel Spreadsheet that was created in the previous steps, filter the 
content to display only the “Consumption” variable.  You will probably have 
to scroll over to the right to see the column in the view. 
Use the arrow to the right of the “variable” header to unselect “select all” and the scroll 
down to select the “Consumption” variable in the drop-down list.  
 
 
Auto-filtering does not change or erase the data; it only hides the rows that are not of 
interest. Multiple filters can be used.  


============================================================
PAGE 118
============================================================

 118 
 
Data, Results and Formatting 
October 2023 
 
 
WEAP Tutorial 
3.   Modify Data 
In the Excel spreadsheet that was created in the previous steps, make the 
following changes in the yellow column (it may be good to hide a few of the 
columns so that you can see both the variable values and the Demand Sites 
to which they belong in the same view): 
Big City Consumption 
5% (value was 15 originally) 
Agriculture Consumption 
5% (value was 90 originally) 
 
 
The values entered are not meant to be representative of realistic values, just examples.  
When creating a large model, a quick way to enter a lot of data is to use the Excel Import 
and Export functions combined with the Excel lookup capabilities. This requires the user to 
have set up the model in a consistent way (data structure, names), however.  
4.   Import the Data from Excel 
Re-import the modified data in Excel. 
In WEAP, choose “Edit”, “Import Expressions from Excel…” Check that the 
Consumption data have been changed in your model.  


============================================================
PAGE 119
============================================================

Importing Time Series 
 119 
Stockholm Environment Institute 
 
October 2023 
 
 
WEAP always reads from the Excel file that had the focus last. If you have several Excel files 
open, you should ensure that the appropriate Excel file is selected before beginning the 
importation into WEAP.  
When re-importing into Excel, all rows are read, even those that are filtered out through the 
auto-filtering options.  
Importing Time Series 
5.   Create a Streamflow Gauge Object 
Add a “Streamflow Gauge” object to the model. 
Insert the Streamflow Gauge downstream of the Big City, below the return flow nodes 
for Agriculture and Big City.  


============================================================
PAGE 120
============================================================

 120 
 
Data, Results and Formatting 
October 2023 
 
 
WEAP Tutorial 
 
6.   Import Text File Data 
Import streamflow data from a comma-separated text file containing 
approximately 100 years of streamflow measurements up to 2003. To import 
the file, use the “ReadFromFile” function in the streamflow gauge’s data tab 
in the “Supply and Resources\River\Streamflow Gauges” branch of the Data 
tree.  
Type in the following function, which will read the file from a directory called 
“Additional Files” located in your area’s folder:  
“ReadFromFile(Additional Files\River_Flow.csv)” 
If WEAP cannot find the file, try searching for it using the “ReadFromFile 
Wizard” in the dropdown menu. 


============================================================
PAGE 121
============================================================

Importing Time Series 
 121 
Stockholm Environment Institute 
 
October 2023 
 
 
 
The ReadFromFile function can be used for any variable that requires a time series, monthly 
or yearly, such as headflow, groundwater recharge, etc. 
WEAP will automatically locate the correct year and month and only use that data. If you 
change the years modeled, WEAP will automatically read the correct data.  
More information about the syntax of this function and the format of the data file can be 
found in the “Read from File” help topic.  


============================================================
PAGE 122
============================================================

 122 
 
Data, Results and Formatting 
October 2023 
 
 
WEAP Tutorial 
7.   Compare the Actual and Modeled Streamflow 
Recalculate the results and compare the historical streamflow data with the 
WEAP simulated streamflow. Do this by clicking on the “Chart” tab of the 
Results view and selecting from the primary variable pull-down menu: Supply 
and Resources\River\Streamflow Relative to Gauge (Absolute).  
 
WEAP will compare the observed flow at the streamflow gauge to the nearest upstream 
node. In the case for this example, that node is Return Flow 2 (the Return Flow for 
Agriculture).  Comparing observed and simulated streamflow is one means for the user to 
assess if the model is representing the system accurately. 
Choose “Selected Years” from the pull-down menu below the chart and 
select 2000, 2001, 2002, and 2003 (the Current Accounts is 2000, and the data 
file contains no stream gauge data beyond 2003). If the results display both 
scenarios, change it to the reference scenario only with the pull-down menu 
to the right of the chart above the legend. To display the years in different 
colors, use the same pull-down menu above the legend to select “Selected 
Years.” Choose the Reference scenario. You should see the graph below: 
 
Notice that the simulated streamflow is greater than the observed streamflow 
in the Current Accounts year (2000) but is less than observed in subsequent 
years.   


============================================================
PAGE 123
============================================================

Working with Results 
 123 
Stockholm Environment Institute 
 
October 2023 
Working with Results 
8.   Create a Favorite Graph 
Create a graph of streamflow that shows both the actual flow as recorded at 
the streamflow gauge and the simulated streamflow at the appropriate node 
upstream of the streamflow gauge (in this example, below Return Flow Node 
2). First, select “Streamflow” from the primary variable pull-down menu. 
Then select “7 \ Streamflow gauge (gauge)” and “8 \ Reach” from the list 
that appears when you choose “Selected Main River Nodes and Reaches” 
from the drop-down menu of the Supply and Resources\River\Streamflow 
chart above the graph legend (see below). Finally, select the years 2000, 2001, 
2002, and 2003 to be represented in the graph using the pull-down menu at 
the bottom of the window.  
Save this graph as a favorite by using the “Favorite”, “Save Chart as Favorite” 
option. Name the file “Simulated and Observed Streamflow Comparison.” 
 
 
From this point forward, the chart will appear in the list of favorite charts of the Results 
view.  
You can also export the data to Excel or to the clipboard, change the format and the display 
of figures and charts, calculate statistics, group series with the smallest values, etc. from the 
toolbar located at the right of the “Results” view.  


============================================================
PAGE 124
============================================================

 124 
 
Data, Results and Formatting 
October 2023 
 
 
WEAP Tutorial 
9.   Create an Overview 
An overview displays important charts in the Scenario View like a dashboard. 
Create an “Overview” displaying the streamflow, inflow, and outflow to area 
charts.  
Select the “Scenario Explorer” view. Click “Manage.” In the window that appears, 
select “Inflows to Area”, “Outflows from Area” and the Favorite graph created in the 
previous step.  
 
 
Overviews can be created from any combination of favorites, but the charts need to be 
created in the “Results” view prior to their integration in an overview. The data underlying 
overviews can also be displayed in tabular format (select the “Table” tab) and exported to 
Excel.  
10.   
Use the Dynamic Map 
Dynamic Results Maps are a quick way to obtain an overview of the results 
in their temporal context. In the “Results” view, select the “Map” tab and 
play with the time slider at the bottom of the display to see how the displayed 
parameters change.   
Try this by selecting the Main River’s streamflow.  


============================================================
PAGE 125
============================================================

Working with Results 
 125 
Stockholm Environment Institute 
 
October 2023 
 
Note that as you pull the slider across the bar, an indicator appears in the 
graph above the bar to indicate the data selected (for this example, the year 
2004 annual total is selected). In the smaller schematic view at the top of the 
window, the width of the river will increase and decrease with the changing 
data, and numerical values appear for each of the reaches. 
11.   
Export Results to Excel 
All results can be readily exported to Excel from the “Results” view. A new 
workbook is created that contains the results in table format, with the same 
structure as in WEAP.  
Recall the favorite graph you have created a few steps before by selecting it in the “Favorite” 
menu of the Results View. Export the related data to Excel by switching to the “Table” 
tab and hitting the “Export Table to Excel” button (
) to the right of the screen.  
12.   
Calculate Statistics 
You can generate statistics in the Results view for any table. Under “Charts”, 
display the Reference Scenario Streamflow (annual total) for all reaches of the 
Main River for all years. Now click on the Table tab and then click on the 
“Stat” icon on the right vertical menu bar. 


============================================================
PAGE 126
============================================================

 126 
 
Data, Results and Formatting 
October 2023 
 
 
WEAP Tutorial 
 
We are provided with statistical values of Min, Max, Mean, Standard 
Deviation (SD) and Root Mean Square (RMS). 
 
 


============================================================
PAGE 127
============================================================

Formatting 
 127 
Stockholm Environment Institute 
 
October 2023 
Formatting 
13.   
Change the Appearance of a Background Vector Layer 
In the Schematic View, change the color of the polygon for Big City by right-
clicking the “Cities” layer in the box below the Element Selection box (see 
example below), and selecting “Edit.”   
 
In the window that appears, click on the Appearances tab, then click on the 
“Fill Color” field. A color palette will appear. 
Change the Background color to orange. 
 


============================================================
PAGE 128
============================================================

 128 
 
Data, Results and Formatting 
October 2023 
 
 
WEAP Tutorial 
 
 
 
Background vector data can be added by clicking “Add Vector Layer.” WEAP reads vector 
information in the SHAPEFILE format. This format can be created by most GIS software.  
A large amount of georeferenced data (both in vector and raster format) is available on the 
Internet, sometimes for free; websites such as www.geographynetwork.com or 
www.terraserver.com provide good starting points for a search. Keep in mind that some of 
the downloadable data might need GIS processing before being usable in WEAP, especially 
to adapt the projection and/or coordinate system. 


============================================================
PAGE 129
============================================================

Formatting 
 129 
Stockholm Environment Institute 
 
October 2023 
14.   
Label a Vector Layer 
You can edit the labels for the layers - right click on the “Rivers Polygons” 
layer in the box to the right of the schematic, select “Edit” and choose the 
“Label” tab. You can also change the size of the labels in this tab by going to 
the Size field at the bottom of the window. 
 
You can also hide layers in the Schematic view by clicking in the small box to 
the left of the layer name (this makes the check mark disappear also). 
15.   
Add a Raster Layer 
In the Schematic view, add a background map of the Big City region by right-
clicking in the Layer window (see example below) and selecting “Add Raster 
Layer.” 


============================================================
PAGE 130
============================================================

 130 
 
Data, Results and Formatting 
October 2023 
 
 
WEAP Tutorial 
 
Select the file “Map.jpg” located in the “_Maps\Tutorial” subdirectory of the WEAP 
directory (e.g., C:\Program Files\WEAP21\_Maps\Tutorial). Also enter a 
descriptive name to appear in the Layer window.  
 


============================================================
PAGE 131
============================================================

Formatting 
 131 
Stockholm Environment Institute 
 
October 2023 
 
Your map may show up as the first item in the window, placing it on top of 
the other vectors and shapes. 
 
We want to see the rivers and roads. You can rearrange the schematic layers. 
Do this by right clicking on a layer and selecting “Move Up” or “Move Down.” 


============================================================
PAGE 132
============================================================

 132 
 
Data, Results and Formatting 
October 2023 
 
 
WEAP Tutorial 
 
After you have moved your layers, your model should look like so: 
 
 
 
WEAP uses a “world file” to correctly position your raster file for a specific map projection. 
Those files define the coordinate of one of the corners of the raster and the cell size. They 
can be created by many standard GIS programs such as ArcView.  
The world file must have the same name as the raster file with a “w” added to its extension 
and be in the same directory. For example, the world file for the above file is called 
“map.jgw.” 


============================================================
PAGE 133
============================================================

Formatting 
 133 
Stockholm Environment Institute 
 
October 2023 
16.   
Move Labels 
Complete the formatting of your area by changing the node and label font 
size and moving around labels. 
Under the Schematic pull-down menu, the “Set WEAP Node Size” and “Set WEAP 
Node Label Size” menu options can be used to change the size of symbols and labels. 
For each of these actions, a window with a slider will appear for increasing and decreasing 
the size of these elements. 
 
 


============================================================
PAGE 134
============================================================

 134 
 
Data, Results and Formatting 
October 2023 
 
 
WEAP Tutorial 
Right-Click on any object and select “Move Label” to move its label.  
 
 
If you don’t want a label to appear for a given object, just right-click that object, select 
“General Info” and delete the optional label text.  
You can copy your map to the clipboard for later use in reports and presentations by 
selecting “Copy Schematic to Clipboard…” in the “Schematic” menu. The file size 
indicated in the dialog box corresponds to an uncompressed format. It is usually safe to go 
with the default level of detail.  


============================================================
PAGE 135
============================================================

 
 
WEAP 
Water Evaluation And Planning System 
 
Reservoirs and 
Power Production 
 
A TUTORIAL ON 
Modeling Reservoir Operation ................................. 136 
Adding Hydropower Computation .......................... 140 
Modeling Run-of-River Power Plants ...................... 143 
 
October 2023 
 
 
 
 
 
 
 


============================================================
PAGE 136
============================================================

 136 
 
Reservoirs and Power Production 
October 2023 
 
 
WEAP Tutorial 
Note: 
For this module you will need to have completed the previous modules (“WEAP in 
One Hour, Basic Tools, and Scenarios) or have a fair knowledge of WEAP (data 
structure, Key Assumptions, Expression Builder, creating scenarios). To begin this 
module, go to the Main Menu, select “Revert to Version” and choose the version 
named “Starting point for all modules after ‘Scenarios’ module.” 
Modeling Reservoir Operation 
1.   Create a Reservoir 
Create a Reservoir on the Lake located upstream of the Big City’s withdrawal 
from Main River.  Name it “Big City Reservoir” and leave it active in Current 
Accounts.  
Demand Priority 
99 (default) 
 
Entering a Demand Priority of 99 ensures that the reservoir will only fill if all other needs are 
fulfilled, including downstream demand.   
2.   Enter the Physical Data 
Right click on Big City Reservoir to edit data. Enter the following data in the 
“Physical” window (make sure you are in Current Accounts). 
Storage Capacity 
70 M m3 
Initial Storage 
25 M m3 
Volume Elevation Curve 
 
Volume 
Elevation 
 
M m3 
m 
 
0.0 
190 
 
30.0 
210 
 
70.0 
216 
Net Evaporation 
25 mm/month (note that it defaults to monthly measurements) 


============================================================
PAGE 137
============================================================

Modeling Reservoir Operation 
 137 
Stockholm Environment Institute 
 
October 2023 
 
 
 
The “Volume Elevation Curve” is used both to model the surface for evaporation and to 
compute the head in case hydropower production is simulated. A cylindrical shape is 
assumed in converting reservoir volume and elevation into reservoir area.  
 
 
 
Net evaporation needs to account for both rainfall and evaporation. It can therefore be a 
positive or a negative number; monthly variations can be modeled using the “Monthly Time 
Series Wizard.”  
Area 
Elevation 
{Volume} 


============================================================
PAGE 138
============================================================

 138 
 
Reservoirs and Power Production 
October 2023 
 
 
WEAP Tutorial 
3.   Enter the Operation Data 
In the same view, enter the following data in the “Operation” window.  
Top of Conservation 
60 M m3 
Top of Buffer 
40 M m3 
Top of Inactive 
5 M m3 
Buffer Coefficient 
1.0 
 
 
As illustrated by the figure to the 
left, WEAP allows the modeling of 
advanced reservoir operation 
through the definition of several 
zones that have different 
operational constraints.  
More can be learned through the 
Help file’s “Reservoir Zones and 
Operation” screen or by clicking 
on the help button when in the 
Reservoir’s Operation tab.  
4.   Understanding the Impact of the Buffer Coefficient 
Now create a new scenario inherited from the “Reference” scenario. Name 
this scenario “Buffer Coefficient Changes.”  Then go back to the Data view 
(make sure that you are in the new scenario you just created) and change the 
buffer coefficient to 0.1. Click on results to run the new model.  


============================================================
PAGE 139
============================================================

Modeling Reservoir Operation 
 139 
Stockholm Environment Institute 
 
October 2023 
Compare, for the “Reference” and “Buffer Coefficient Changes” scenarios, 
the results for “Reservoir Storage Volume”, found under the “Supply and 
Resources\Reservoirs” branch of the primary variable pull-down menu. 
Select “All Years” from the pull-down menu at the bottom of the graph and 
click on “Monthly Average” at the top of the graph. Choose the “Reference” 
scenario and “Buffer Coefficient Changes” scenario for viewing from the 
pull-down menu above the legend.  You can choose “Big City Reservoir” 
from the pull-down menu directly above the graph. 
 
Also compare results also for Demand Coverage (under the Demand branch).  
Select the “Reference” and “Buffer Coefficient Changes” scenarios from the 
pull-down menu above the graph legend. Select “Big City” as the demand site 
for viewing from the remaining pull-down menu directly above the graph. 


============================================================
PAGE 140
============================================================

 140 
 
Reservoirs and Power Production 
October 2023 
 
 
WEAP Tutorial 
 
 
The Buffer Coefficient provides a way to regulate water releases when the water level in the 
reservoir is within the buffer zone (see figure in the information box of the previous step). 
When this occurs, the monthly release cannot exceed the volume of water in the buffer zone 
multiplied by this coefficient. In other words, the buffer coefficient is the fraction of the 
water in the buffer zone available each month for release. Thus, a coefficient close to 1.0 will 
cause demands to be met more fully while rapidly emptying the buffer zone, while a 
coefficient close to 0 will leave demands unmet while preserving the storage in the buffer 
zone. This is why lower Demand Site Coverage is observed for results in the “Buffer 
Coefficient Changes” scenario above. 
Adding Hydropower Computation 
5.   Understanding the way WEAP models Power Production 
WEAP can model Power Production in three different ways: through on-line 
reservoirs, through off-line reservoirs, and through run-of-river hydropower 
plants. In a later module, we will also discuss linking WEAP with a Low 
Emissions Analysis Platform (LEAP) energy modeling software. 
Refer to the help for more information on each category.  
6.   Add Power Production Capabilities to Big City Reservoir 
In this example we will model an operating reservoir power plant. Enter the 
following data under the “Hydropower” window for Big City Reservoir in the 
Current Accounts.  


============================================================
PAGE 141
============================================================

Adding Hydropower Computation 
 141 
Stockholm Environment Institute 
 
October 2023 
Max Turbine Flow 
80 CMS 
Tailwater Elevation 
195m 
Plant Factor 
100% 
Generating Efficiency 
60% 
 
 
Look at the “Hydropower Calculations” help topic for more information about how WEAP 
computes power production.  
7.   Compute Hydropower Production and Understand the Results 
Run the model and look at the results in the Reference scenario for power 
production for the year 2000.  
The results can be accessed under the Primary Variable pull-down menu under “Supply 
and Resources/Reservoir/Hydropower.”  


============================================================
PAGE 142
============================================================

 142 
 
Reservoirs and Power Production 
October 2023 
 
 
WEAP Tutorial 
 
Do you understand why production levels between May and June are so similar, even though 
flow in Main River and downstream water release is much greater in June? To confirm this, 
look at the results for “Streamflow” in the reach above Big City Reservoir (Below Main 
River Headflow). 
 


============================================================
PAGE 143
============================================================

Modeling Run-of-River Power Plants 
 143 
Stockholm Environment Institute 
 
October 2023 
 
The streamflow that can be processed by the turbine has been capped to 80CMS (see 
previous step), meaning that even though there is a higher discharge in June, the excess 
quantity flows downstream without going through the turbine.  Hydropower in June would 
be the same for May and June if not for the fact that the Storage Elevation in Big City 
Reservoir was slightly lower at the end of April than it was at the end of May (look at the 
Storage Elevation results to confirm this - these numbers represent the status at the end of 
each month indicated).  This effect was slightly offset by the fact that May has 31 days to 
produce power, whereas June has 30 days, but June still ended up having slightly higher 
total production.  
Off-line, “local” reservoirs’ hydropower production can be modeled in the same way. 
Modeling Run-of-River Power Plants 
8.   Create a Run-of-River Hydro Object  
Create a Run-of-River Hydro Object on the Main River upstream of the Big 
City Reservoir created in the previous exercise. Name it “Big City Run of 
River.” 
 
Enter the following data in the “Supply and Resources\River\Run of River 
Hydro” branch of the Data tree in the Data View: 
Max Turbine Flow 
80 CMS 
Plant Factor 
100% 
Generating Efficiency 
60% 
Fixed Head 
19.5 m 


============================================================
PAGE 144
============================================================

 144 
 
Reservoirs and Power Production 
October 2023 
 
 
WEAP Tutorial 
 
9.   Run and Compare Results 
Run your model and create a graph comparing the power production for the 
run-of-river and the reservoir power plants. Do this by selecting “All 
Hydropower” from the pull-down menu above the legend. 
What are the reasons for the differences between both curves? 
 


============================================================
PAGE 145
============================================================

Modeling Run-of-River Power Plants 
 145 
Stockholm Environment Institute 
 
October 2023 
 
Note that the Run of River hydropower is slightly higher in May than June, in contrast to 
Big City Reservoir power production. This is due to the additional day available in May 
compared to June.  Run of River hydropower production does not have Storage Elevation as 
limiting effect, whereas the Reservoir was still filling in May, which decreased the Reservoir 
production for that month compared to June.  
How does the run-of-river plant influence the streamflow of the river, when compared 
to the Big City Reservoir plant? 
To view this on the chart, select “Streamflow” from the primary variable pull-
down menu and choose “Selected Main River Nodes and Reaches” from the 
pull-down menu above the legend. Select the following reaches: 
“0\Headflow”, “1\Big City Run of River”, “2\Reach”, “2\Big City 
Reservoir”, and “4\Reach” from the list. 
 
We view the results (below) on a logarithmic scale, accessed by clicking on 
the “Log” icon on the bar on the right. 


============================================================
PAGE 146
============================================================

 146 
 
Reservoirs and Power Production 
October 2023 
 
 
WEAP Tutorial 
 
 
A reservoir can store water during high flows and release during low flow, thus having a 
smoothing effect.  A run-of-river operation, however, processes whatever water flows in the 
river at any given point in time. Therefore, it does not affect the shape of the streamflow 
curve.  
 


============================================================
PAGE 147
============================================================

 
 
WEAP 
Water Evaluation And Planning System 
 
Water Quality 
 
A TUTORIAL ON 
Setting up Quality Modeling ................................... 148 
Entering Water Quality Data ................................ 150 
Using Water Quality Inflow Constraints for a 
Demand Site ......................................................... 156 
Entering Pollution Generating Activity for 
Demand Sites ........................................................ 158 
Modeling a Wastewater Treatment Plant ................ 162 
 
October 2023 
 
 
 


============================================================
PAGE 148
============================================================

 148 
 
Water Quality 
October 2023 
 
 
WEAP Tutorial 
Note: 
For this module you will need to have completed the previous modules (“WEAP in 
One Hour, Basic Tools, and Scenarios) or have a fair knowledge of WEAP (data 
structure, Key Assumptions, Expression Builder, creating scenarios). To begin this 
module, go to the Main Menu, select “Revert to Version” and choose the version 
named “Starting Point for all modules after ‘Scenarios’ module.”  
Setting up Quality Modeling 
1.   Understanding Water Quality Modeling in WEAP 
WEAP can model both conservative and non-conservative pollutants. 
Conservative pollutants are modeled through a simple mass balance. Several 
models are offered for non-conservative pollutants.  
Read the Water Quality “Getting Started” help topic for a more detailed description of 
WEAP capabilities.  
2.   Create a Set of Pollutants 
Create a set of pollutants that will be modeled by going to the 
“General\Water Quality Constituents” menu.  
 


============================================================
PAGE 149
============================================================

Setting up Quality Modeling 
 149 
Stockholm Environment Institute 
 
October 2023 
In the dialog box, choose “Temperature” to be calculated by temperature 
modeled in WEAP, under the “Calculated By” down. 
 
Next, add “TSS” (Total Suspended Solids) and “Salt” to the list of 
constituents (“BOD” and “DO” should also already be listed): 
Name 
Calculate by 
Decay Rate 
Temperature 
Temperature (Modeled in WEAP) 
TSS 
First-order Decay 
0.25 per day 
Salt 
Conservative (No Decay) 
 


============================================================
PAGE 150
============================================================

 150 
 
Water Quality 
October 2023 
 
 
WEAP Tutorial 
 
 
More details are provided on the different models used for BOD and DO models in the 
“Dissolved Oxygen and Biochemical Oxygen Demand” help topic.  
Entering Water Quality Data 
3.   Enter River Water Quality data 
In the Data view tree, select “Supply and Resources\River” and click on the 
Main River. Then open the “Water Quality” screen and enter the following 
data, which will represent water quality at the headflow of the river:  
Model Water Quality? 
YES (check the box) 
Temperature 
15°C 
BOD concentration 
5mg/l 
DO concentration 
8mg/l 
TSS concentration 
20mg/l 
Salt concentration 
2mg/l 


============================================================
PAGE 151
============================================================

Entering Water Quality Data 
 151 
Stockholm Environment Institute 
 
October 2023 
 
 
4.   Enter River Geometric Characteristics 
River geometric characteristics are needed for the various water quality 
models. They are mainly used to compute velocity/residence time of the 
water along a reach. In the Data view, select the “Reaches” branch of the 
Main River and enter the following information under the “Physical” tabs.  


============================================================
PAGE 152
============================================================

 152 
 
Water Quality 
October 2023 
 
 
WEAP Tutorial 
Headflow Distance Marker 
0 km 
Tailflow Distance Marker 300 km  
Note: intermediate reach lengths will be estimated by WEAP based on the 
schematic.  
 
In the Flow Stage Width tab,use the Wizard by clicking on the drop-down arrow  
for “Below Main River Headflow” to enter the following data: 
 
Flow 
Stage 
Width 
 
0 
0.00 
 0.00 
 
10 
3.00 
 15.00 
 
50 
5.00 
 26.00 
 
100 
7.00 
 35.00 
 
200 
9.00 
 40.00 
Your final formula should read: 
FlowStageWidthCurve(0,0,0,  10,3,15,  50,5,26,  100,7,35,  200,9,40 ) 
We will assume this section remains constant and leave other reaches empty.  


============================================================
PAGE 153
============================================================

Entering Water Quality Data 
 153 
Stockholm Environment Institute 
 
October 2023 
  
 


============================================================
PAGE 154
============================================================

 154 
 
Water Quality 
October 2023 
 
 
WEAP Tutorial 
  
 
The “Reach Length” tab displayed under the “Inflows and Outflows” category is used only 
for modeling surface water-groundwater interactions. It represents the length of the reach 
connected to the groundwater, which may be less than the total length of that reach.  
5.   Enter the Climatic Data 
Climatic Data are needed to compute water temperature. Click on the 
“Climate” button and again select the “Below Main River Headflow” reach. 
Enter the following climate data (for air temperature, use the Monthly Time 
Series Wizard): 
Air Temperature 
 
Month 
Value (°C) 
 
Jan 
 
10 
 
Feb 
 
11 
 
Mar 
 
13 
 
Apr 
 
15 
 
May 
 
21 
 
Jun 
 
24 
 
Jul 
 
29 
 
Aug 
 
31 
 
Sep 
 
28 
 
Oct 
 
20 
 
Nov 
 
16 
 
Dec 
 
12 


============================================================
PAGE 155
============================================================

Entering Water Quality Data 
 155 
Stockholm Environment Institute 
 
October 2023 
 
Humidity 
65% 
Wind 
1 m/s 
Cloudiness Fraction 
1  
Latitude 
30° 
Note: you can enter these values for the first reach and leave the other reaches blank 
if you want the value to apply to all reaches. 
 


============================================================
PAGE 156
============================================================

 156 
 
Water Quality 
October 2023 
 
 
WEAP Tutorial 
Using Water Quality Inflow Constraints for a 
Demand Site 
6.   Enter Constraint Data 
A demand site may require that its water supply meets certain quality criteria.  
Create a new scenario inherited from the “Reference” scenario and name it 
“Big City Water Quality Inflow Constraints.”  In the Data view (make sure 
you are in this new scenario), select the Big City branch of the data tree, and 
click on the “Water Quality” button. Under the “BOD Inflow” tab, enter the 
following maximum allowed concentration of BOD: 
BOD inflow 
2 mg/L 
7.   Compare Results 
Note that you earlier entered a BOD concentration (5 mg/L) for the Main 
River Headflow (under Current Accounts), so you can now run the results 
and compare the output for Big City Demand Site Coverage, with and 
without this inflow constraint for Big City.  For the period 2000 and 2001, a 
comparison of Big City Demand Site Coverage for the “Reference” and “Big 
City Water Quality Inflow Constraints” scenarios should look like the 
following: 
 


============================================================
PAGE 157
============================================================

Using Water Quality Inflow Constraints for a Demand Site 
 157 
Stockholm Environment Institute 
 
October 2023 
Why does Big City Coverage drop to zero during June, 2001, in the Inflow 
Constraint scenario? 
 
If you look at the BOD concentration (Water Quality, River Water Quality) in the “Below 
Main River Headflow” reach (pictured below), you will see that BOD rises above the 
constraint (2 mg/L) for Big City intake during the month of June for both 2000 and 2001. 
Since the constraint is activated during the scenario period (starting in 2001), coverage for 
Big City decreases during June 2001, because this demand site will not accept water that 
falls below the BOD constraint, and no other sources of water other than the Main River 
have been designated as supplies for Big City. 
 
 
The simulated temporal pattern of the BOD concentration along this reach of the Main 
River is a function of degradation, the extent of which is controlled by the residence time of 
the water in the “Headflow” reach. The longer the residence time in this reach, the more 
degradation that occurs. The pattern for BOD thus mirrors that of the flow velocity, and 
streamflow, for the reach (both pictured below). 


============================================================
PAGE 158
============================================================

 158 
 
Water Quality 
October 2023 
 
 
WEAP Tutorial 
 
 
Entering Pollution Generating Activity for 
Demand Sites 
8.   Entering Data 
We will assume that we know the concentration of pollutants in the outflow 
(Return Flow) for Big City. Hence, we will use the “Concentration” series of 


============================================================
PAGE 159
============================================================

Entering Pollution Generating Activity for Demand Sites 
 159 
Stockholm Environment Institute 
 
October 2023 
tabs in the “Demand Sites\Big City” branch of the Data tree. Click on the 
“Water Quality” button and enter the following data (in Current Accounts): 
Temperature 
16 °C 
BOD Concentration 
60 mg/l 
DO Concentration 
3 mg/l 
TSS Concentration 
5 mg/l 
Salt Concentration 
10 mg/l 
 
For the Agriculture demand site, we will admit that we do not know the 
concentration at the outflow, but we do know the pollutant generation 
intensity. Enter the following data: 
BOD intensity 
50 kg/ha 
DO Intensity 
30 kg/ha 
TSS Intensity 
20 kg/ha 
Salt Intensity 
2 kg/ha 
Temperature 
15°C 


============================================================
PAGE 160
============================================================

 160 
 
Water Quality 
October 2023 
 
 
WEAP Tutorial 
 
 
Pollution outflow from a demand site is only based on each demand site’s pollutant 
concentration or intensity data, not on the water quality of the inflow to the demand site. 
Note that temperature data can change over time. 
9.   Evaluate the Results 
Run the model and look at the following results for various water quality 
constituents for the year 2000. Select “Pollution Generation” from the 
primary variable pull-down menu (under Water Quality):  
Demand Site Pollution Generation 
River Water Quality (here we switched the colors to “Mac” in the colors option on 
the bar on the right of the screen) 


============================================================
PAGE 161
============================================================

Entering Pollution Generating Activity for Demand Sites 
 161 
Stockholm Environment Institute 
 
October 2023 
 
 
Note that Pollution Generation for Agriculture is confined to the spring and 
summer months when farming is active. 


============================================================
PAGE 162
============================================================

 162 
 
Water Quality 
October 2023 
 
 
WEAP Tutorial 
Modeling a Wastewater Treatment Plant 
10.   
Create a Wastewater Treatment Plant 
Create a new scenario named “Wastewater Treatment Plant Added”- this 
scenario is inherited from the “Reference.” Then, add a Wastewater 
Treatment Plant for Big City, name it “Big City WWTP” and make it inactive 
in Current Accounts, and create a Return Flow Link from the Big City to the 
WWTP. Keep the existing Return Flow Link from Big City to the river. Also 
create another return flow from the WWTP to the river. Your model should 
look similar to the figure below:  
 
You will have to set the “Return Flow Routing” variables for both links.  
For the Return Flow from Big City to Main River (Return Flow Node 1), set the 
Routing to 100% for the Current Accounts year and 0% for years 2001-2015 in 
the “Wastewater Treatment Plant Added” scenario.   


============================================================
PAGE 163
============================================================

Modeling a Wastewater Treatment Plant 
 163 
Stockholm Environment Institute 
 
October 2023 
 
For the Return Flow from Big City to the Big City WWTP, set the Return Flow 
to 100% for the years 2001-2015 in the  “Wastewater Treatment Plant Added” 
scenario. Set the return flow to zero in the Current Accounts. Even though it does 
not yet exist, WEAP will give you errors if the percentages don’t add up to 100% 
between existing and non-existing infrastructure. See below. 
  
Also set the Routing to 100% for the Return Flow from the Big City WWTP to the 
Main River (Return Flow Node 3). (In Wastewater Treatment Plant Added scenario) 


============================================================
PAGE 164
============================================================

 164 
 
Water Quality 
October 2023 
 
 
WEAP Tutorial 
 
 
You also have the possibility to set removal rates in the various return flows. This would be 
useful if, for example, a given pollutant is decomposed by bacteria in the sewer system. 
These data can be entered under the “Water Quality\Pollutant Decrease in Return Flow” 
branches for the appropriate return flows (see figure below for example). 
 


============================================================
PAGE 165
============================================================

Modeling a Wastewater Treatment Plant 
 165 
Stockholm Environment Institute 
 
October 2023 
11.   
Enter WWTP Data 
First, enter the “Start Year” by clicking on the “Start Year” button under the 
“Water Quality\Wastewater Treatment” branch of the data tree for Big City 
WWTP.  Make sure you hit the enter key after entering 2001. 
Start Year  
2001 
 
Also enter the following data under the “Treatment” category (with the 
“Wastewater Treatment Plant Added” scenario selected): 
Consumption 
5% 
Daily Capacity 
2M m3 
BOD Removal 
90% 
DO Concentration 
5mg/l 
TSS Removal 
80% 
Salt Removal 
20% 
Temperature 
15°C 


============================================================
PAGE 166
============================================================

 166 
 
Water Quality 
October 2023 
 
 
WEAP Tutorial 
 
 
If only part of the wastewater is treated through the WWTP, there are two modeling 
possibilities. One is to limit the Daily Capacity to whatever amount can actually be treated. 
In this case the wastewater in excess will be discharged without treatment. In this case, the 
share of untreated wastewater is not constant, but depends on the total flow.  
Another solution is to create an additional return flow going from the demand site straight 
to the river, by-passing the WWTP. In this case, a constant share can be set to by-pass the 
WWTP by setting the return flow routing shares accordingly. A combination of both 
methods is also possible.  
12.   
Evaluate the Results 
Run the model and look at the following results for BOD in the “Wastewater 
Treatment Plant Added” scenario, comparing them with the “Reference” 
scenario values (without a wastewater treatment plant).  
RiverWater Quality (BOD downstream of Big City’s outflow into the river).  
To view these results, first select “River Water Quality” under “Water Quality” 
in the primary variable pull-down menu. Then choose “Selected Scenarios” 
under the pull-down menu above the chart legend and select the “Reference” 
and “Wastewater Treatment Plant Added” scenarios.  
Using the pull-down menu at the bottom of the chart, select the years 2000 
and 2001 for viewing. Select “Below Return Flow Node 3” (Return Flow 
Node 3 is the return flow for the WWTP, so you will be looking at water 
quality in the river just downstream of the outflow from the WWTP) as the 
Main River reach to view. Select “BOD” as the water quality constituent from 


============================================================
PAGE 167
============================================================

Modeling a Wastewater Treatment Plant 
 167 
Stockholm Environment Institute 
 
October 2023 
the pull-down menu directly above the chart and unclick the “Monthly 
Average” button to the far right. Your screen should look like the one below: 
 
 
Note that BOD levels decrease substantially in 2001 compared to 2000 in the reach below the 
return flow from the treatment plant because the plant becomes active that year.  
WEAP can also display water quality results from upstream to downstream.   
From the bottom menu, choose “All Main River Nodes and Reaches” and 
check “Represent true relative distance?”  This will show all nodes and 
reaches along the X-axis, with their spacing proportional to their distance 
downstream (distances shown in parentheses).  Select July 2010, as the month 
and year.  For the chart type, select “Line.”   
The chart shows that BOD levels rise as BOD-laden return flows enter the 
river, and decline as the BOD decays as it moves downstream.  The effect of 
the wastewater treatment plant can be clearly seen.  Your chart should look 
like this: 


============================================================
PAGE 168
============================================================

 168 
 
Water Quality 
October 2023 
 
 
WEAP Tutorial 
 
Wastewater Treatment Plant Inflows and Outflows. 
Select “Wastewater Treatment Plant Inflows and Outflows” (under Water 
Quality) from the primary variable pull-down menu and the “Wastewater 
Treatment Plant Added” scenario from the upper left menu. View “All 
Months (12)” and in the second icon on the menu bar, select stacked bars. 
 
 
In this type of chart, the outflows are represented as negative values and inflows are positive 
values.  Note also that the “Lost in Treatment” category represents the flow that is 
consumed; a consumption rate of 5% was input in the data view for the treatment plant. 


============================================================
PAGE 169
============================================================

 
 
WEAP 
Water Evaluation And Planning System 
 
Linking WEAP to 
QUAL2K 
 
A TUTORIAL ON 
Linking to QUAL2K .......................................... 170 
Running Scenarios ................................................. 176 
 
October 2023 
 
 
 
 


============================================================
PAGE 170
============================================================

 170 
 
Linking WEAP to QUAL2K 
October 2023 
 
 
WEAP Tutorial 
Note: 
For this module you will need to have completed the previous modules (WEAP in 
One Hour, Basic Tools, Scenarios, and Water Quality) or have a fair knowledge of 
WEAP (data structure, Key Assumptions, Expression Builder, creating scenarios). 
To begin this module, go to the Main Menu, select “Revert to Version” and choose 
the version named “Starting point for ‘Water Quality with QUAL2K’.” This version 
enacts necessary files to complete this module. 
Linking to QUAL2K 
1.   Using QUAL2K for Water Quality Modeling in WEAP 
In addition to using WEAP’s in-built capacity for water quality modeling, it 
is possible to use the US EPA QUAL2K modeling framework. This module 
demonstrates how to use the WEAP/QUAL2K interface, taking the Water 
Quality module as a starting point. This module is not an introduction to 
QUAL2K, which requires specialized knowledge, but if you are already using 
QUAL2K, you should be able to link your QUAL2K file to WEAP after this 
module. 
 
QUAL2K is a 1-dimensional, steady state, instream water quality model for well mixed 
channels (laterally and vertically). Constituents modeled include: ammonia, nitrate, organic 
and inorganic phosphorous, algae, sediment, pH and pathogens.  QUAL2K was developed 
by Dr. Steve Chapra and his grad students at Tufts University.  This module is not an 
introduction to QUAL2K. Considerable work is required outside of WEAP to calibrate and 
prepare a QUAL2K file. Refer to the QUAL2K manual for more information. Visit 
http://www.epa.gov/athens/wwqtsc/html/qual2k.html to download or for more 
information. 
2.   Differences Between QUAL2K and WEAP 
QUAL2K and WEAP are compatible in their general approach to water 
quality modeling, but they do some things differently. The important 
differences are: 
• QUAL2K measures distance along a reach from the tail of the reach, while 
WEAP measures distance from the head. 
• QUAL2K allows for diurnal variations in water quality and climate, while 
WEAP applies the same value to all times of day. 
• WEAP is more tolerant of zero or missing values than is QUAL2K. 


============================================================
PAGE 171
============================================================

Linking to QUAL2K 
 171 
Stockholm Environment Institute 
 
October 2023 
• QUAL2K and WEAP use different climate parameters. For example, 
QUAL2K uses dew point, while WEAP uses humidity. 
• QUAL2K models many more constituents in much more detail, including 
two separate CBOD constituents, ammonia, nitrate, organic and inorganic 
phosphorous, 
algae, 
sediment, 
pH 
and 
pathogens 
(see 
http://www.epa.gov/athens/wwqtsc/html/qual2k.html for more details). 
QUAL2K and WEAP are similar in that each treats a river as a sequence of 
reaches, not necessarily of equal lengths. However, the reach boundaries as 
defined in QUAL2K and in WEAP need not match. Where reach boundaries 
do not match, WEAP handles the task of mapping water quality and climate 
variables, based on distance markers. 
Reservoirs present special challenges for water quality modeling. WEAP 
includes reservoirs, but not for water quality, while QUAL2K includes weirs, 
but they are not operated. It is recommended that rivers with reservoirs not 
be linked to QUAL2K, or that they be modeled in two sections—above the 
reservoir and below the reservoir. 
3.   Link Pollutants to QUAL2K 
This module uses the final result from the previous Water Quality module as 
a starting point. Open the WEAP tutorial (by selecting Area \ Open 
\ Tutorial from the menu), then selecting Area \ Revert to Version \Starting 
point for ‘Water Quality’ from the menu. 
Once the file is ready, change the water quality constituents to point to 
QUAL2K.  
From the menu, select “General | Water Quality Constituents.” 
For all of the constituents except Salt, select “Modeled in QUAL2K” in the 
“Calculated By” drop-down. 
Link each constituent in WEAP (except salt) to a corresponding QUAL2K 
constituent: “Temperature” → “Temperature”, “BOD” → “CBOD fast”, “DO” 
→ “Dissolved Oxygen”, “TSS” → “Inorganic Solids.” 
Salinity is not directly modeled in QUAL2K, so it is not linked to a QUAL2K 
constituent in this example.  QUAL2K instead models conductivity, which is 
an easily measured indicator of salinity. 


============================================================
PAGE 172
============================================================

 172 
 
Linking WEAP to QUAL2K 
October 2023 
 
 
WEAP Tutorial 
 
Next, search for a QUAL2K data file (a file ending in .q2k). 
Look for the new drop-down labeled “QUAL2K Data File (.q2k)” that has appeared 
at the bottom left of the Water Quality Constituents dialog. 
Select “< Copy file from another directory >” from the drop-down. 
Search the Tutorial\Additional Files for the file “Main_River_Tutorial.q2k.”  If you 
want to view the QUAL2K file, click the “View” button to open it in the QUAL2K-
formatted Excel spreadsheet. 
The Water Quality Constituents Dialog should now look like the following: 


============================================================
PAGE 173
============================================================

Linking to QUAL2K 
 173 
Stockholm Environment Institute 
 
October 2023 
 
 
The QUAL2K file must initially be developed and edited outside of WEAP. WEAP will then 
modify some of the values, and extract values from QUAL2K after it is run. To view or edit 
the QUAL2K file, click on the “View” button next to the “QUAL2K Data File (.q2k)” drop-
down on the Water Quality Constituents dialog. 
4.   Change Reach Distance Markers 
For marking reach distances, QUAL2K assigns the tail of the river a distance 
of 0, and distance increases upstream. WEAP can measure reach distances 
either downstream or upstream, but in the previous module distance was 
measured downstream, opposite the convention for QUAL2K, so the reach 
distance markers must be changed when linking to QUAL2K.  
To set the reach distance markers: 
Go to Data View 
Navigate to the branch “Supply and Resources\River\Main River\Reaches\Below 
Main River Headflow.” 
Click on the “Physical” button. 
Select the “Distance Marker” tab. (This will only show up in Current Accounts: if you 
do not see it, switch to Current Accounts in the drop-down at the top of the page.) 


============================================================
PAGE 174
============================================================

 174 
 
Linking WEAP to QUAL2K 
October 2023 
 
 
WEAP Tutorial 
Set the distance for “Below Main River Headflow” to 300 km, and the distance for 
“Tailflow Point” to 0 km. 
 
5.   Set Dew Point and Cloud Cover 
QUAL2K and WEAP use different climate parameters, so some additional 
climate parameters must be set for QUAL2K. When using QUAL2K for 
water quality calculations, WEAP changes the list of climate parameters 
automatically. 
While each reach in QUAL2K can have a different climate, for most WEAP 
applications it is reasonable to assume that the climate is the same on all 
reaches. In this case, climate parameters only need to be set for the top reach, 
since for downstream reaches, upstream values are used by default. For this 
example, two climate parameters will be set: cloud cover and dew point. 
Cloud cover is not a climate parameter in WEAP, so there is no 
corresponding value already in WEAP. For this example, assume that average 
cloud cover is 30% along the river. To set this: 
Navigate to the branch “Supply and Resources\River\Main River\Reaches\Below 
Main River Headflow”, if you are not already there. 
Click on the “Climate” button. 
Select the “Cloud Cover” tab. 


============================================================
PAGE 175
============================================================

Linking to QUAL2K 
 175 
Stockholm Environment Institute 
 
October 2023 
Type “30” for the value. 
Dew point is used by QUAL2K instead of WEAP’s relative humidity 
parameter. Dew point, Td, can be calculated from the air temperature, T, and 
relative humidity, hr doing the following calculation.  First, instead of using 
air temperature T directly, use x = T/237.7. Then calculate dew point using: 
Td=237.7 [17.3 x + (1 + x) ln hr]/[17.3 – (1 + x) ln hr] 
Using this formula, and the values for air temperature (which are different for 
each month) and relative humidity (65% for every month) in the Water 
Quality module file, it turns out that dew point is about 6.5°C below air 
temperature for all months. So, to set dew point: 
Navigate to the branch “Supply and Resources\River\Main River\Reaches\Below 
Main River Headflow”, if you are not already there. 
Click on the “Climate” button. 
Select the “Dew Point Temperature” tab. 
Either use the Expression Builder or directly type in the formula “Air Temperature - 
6.5”, and make sure the units are “C.” Do not type in the [C] as shown below – 
WEAP will populate that automatically. 
 


============================================================
PAGE 176
============================================================

 176 
 
Linking WEAP to QUAL2K 
October 2023 
 
 
WEAP Tutorial 
Running Scenarios 
6.   Run Scenarios 
Run the scenario by going to Results View and answering “Yes” to the dialog 
asking whether to recalculate. 
Note that when using QUAL2K, running scenarios can take a long time. 
Consider reducing the number of scenarios that you calculate at any time. 
QUAL2K will not run for months in which streamflow is zero at any point 
in the river. If this situation occurs in one or more scenarios, add a (small) 
minimum flow requirement on reaches for which QUAL2K is used to force 
a flow greater than zero.  Here is the error message you might see: “QUAL2K 
Error: Error Code 3.  This error might be caused a streamflow of zero in the river, which 
QUAL2K does not allow.  Perhaps use a flow requirement below to force a small flow at 
that point.”  Add a flow requirement to the river immediately upstream from 
the first return flow node (from Big City), and set the minimum flow 
requirement in Current Accounts to be 0.1 CMS.  Re-run calculations. 
7.   Compare Results 
When you have finished running your selected scenarios, compare the 
results with the results from the previous module. They should be similar, 
but not identical, because the built-in water quality calculations in WEAP 
make slightly different assumptions and use different approximations than 
QUAL2K. 


============================================================
PAGE 177
============================================================

 
 
WEAP 
Water Evaluation And Planning System 
 
Hydrology 
 
A TUTORIAL ON 
Modeling Catchments: The Simplified 
Coefficient Method ................................................. 178 
Understanding the Soil Moisture Method ................ 183 
Modeling Catchments: The Soil Moisture 
Method .................................................................. 188 
Simulating Surface Water-Groundwater 
Interaction ............................................................. 194 
 
October 2023 
 
 


============================================================
PAGE 178
============================================================

 178 
 
Hydrology 
October 2023 
 
 
WEAP Tutorial 
Note: 
For this module you will need to have completed the previous modules (“WEAP in 
One Hour, Basic Tools, and Scenarios) or have a fair knowledge of WEAP (data 
structure, key assumptions, expression builder, creating scenarios). To begin this 
module, go to the Main Menu, select “Revert to Version” and choose the version 
named “Starting Point for all modules after ‘Scenarios’ module.”  
Modeling Catchments: The Simplified Coefficient 
Method 
1.   Create a New Catchment 
Create a “Catchment” object in the Schematic view to simulate headflow for 
Main River. Do this by pulling over a Catchment node and locating it near 
the starting point of the Main River.  Name it “Main River Headflow.” Set it 
to be active in Current Accounts, and leave “Includes Irrigated Areas?” 
unchecked. 
 
Next draw a Runoff/Infiltration path (dashed blue line) starting from the 
catchment into the beginning of the Main River. 


============================================================
PAGE 179
============================================================

Modeling Catchments: The Simplified Coefficient Method 
 179 
Stockholm Environment Institute 
 
October 2023 
 
2.   Create an Appropriate Substructure in the Basin 
The first time you right click on the Catchment or select it in the Data Tree, 
you will get a window that asks you to select a model for the Catchment. 
Select Rainfall Runoff (simplified coefficient method). 
 
There is also the opportunity to change this selection later by clicking on the 
“Advanced” tab in the Data view: 


============================================================
PAGE 180
============================================================

 180 
 
Hydrology 
October 2023 
 
 
WEAP Tutorial 
 
In the Data View, select the new catchment under the “Demand Sites and 
Catchments” branch of the data tree. On the right, click on the “Land Use” 
button and enter the following data: 
Area 
10M ha (you will have to choose the units first) 
Effective Precipitation 
98% 
Kc (Crop Coefficients) (use the Monthly Time Series Wizard to input these data) 
 
Sep to Feb 
0.9 
 
March 
1.0 
 
April 
1.1 
 
May 
1.4 
 
Jun to Aug 
1.1 


============================================================
PAGE 181
============================================================

Modeling Catchments: The Simplified Coefficient Method 
 181 
Stockholm Environment Institute 
 
October 2023 
 
Note that if you had clicked “yes” when asked if irrigated areas were to be 
included in this catchment (under General Info when creating catchment), 
another button “Irrigation” would have appeared under the catchment in the 
Data view. This button would have two tabs under it: (1) “Irrigated”, where 
you would input either a “0” for not irrigated, or a “1” for irrigated for a 
particular land class; and (2) “Irrigated fraction” where you would specify the 
fraction of irrigation water supplied to the area that is available for 
evapotranspiration. 
 
The Rainfall Runoff method is a simple method that computes runoff as the difference 
between precipitation and a plant’s evapotranspiration. A portion of the precipitation can be 
set to bypass the evapotranspiration process and go straight into runoff to ensure a base flow 
(through the “effective precipitation” parameter).  
The evapotranspiration is estimated by first entering the reference evapotranspiration, then 
defining crop coefficients for each type of land use (Kc’s) that multiply the reference evapo-
transpiration to reflect differences occurring from plant to plant.  
More information about this method can be obtained from the FAO Irrigation and Drainage 
Paper 56, called “Crop Evapotranspiration” and available from the FAO’s website 
(www.fao.org).  
Entering an effective precipitation other than 100% is one way of acknowledging the fact 
that part of the rainfall is not submitted to evapotranspiration during high intensity rainfall 
events, hence generating a minimal runoff to the river even when the rainfall is lower than 
the potential evapotranspiration. Another solution is to move to more developed models 
such as the 2-bucket soil moisture method coupled with Surface Water – Groundwater 
interaction modeling, as presented later in this module.  


============================================================
PAGE 182
============================================================

 182 
 
Hydrology 
October 2023 
 
 
WEAP Tutorial 
3.   Enter the Climatic Data 
Climatic Data are entered at the catchment level (Main River Headflow). 
Enter the following data under the “Climate” tab using the Monthly Time 
Series Wizard: 
Month 
Precip. 
ETref 
Jan 
 21 
 42 
Feb 
 37 
 47 
Mar 
 56 
 78 
Apr 
 78 
 86 
May 
141 
131 
Jun 
114 
122 
Jul 
116 
158 
Aug 
 85 
140 
Sep 
 69 
104 
Oct 
 36 
 79 
Nov 
 22 
 43 
Dec 
 13 
 37 
 
If not available from on-site stations, precipitation data can sometimes be derived from 
world-wide climate models such as the one developed by Tim Mitchell at the University of 
East Anglia (http://www.cru.uea.ac.uk/~timm/data/index.html). The use of GIS software 
to extract the appropriate data is required. Such models provide average data in opposition 
to actual data, implying that the calibration is much more delicate. 
The Reference Evapotranspiration can be determined from a set of climatic and 
topographic parameters using the Penman-Monteith equation. More details are provided in 
the FAO publication mentioned earlier. Also, there exist global models of monthly reference 
evapotranspiration put together by the FAO, available from the FAO’s website.  
4.   Look at the Results 
Results for Catchments are in the “Catchment” category in the primary 
variable pull-down menu.  
“Runoff from Precipitation” to the Main River should look similar to the 
graph below.  
Select “Selected Scenarios” from the pull-down menu above the graph legend and check 
off “Reference.”  Select “Main River Headflow” as the Demand site/branch from the 
menu to the upper left of the graph, and the year 2000 from the “Selected Years” option 
using the menu at the bottom of the graph. Make sure it is for “All Months.” 


============================================================
PAGE 183
============================================================

Understanding the Soil Moisture Method 
 183 
Stockholm Environment Institute 
 
October 2023 
 
Understanding the Soil Moisture Method 
5.   Physical Structure of the Soil Moisture Method 
Below is a picture from the WEAP help menu (topic “Soil Moisture Method”). 
You can find more details about the calculations in the help menu, but the 
general parameter operations are summarized below. 
 


============================================================
PAGE 184
============================================================

 184 
 
Hydrology 
October 2023 
 
 
WEAP Tutorial 
The land use and climate parameters of the soil moisture method together 
determine how much water percolates into the earth, evaporates, or runs off 
to the river. The following parameters can be changed for each catchment in 
the Data view under Demand Sites and Catchments. Valid ranges for each 
parameter are provided in the Catchment Calibration chapter. 
Land use: Surface parameters 
• Kc: When it rains, how much water can potentially be evapotranspired by plants?  
• Runoff Resistance Factor: Of the water that is not evapotranspired, do the 
conditions on the surface, such as leaf area and slope, encourage or discourage 
percolation?  
Land use: Upper Bucket parameters 
• Root Zone Conductivity: How fast does water move through the upper bucket? 
• Soil Water Capacity: How much capacity (mm) does the upper bucket have to 
hold water? 
• Preferred Flow Direction: As the water travels through the upper bucket, how 
much of it percolates into the lower bucket, and how much of it runs off and 
becomes streamflow?  
• Initial Z1: How full (as a percent of the Soil Water Capacity) is the upper bucket 
when the model begins? 
Land use: Lower Bucket parameters 
• Deep Conductivity: How fast does water move through the lower bucket?  
• Deep Water Capacity: What is the capacity (mm) of the lower bucket?  
• Initial Z2: How full (as a percent of the Deep Water Capacity) is the lower bucket 
when the model begins? 
Climate (No differentiation between upper and lower buckets or between different land 
uses. By default, each of these parameters is specified per catchment and can be further 
specified per timestep.) 
• Precipitation: How much precipitation falls?  


============================================================
PAGE 185
============================================================

Understanding the Soil Moisture Method 
 185 
Stockholm Environment Institute 
 
October 2023 
• Temperature: What is the average temperature? 
• Humidity: What is the average relative humidity? 
• Wind: What is the average wind speed? 
• Cloudiness Fraction: What fraction of daytime hours are cloudless? 
• Latitude: At what latitude is the catchment? 
• Freezing Point: At what temperature does rain turn to snow? 
• Melting Point: At what temperature does snow melt? 
• Albedo Lower Bound: What is the albedo (percentage of sun reflected) when 
snow accumulation is 0? 
• Albedo Upper Bound: What is the albedo when the snow accumulation is equal 
to or greater than 10 mm * the number of days in the timestep? (e.g., 310 mm in 
January, 280 mm in February, etc.) 
• Albedo: What is the albedo? (Use only when Albedo Lower and Upper Bound 
are left blank) 
• Initial Snow: How much snow (melt water equivalent) is there at the beginning 
of the first timestep of the model? 
• Snow Accumulation Gauge: Here you can input historical data of snow 
accumulation for the catchment, if available. 
Irrigation (Note: The following parameters are only available if your catchment is 
specified to include irrigated areas. See Modeling Catchments: The Simplified Coefficient Method 
in the Hydrology chapter of the Tutorial. The first three parameters can be specified by 
land use.) 
• Irrigated Area: Is the land use irrigated (100) or not irrigated (0)? 
• Lower Threshold: At what soil moisture level should irrigation begin? 
• Upper Threshold: At what soil moisture level should irrigation cease? 
• Irrigation Use of Runoff: How much of the runoff can be captured and used 
for irrigation within the catchment? 


============================================================
PAGE 186
============================================================

 186 
 
Hydrology 
October 2023 
 
 
WEAP Tutorial 
• Initial Z1 (Data/Demand Sites and Catchments/Catchment Name/Land Use/Initial Z1). 
Parameter only available in Current Accounts. In the Soil Moisture Method figure 
(above) of the upper and lower buckets, the blue area shows how full each bucket 
is (Z1 for the upper bucket, Z2 for the lower bucket). We need to set the initial 
conditions for the model, much like a reservoir, because the quantity of water 
already in the bucket will impact the model (read more about the mathematic 
expressions in the WEAP Help Menu). The example below shows a model with 
an initial condition for January 2002 that is likely too low, given the consistency 
of the other years.  
 
Note that your value for the initial condition will only affect the model for 
the first year or so—after that, the model adjusts itself. This parameter has a 
range of 0-100%. 
• Initial Z2. (Data/Demand Sites and Catchments/Catchment Name/Land Use/Initial 
Z2). The percent of soil moisture for the lower bucket should be relatively stable 
over time, so you can look at that result to make a guess at the initial condition. 
Range of 0-100%. 
• Freezing point. (Data/Demand Sites and Catchments/Catchment Name/Climate/ 
Freezing Point). The freezing point determines at what temperature rain becomes 
snow, delaying infiltration/runoff. This parameter is relevant only for watersheds 
with snow, and it affects the model only during the months with snow. The value 
(Celsius) should stay close to zero (WEAP’s default value is -5° Celsius). 
• Melting point. (Data/Demand Sites and Catchments/Catchment Name/Climate/ 
Melting Point). This parameter determines when snow turns to water, after which 
it is subject to all parameters controlling water flow in the catchment. Again, this 
parameter is only relevant and impactful during the winter and for watersheds 
Arable                
Artificial Areas      
Forests               
Hetero Agriculture\Irrigated
Hetero Agriculture\Unirrigated
Open Space            
Pastures              
Permanent Crops       
Scrubs                
Waters                
Wetlands              
Relative Soil Moisture 1 (%)
Scenario: Reference,  All months (12)
Jan
2002
Apr
2002
Aug
2002
Dec
2002
Apr
2003
Aug
2003
Dec
2003
Apr
2004
Aug
2004
Dec
2004
Apr
2005
Aug
2005
Dec
2005
Apr
2006
Aug
2006
Dec
2006
Apr
2007
Aug
2007
Dec
2007
Apr
2008
Aug
2008
Dec
2008
Percent
85
80
75
70
65
60
55
50
45
40
35
30
25
20
15
10
5
0


============================================================
PAGE 187
============================================================

Understanding the Soil Moisture Method 
 187 
Stockholm Environment Institute 
 
October 2023 
cold enough to have snow. The value should stay close to zero (WEAP’s default 
value is 5° Celsius). 
• Albedo. (Data/Demand Sites and Catchments/Catchment Name/Climate/Albedo, 
…/Albedo Lower Bound, and …/Albedo Upper Bound). Albedo is the fraction of 
solar radiation striking a land class that is reflected -- albedo increases as snow 
depth increases, and can also change over time as snow gets older and dirtier. 
New snow is very white, and has higher reflectance, whereas snow mixed with 
soil or dust will have lower albedo. In WEAP, the user can choose limits for high 
and low albedo values in the system. 
• Irrigated Area. (Data/Demand Sites and Catchments/Catchment Name/Irrigation) 
Designate any irrigated land use areas. You can select 0% irrigated or 100% 
irrigated. Catchments with irrigated areas must be connected to water supplies (a 
river, a groundwater node, etc.) so they have somewhere to draw water from 
when irrigation is needed. 
• Upper threshold [of irrigation]. (Data/Demand sites and Catchments/Catchment 
Name/Irrigation/Upper Threshold). This parameter represents the ideal value of soil 
moisture for the plants. In each time step, WEAP asks “is there enough water in 
the soil?” If there isn’t “enough” (see description of Lower Threshold, below), 
WEAP will demand water from the connected supply to irrigate the catchment, 
aiming to provide enough water to reach the upper threshold of soil moisture (if 
it rains in the same time step, WEAP will probably overshoot the target). Note 
that all land use types have options for data entry of their upper threshold, but 
the data are only read by WEAP if the parameter Irrigated Area (defined above) 
is 100% for the respective land use type. 
• The Lower threshold [of irrigation] specifies each irrigated land use type’s 
tolerance for dryness. If, in a time step, the soil moisture is between the upper 
and lower threshold, then there is still “enough” soil moisture, and WEAP will 
not irrigate. WEAP will only irrigate if the soil moisture is lower than the lower 
threshold, and then it will irrigate as much water as it thinks it necessary to raise 
the soil moisture to the upper threshold. 
To understand the dynamics of the Upper and Lower Thresholds a little bit 
better, consider the following situations: 


============================================================
PAGE 188
============================================================

 188 
 
Hydrology 
October 2023 
 
 
WEAP Tutorial 
Previous 
Timestep 
Value (%) 
Upper 
Threshold 
Value (%) 
Lower 
Threshold 
Value (%) WEAP’s Action 
20 to 100 
90 
20 
None. The soil moisture is tolerable for the plants. 
0 to 19 
90 
20 
WEAP provides enough water to raise soil moisture to 90%. 
Since the gap between 20% and 90% is quite large, this will 
probably be a large amount of water. 
80 to 100 
90 
80 
None. 
0 to 79 
90 
80 
WEAP irrigates to raise the soil moisture to 90%. This may be 
a little bit, if the soil moisture is 79%, or a lot, if the soil 
moisture is 10% (which would be unusual since it would have 
to have dropped to that value from the previous time step, 
which should also have had 80% or more soil moisture). 
11 to 100 
20 
10 
None. 
0 to 9 
20 
10 
WEAP irrigates up to 20% soil moisture. 
Note that the percentage gap between thresholds might be the same (for 
example, both 80%-90% and 10%-20% have 10% gaps), but with a 10%-20% 
range, there are more soil moisture values that do not trigger irrigation, while 
an 80%-90% range will result in greater water needs to maintain prescribed 
soil moisture. 
Similarly, the size of the gap matters—small gaps will produce more frequent 
irrigation demand (small amounts), whereas large gaps will produce 
infrequent irrigation demand of very large amounts. 
 
Some of these parameters are profoundly affected by the model time step. For example, the freezing 
and thawing of soil may occur over days, rather than months. 
Modeling Catchments: The Soil Moisture Method 
6.   Replace the Agriculture Demand Site with a Catchment 
Delete the Agriculture demand site and create a Catchment in its place. Name 
it “Agriculture Catchment” and set it Active in Current Accounts, Includes 
Irrigated Areas, and Demand Priority 1 (the demand priority only appears 
after you have selected “Includes Irrigated Areas”). 


============================================================
PAGE 189
============================================================

Modeling Catchments: The Soil Moisture Method 
 189 
Stockholm Environment Institute 
 
October 2023 
  
7.   Connect the New Catchment 
Draw a Runoff/Infiltration Link to the Main River below the Return flow 
node from the Big City. Add a Transmission Link from the Main River (same 
starting point as the former Agriculture demand site), with a Supply Preference 
of 1. Your model should now look similar to the figure below: 
 


============================================================
PAGE 190
============================================================

 190 
 
Hydrology 
October 2023 
 
 
WEAP Tutorial 
 
The purpose of this transmission link is to allow supplying irrigated areas with water from 
the river in case rainfall is insufficient. 
8.   Create sub-structure in the Catchment 
We will assume this catchment has three types of land use. In the Data View, 
add the following branches to your new catchment by right-clicking it in the 
data tree and selecting “Add.” (If you select the catchment for editing by right 
clicking on the node in the schematic view rather than going through the Data 
view, you will be asked beforehand to choose a simulation method - pick the 
“Rainfall Runoff (soil moisture method)” method). Add the following 
branches: 
Irrigated 
Forest 
Grasslands 
9.   Enter the Appropriate Land Use Data 
Select the Agricultural Catchment in the Data view and pick the “Rainfall 
Runoff (soil moisture method)” method by clicking on the “Advanced” 
button (click to the right of “Rainfall Runoff (simplified coefficient method)” 
and use the arrow to scroll down). Then enter the following data after clicking 
on the “Land Use” button:  
Total Land Area 
300,000 ha (you will have to select units first)  
 
Irrigated 
Forest 
Grasslands  
Share of Land Area 
 33% 
 25% 
Remainder(100) 


============================================================
PAGE 191
============================================================

Modeling Catchments: The Soil Moisture Method 
 191 
Stockholm Environment Institute 
 
October 2023 
 
 
Irrigated 
Forest 
Grasslands  
Runoff Resistance Factor 
 3.6 
 3.0 
 
1.7 
Root Zone Conductivity 
 60 
 35 
 
45 mm/month 
Preferred Flow Dir. 
 0.15 
 0.15 
 
0.15 
Initial Z1 
 50% 
 20% 
 
20% 
The remaining variables are the same for all land classes in the catchment: 
Initial Z2  
 
20%  
Soil Water Capacity 
900 mm 
Deep Water Capacity 
35,000 mm 
Deep Conductivity  
240 mm/month 
Kc  
Use the same values as input for the Main River Headflow   
 
 
catchment in the previous exercise. You can simply copy and paste  
 
 
that expression into the Kc field for the Agriculture Catchment  
 
 
land classes. 


============================================================
PAGE 192
============================================================

 192 
 
Hydrology 
October 2023 
 
 
WEAP Tutorial 
 
 
The Rainfall Runoff (soil moisture method) method has been developed to provide a simple 
yet realistic way of modeling hydrological processes with a semi-physical representation. 
Details about the method and its parameters, as well as calibration procedures, can be found 
in articles posted to the “publication” section of WEAP’s website (www.weap21.org). The 
related WEAP help topic provides a description of each parameter and an overview of the 
model as well. The parameter values displayed above are for illustration purposes only.  
10.   
Enter the Appropriate Climate Data 
In the same view as in the previous step, select the “Climate” screen and enter 
the following data: 
Precipitation  
Use the same precipitation values as input for the Main River 
 
 
 
Headflow catchment in the previous exercise.  
Temperature  
MonthlyValues( Jan, 9,  Feb, 12,  Mar, 16,  Apr, 21,   
 
 
 
May, 24,  Jun, 27,  Jul, 29,  Aug, 29,  Sep, 27,  Oct,  
 
 
 
 
22,  Nov, 16,  Dec, 11 ) 
Humidity 
 
65% 
Wind 
 
1m/s 
Latitude 
 
30° 
 
Data about snow coverage are not needed if the basin is not exposed to snow. WEAP 
determines the appearance of snow based on the temperature and the melting and freezing 
points parameters. If the last two are left empty, no snow will be allowed to accumulate.  


============================================================
PAGE 193
============================================================

Modeling Catchments: The Soil Moisture Method 
 193 
Stockholm Environment Institute 
 
October 2023 
11.   
Set up Irrigated Areas 
In the same view as in the previous step, select the “Irrigation” screen and 
enter the following data: 
 
 
 
 
Irrigated 
Forest  
Grasslands 
 
Irrigated Area 
 
100%  
0% 
 
0% 
Lower Threshold 
 
45%  
N/A  
N/A 
Upper Threshold 
 
55%  
N/A  
N/A 
  
12.   
Look at Results 
Look at the following results. Here again, the results are located in the 
“Catchment” category of the “Results” view.   
Select “Land Class Inflows and Outflows” under the primary variable pull-down menu. 
Click to view all variables above the chart legend. To view the “Irrigated” segment of 
the Agriculture catchment, select “Branch: Demand Sites and Catchments\Agriculture 
Catchment\Irrigated” from the pull-down menu to the upper left of the chart. Choose 
the year 2000 from the “Selected Years” option using the pull-down menu at the bottom 
and click on “Monthly Average” to the right of annual total (you may have to expand 
the screen to see it). 


============================================================
PAGE 194
============================================================

 194 
 
Hydrology 
October 2023 
 
 
WEAP Tutorial 
“Land Class Inflows and Outflows” represents in a very detailed manner the 
water balance for each land use class. You should obtain a graph similar to 
the figure below for the “Irrigated” land class inflows and outflows graph:   
 
Change the unit from Cubic Meter to mm.  Depth units such as mm are typically more 
useful when examining or validating results catchment results.  Note: you cannot change 
to a depth unit if “Monthly Average” is checked. 
You can also look at other parameters, such as “Soil Moisture in the upper 
bucket” (Relative Soil Moisture 1 (%)).  
Simulating Surface Water-Groundwater 
Interaction 
13.   
Create a Groundwater Object 
Create a new “Groundwater” node next to the Agriculture Catchment that you created 
in the previous exercise. Name it “Agriculture Groundwater.” 


============================================================
PAGE 195
============================================================

Simulating Surface Water-Groundwater Interaction 
 195 
Stockholm Environment Institute 
 
October 2023 
 
14.   
Connect the Groundwater Object to a Catchment 
Create the following connections: 
Transmission Link from Agriculture Groundwater to Agriculture Catchment 
(Supply Preference 1) 
Infiltration/Runoff Link from Agriculture Catchment to Agriculture 
Groundwater. 
Your model should look similar to the one below: 


============================================================
PAGE 196
============================================================

 196 
 
Hydrology 
October 2023 
 
 
WEAP Tutorial 
 
 
You can also create the Infiltration/Runoff Link between the catchment and the 
groundwater node by right-clicking the catchment in the Schematic View, selecting 
“General Info” and then choosing the groundwater field in the “Infiltration to” drop-down 
menu.  
15.   
Enter the Appropriate Data 
In the Data View, select Agriculture Groundwater, examine the “Physical” screen and 
select the “Model GW-SW flows” method from the “Method” tab. 
 


============================================================
PAGE 197
============================================================

Simulating Surface Water-Groundwater Interaction 
 197 
Stockholm Environment Institute 
 
October 2023 
Switch to the “Water Quality” window and then back to the “Physical” 
window for the change to take effect (you will now see several new tabs in 
the “Physical” window. If these do not populate, make sure you are in current 
accounts).  
Enter the following data (leave blank if nothing is specified) under the appropriate tabs: 
Initial storage 
 
50M m3 
Hydraulic Conductivity 
10m/day 
Specific Yield 
 
0.1 
Horizontal Distance 
260m  (the extent of the aquifer perpendicular to  
 
 
 
 
the river ) 
Wetted Depth 
 
5m 
Storage at River Level 
50M m3 
 
16.   
Select the Reaches that Interact with the Aquifer 
In the Data View’s tree, expand all the reaches of the Main River by clicking on the 
“+” icon next to it in the “Supply and Resources\River” branch. Select the reach that 
is below the return flow node from Big City (Return Flow Node 1; you might have to 
switch to the Schematic view and right-click on the nodes to find the name of that node 
in your model). Then enter the following data in the “Reach Length” tab for this reach: 


============================================================
PAGE 198
============================================================

 198 
 
Hydrology 
October 2023 
 
 
WEAP Tutorial 
Groundwater 
 
Select “Agriculture Groundwater” 
 
Reach Length 
 
30,000 m 
 
17.   
Look at the Results 
Look at the “Demand Site Inflows and Outflows” in Demand for the Agriculture 
catchment and select “All Sources and Destinations” for the year 2000. 


============================================================
PAGE 199
============================================================

Simulating Surface Water-Groundwater Interaction 
 199 
Stockholm Environment Institute 
 
October 2023 
  
 
Note that these results include “Inflow from Agriculture Groundwater” (due to the 
designation of the Agriculture Groundwater node as a source to supply irrigation water for 
the Agriculture Catchment) and “Outflow to Agriculture Groundwater” (due to the creation 
of a runoff/infiltration link between the two nodes).  
Look also at “Groundwater Inflows and Outflows” (under Supply and 
Resources\Groundwater) for the year 2000. 
 


============================================================
PAGE 200
============================================================

 200 
 
Hydrology 
October 2023 
 
 
WEAP Tutorial 
 
Note that the “Inflow from Upstream” category indicates infiltration of Main River water to 
Agriculture Groundwater along the river reach you selected earlier. Likewise, “Outflow to 
Downstream” represents groundwater seepage into the Main River.  
Look now at the height of groundwater above the river stage. This can be viewed by 
selecting “Supply and Resources\Groundwater\Height Above River” from the primary 
variable pull-down menu. Choose “Agriculture Groundwater” from the “Selected 
Aquifers” option in the pull-down menu above the chart legend. 
 
Note that in the month where groundwater seepage to the Main River occurs (February), 
the groundwater elevation is higher than the wetted depth of the river as designated in the 
data (i.e., the difference in elevations is positive). Likewise, when Main River infiltration to 
groundwater is occurring, the elevation difference is negative.  
 


============================================================
PAGE 201
============================================================

 
 
WEAP 
Water Evaluation And Planning System 
 
Catchment 
Calibration 
 
A TUTORIAL ON 
Gather Observed Data and Select the Model 
Calibration Locations ............................................ 202 
Complete Observed Data and Select the Model 
Calibration Period ................................................. 204 
Visually Assess Model Calibration ........................ 211 
Adjust key parameters and conduct model 
sensitivity analysis .................................................. 220 
Optimize calibration based on visual and 
statistical assessment ............................................... 236 
Model Calibration Tips.......................................... 250 
 
October 2023 
 
 


============================================================
PAGE 202
============================================================

 202 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
Note: 
For this module you will need to have completed the previous modules (WEAP in 
One Hour, Basic Tools, and Scenarios) or have a fair knowledge of WEAP.  It is 
also a good idea to have completed or reviewed the Hydrology module.  To begin 
this module, go to the Main Menu, select “Revert to Version” and choose the 
version named “Starting Point for Catchment Calibration Tutorial.”  
In this activity, we will demonstrate how to hydrologically calibrate a WEAP 
model using Rainfall Runoff (soil moisture method) that was introduced in 
the Hydrology module. The other four catchment methods: Rainfall Runoff 
(simplified coefficient method); Irrigation demands only (simplified 
coefficient method); MABIA; and Plant Growth are not covered here. 
However, many of the same principles apply. 
The importance of calibration cannot be overstated. Models represent real-
world systems to enable researchers and decision makers to ask questions 
about the future. A model that does not adequately represent the past will not 
adequately represent the future, and therefore should not be used to guide 
decisions in the real world. To ensure that model simulations approximate 
reality, WEAP models should be calibrated. 
The main principal steps used to calibrate a model are: 
1) Gather observed data and select model calibration locations   
2) Complete observed data and select the model calibration period 
3) Visually assess model calibration  
4) Adjust key parameters and conduct model sensitivity analysis 
5) Optimize calibration based on visual and statistical assessment 
Once the model is calibrated hydrologically calibrate it operationally, adding 
in major demands and reservoirs and including data on withdrawals, reservoir 
elevations, groundwater elevations, and downstream flow gauge data. 
Gather Observed Data and Select the Model 
Calibration Locations 
1.   Gather Observed Data 
Note that the principal outcome we used to assess model calibration for 
WEAP is observed streamflow.  The calibration may also include historical 
observations (or estimates) of snowpack, evapotranspiration, reservoir 


============================================================
PAGE 203
============================================================

Gather Observed Data and Select the Model Calibration Locations 
 203 
Stockholm Environment Institute 
 
October 2023 
storage, groundwater recharge, and/or groundwater elevation. For this 
exercise we will look only at streamflow.   
For hydrological calibration of the model, ideally begin with unimpaired 
streamflow data (upstream of major withdrawals or reservoirs) for a 10-year 
period on a monthly, weekly or daily time step that matches available climatic 
data, to ensure that the model is calibrated for wet, average and dry years.  In 
this example, we have gathered observed unimpeded monthly streamflow 
data at the location of “Gauge” as well as monthly climate data for the 
corresponding catchment.  After gathering the data, we saved a file with the 
data in csv format in the WEAP Areas folder of the project 
(Tutorial\additional files\SMMdata.csv). 
2.   Select Model Calibration Location(s) 
The Schematic View includes a WEAP Catchment object and a shapefile of 
the catchment area generated using WEAP’s automatic catchment delineation 
mode.  
A catchment is determined by elevation, where the borders of the catchment 
create a rim of high elevation points that water flows cannot cross. Thus, a 
catchment denotes an area of land where all surface water from rain, melting 
snow, or ice converges to a single point at the area’s lowest elevation, known 
as the “pour point” or “discharge point.” It is this point that determines the 
shape of a catchment, since a point further downstream would be lower 
elevation, and thus include a larger area that discharges into it. 
 


============================================================
PAGE 204
============================================================

 204 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
In this example, our calibration location is at “Gauge” and we have designed 
the catchment’s downstream boundary to be at the same point. This way, the 
catchment’s modeled flow, when calibrated, should match the historical data 
from the gauge. We have intentionally chosen a gauge location and historical 
period without upstream demands or reservoirs (unimpaired flows). 
 
Neither the schematic location of the catchment node nor of the pour point of “Tributary 
Headflow” affect the flow calculation by WEAP, because WEAP models flow by inputs and 
outputs. The area of the catchment, over which precipitation falls and accumulates, has a direct 
impact on catchment hydrology, including inflow to the river. Catchment downstream boundaries 
should be carefully positioned to allow the model to examine the specific points of interest: the 
places where modelers need accurate streamflow information. 
Complete Observed Data and Select the Model 
Calibration Period 
3.   Change the Model Timestep 
To calibrate our model, we have historical monthly streamflow and climate 
data available for the years 2000 to 2007. This will be our calibration period. 
Change the years of the model to match the calibration period.   
Go to Main Menu> General/Year and Time Steps, and change the Time 
Horizon to be 2000-2007. 
 


============================================================
PAGE 205
============================================================

Complete Observed Data and Select the Model Calibration Period 
 205 
Stockholm Environment Institute 
 
October 2023 
 
 
Keep in mind that when you change the initial modeling year (the current accounts year) the initial 
conditions—for example Population and Land Use—of your model may need to be altered. 
4.   Select the Catchment Modeling Method 
Go to the Data View and click on Demand Sites and 
Catchments/Tributary Headflow. In the window that appears, 
select the third option for catchment method: “Rainfall Runoff (soil 
moisture method).” 
 


============================================================
PAGE 206
============================================================

 206 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
5.   Enter the Data 
Prior to calibration, it is important to complete observed streamflow data, 
land use, latitude, precipitation, temperature, and snow accumulation gauge 
for the time period used for calibration, as they impact model results. 
For the “Tributary Headflow” catchment, under the Land Use category, and the Area 
tab, enter the value 1500 and set the units to km2. 
 
 
Add forest and grassland land cover designations to your catchment.  
Right click on the catchment Tributary Headflow in the Data View tree, select 
“Add,” and type in the name of your land cover subdivisions: one for forest and one for 
grassland.  
Select the units for both to be share [of square kilometers]. Enter a Forest Area of 
35%.  (Just enter 35 without the percent sign.) Use the Remainder function (which you 
can type or look up in the Expression Builder) to tell WEAP that the remaining area 
is grassland. It should read Remainder(100). 
When you have completed these steps, your data and data tree should look 
the same as below. 


============================================================
PAGE 207
============================================================

Complete Observed Data and Select the Model Calibration Period 
 207 
Stockholm Environment Institute 
 
October 2023 
 
In the Data View, navigate to the Gauge’s Streamflow Data (Supply and 
Resources/River/Tributary River/Streamflow Gauges/Gauge). 
The streamflow gauge does not affect WEAP’s calculations; its data are 
historical observed streamflow from the basin represented in the model. The 
value of a historical model is the ability to plug in recorded data from the past 
to compare with data simulated by the model. Historical data can be 
formatted into a .csv file for upload into WEAP. 
In the Gauge, under Inflows and Outflows, click on the white space under the year 
“2000” and select ReadFromFile Wizard from the dropdown menu. Select the 
SMMdata.csv file from the Additional Files folder. 


============================================================
PAGE 208
============================================================

 208 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
 
The SMMdata.csv file contains four columns of historical data: Precipitation, 
Temperature, Wind Speed and Streamflow. We need to make sure the correct 
information is displayed for the streamflow gauge data. 
In the lower section of the ReadFromFile Wizard, change the line in Data Column 
to “4 Streamflow[CMS],” and then click the Finish button.  
 


============================================================
PAGE 209
============================================================

Complete Observed Data and Select the Model Calibration Period 
 209 
Stockholm Environment Institute 
 
October 2023 
 
The SMMdata.csv file contains a directive at the top that tells WEAP how to label the different data 
columns: the text $Columns = Precipitation[mm], Temperature[C], Wind Speed[m/s], Streamflow[CMS] tells 
WEAP the names and units of each data column. For more information about the ReadFromFile 
Wizard, see the ReadFromFile Wizard video at www.WEAP21.org/videos.  
Your screen should look like this: 
 
 
Now we must enter the remaining data in the SMMdata file as climate data 
for the Tributary catchment. The data are assumed to be representative of the 
entire catchment, with the exception of some land use data which are specific 
to certain land use types. 
 
Meteorological stations measure climatic variables such as precipitation, temperature, and windspeed 
at the location of the station. However, WEAP requires these data to characterize the whole 
catchment. When possible, it is best to gather data and locations for as many stations as possible. 
This allows the user to calculate an average value for the whole catchment for each parameter for 
each time step. In this example, the climatic data in the SMMdata.csv file are assumed to already 
have been interpolated. 
In the Data View, navigate to the Tributary Headflow catchment under the 
Climate category to view the climate data. Use the same ReadFromFile Wizard and 
the SMMdata.csv file to import precipitation, temperature and wind speed data in the 
Tributary Headflow catchment.  


============================================================
PAGE 210
============================================================

 210 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
Always double check the units in your file are the same units that WEAP is 
using and remember to indicate the correct column.  Verify that your graphs 
match the following graphs.  
 
 
 


============================================================
PAGE 211
============================================================

Visually Assess Model Calibration 
 211 
Stockholm Environment Institute 
 
October 2023 
 
 
The SMMdata.csv dataset does not include relative humidity. You can use the 
monthly time series wizard if you have average monthly values for the 
catchment, but here we will use just one value for the whole year. 
Humidity   
35 (%) 
Finally, WEAP needs to know the latitude of each catchment to estimate 
potential evapotranspiration. Enter a value of 30. 
Latitude 
 
30 (degrees north) 
Visually Assess Model Calibration  
Input parameters used by the Soil Moisture Method are discussed in detail in 
the previous chapter of the Tutorial (Hydrology). The land use and climate 
parameters are based on historical data and not used for calibration. The 
default values used by WEAP for the remaining parameters, along with a brief 
summary of how they impact the model are listed in the following table.  As 
described further in this chapter, the parameters that have the most impact 
on model calibration are the six shallow soil land use parameters: soil water 
capacity, runoff resistance factor, Kc, preferred flow direction, root zone 
conductivity, and initial Z1. 
Do not make any adjustments in default values for calibration parameters for 
now to view the results of an initial, uncalibrated model. 


============================================================
PAGE 212
============================================================

 212 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
 
Parameter 
Default 
Value 
Valid 
Range 
Impact on Model 
Land Use 
Kc 
1 
0 – ∞ 
Increasing parameter leads to more evapotranspiration, and thus 
less water contributing to streamflow. 
Runoff 
Resistance 
Factor 
2 
0 – ∞ 
Increasing parameter routes less water to streamflow as it instead 
percolates into the soil. While it is in the soil, more evaporation is 
possible, and thus less water contributing to streamflow. 
Root Zone 
Conductivity 
20  
mm/ 
month 
0 – ∞ 
Increasing parameter shortens travel time for any water in the 
upper bucket (less evaporation possible, less loss of water from 
system). 
Soil Water 
Capacity 
1000 mm 
0 – ∞ 
Increasing parameter increases travel time for any water in the 
upper bucket (more evaporation possible, more loss of water from 
system) 
Preferred 
Flow 
Direction 
0.15 
0 – 1 
0: all water leaving the upper bucket flows to lower bucket, and 
none to river. 
1: all water leaving the upper bucket flows to river, and none to 
lower bucket. 
Initial Z1 
30% 
0 – 100 
0: Upper bucket begins empty and will retain lots of moisture in 
the early time-steps. 
100:  Upper bucket begins at full capacity and will retain little 
moisture in the early time-steps. 
Deep 
Conductivity 
20  
mm/ 
month 
0 – ∞ 
Increasing parameter decreases travel time for any water in the 
lower bucket before it flows into the river.  
Deep Water 
Capacity 
1000 mm 
0 –∞ 
Increasing parameter increases travel time for any water in the 
lower bucket before it flows into the river. 
Initial Z2 
30% 
0 – 100 
0: Lower bucket begins empty and will retain lots of moisture in 
the early time-steps. 
100:  Lower bucket begins at full capacity and will retain little 
moisture in the early time-steps. 
Climate 
Precipitation, Temperature, 
Latitude, Snow Accumulation Gauge 
These parameters are generally based on historical data and should 
not be altered during calibration. 
Humidity 
0% 
0 – 100 
Affects evapotranspiration. 
Wind 
2 m/s 
0 – ∞  
Affects evapotranspiration. 
Cloudiness 
Fraction 
1 
0 – 1 
Affects evapotranspiration. 1=no clouds. 0=completely overcast. 
Freezing 
Point 
-5 °C 
-20 – 20 
Dictates at what temperature rain becomes snow, delaying 
infiltration/runoff. Relevant only for catchments with snow and 
affects the model only during cold months. 
Melting 
Point 
5 °C 
-20 – 20 
Dictates at what temperature snow becomes water, after which it 
is subject to all parameters controlling water flow in the 
catchment. Relevant only for catchments with snow and affects 
the model only during cold months. 
Initial Snow 
0 mm 
0 – ∞  
Melt water equivalent depth of the snowpack at the beginning of 
the first timestep of the model. 
Albedo 
Lower Bound 
0.15 
0 – 1 
Albedo of the surface when snow accumulation is 0. Only used 
when Albedo variable is left blank. 
Albedo 
Upper Bound 
0.25 
0 – 1 
Albedo of the surface when snow accumulation is 
10 mm*(number of days in the timestep). Only used when Albedo 
variable is left blank. 
Albedo 
Blank 
0 – 1 
Static value for albedo. If blank, WEAP calculates albedo as a 
linear function of snow accumulation, between Albedo Lower Bound 
and Albedo Upper Bound.  A lower albedo increases snow melt rate. 
 


============================================================
PAGE 213
============================================================

Visually Assess Model Calibration 
 213 
Stockholm Environment Institute 
 
October 2023 
6.   View the Results 
Run the model.  
Compare modeled streamflow with data from the streamflow gauge:  
In the results/chart tab, navigate to Supply and 
Resources>River>Streamflow Gauge Comparison.  
 
 
We can see that our modeled river (blue) is not simulating the high flows of 
the river very well.  
7.   Save Chart as a Favorite 
Before we start the calibration process, save this chart as a favorite so we can 
easily return to it later.  
Go to Favorites/Save Chart as Favorite… the default name will be 
“Streamflow Gauge Comparison”. 
8.   Explore the Calibration 
In the results produced so far, there is not a good fit between the modeled 
streamflow and the historical streamflow. There is a lot of room for 


============================================================
PAGE 214
============================================================

 214 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
improvement.  There are seven charts we recommend considering in the 
process of calibration: 
1) The monthly time series for observed and modeled streamflow (generated 
above).  This chart allows us to observe how well the modeled flow 
matches base flows, wet weather flows, and seasonality for a range of dry 
and wet years.  
2) Annual Total of observed and modeled streamflow (while viewing the 
time series generated above, check the “Annual Total” box in the Results 
View) 
 
 
The annual total provides a good sense of the general fit of the model over 
time and of how well the modeled total annual volume of runoff matches 
observed values. For example, here we see that our modeled flow is much 
lower, and does not capture annual variations very well, especially the year of 
low flow in 2006. 
3) Monthly Average of observed and modeled streamflow (check the “Monthly 
Average” box in the Results View) 


============================================================
PAGE 215
============================================================

Visually Assess Model Calibration 
 215 
Stockholm Environment Institute 
 
October 2023 
 
 
The monthly average shows how the modeled flow values deviate from the 
historical record, on average, each annual cycle. Here we see that the modeled 
low flows of the summer are closer to the observed values than the winter 
modeled high flows, which are considerably underestimated.  
While viewing these results, click on the icon to export results to Excel (
) on the 
right side of your screen. Save them on your computer as “Uncalibrated Monthly 
Average Streamflow Results.” We will review them after our first calibration 
attempt. 
4) Exceedance Probability for observed and modeled streamflow (make sure 
that neither “Monthly Average” nor “Annual Total” is checked, and check the 
box at the bottom right of the Results View that says “Percent of Time Exceeded.”) 


============================================================
PAGE 216
============================================================

 216 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
 
 
The exceedance probability chart ranks each flow measurement by value, the 
lowest on the right and the highest on the left, for both the modeled and 
observed streamflow. The values on the x-axis show the percentage of flows 
that exceed the values of flow. The modeled and observed streamflow should 
show a close match of exceedance percentages for the two flow records. 
The gauge data charted above suggest that about 48% of flow measurements 
should be greater than about 34 million m3. However, the simulated Basin 1 
Runoff shows 0% of flows >34 million m3. As we have noted, our model is 
not currently doing a good job of capturing streamflow, particularly during 
high-flow periods. 
5) Relative Soil Moisture 1(%) (In results, navigate to Catchments/Relative 
Soil Moisure 1 (%). Make sure the Branch selected is “Tributary Headflow,”. 
Be sure that “Percent of Time Exceeded” is unchecked.) 
Save this chart as a favorite. 


============================================================
PAGE 217
============================================================

Visually Assess Model Calibration 
 217 
Stockholm Environment Institute 
 
October 2023 
 
This chart shows a result for the land use dynamics of the modeled catchment. 
Relative Soil Moisture 1 (%) represents soil moisture in the upper bucket of 
the catchment soil moisture method’s 2-bucket structure. (See Understanding 
the Soil Moisture Method in the Hydrology Chapter). The catchment’s upper 
bucket is affected by the land use designated in the model as well as by the 
seasons. Except in extreme circumstances (multi-year droughts), Relative Soil 
Moisture 1 (%) should remain stable over time, even as it displays seasonal 
patterns. The current results for the upper bucket are acceptable. Notice that 
maximum and minimum values are fairly consistent from year to year. 
6) Relative Soil Moisture 2 (%) (in the Results Menu, just below the Relative Soil 
Moisture 1 (%) result). 
Save this chart as a favorite. 


============================================================
PAGE 218
============================================================

 218 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
 
The Relative Soil Moisture 2 (%) result shows the soil moisture in the lower 
bucket of the modeled catchment. The lower bucket is deeper, not affected 
by land use, and less affected by seasons because of its separation from the 
surface. Slight seasonal variation is acceptable, and there should be no trend 
(either increasing or decreasing) over time.  
The decreasing trend seen in this lower bucket example could indicate one or 
more of several problems: 
a. The initial condition for the soil moisture in the lower bucket is too 
high. 
b. Not enough water is percolating into the lower bucket. 
c. Water is leaving the bucket too quickly, because 
i. The conductivity is too high. 
ii. The bucket is too small, so the transport time is very short. 
We will explore some of these possibilities as we calibrate. 
7) Catchment Land Class Inflows and Outflows (still in the catchment results, 
navigate to “Land Class Inflows and Outflows.” View the result as a Monthly 
Average bar chart and select the bars to be “stacked” using the 
 icon on 
the right.)  


============================================================
PAGE 219
============================================================

Visually Assess Model Calibration 
 219 
Stockholm Environment Institute 
 
October 2023 
 
This chart shows the average distribution of the water entering the catchment 
(values above zero) and how that water leaves (values below zero). We note 
that there is a large amount of evapotranspiration from February through 
August, which is water lost from WEAP’s accounting system.  That could be 
related to our model’s under-representation of streamflow.  
Save this chart as a favorite. 
Using the information from these seven charts, we can begin to think about 
changing the parameters of the model to allow WEAP to more accurately 
model streamflow. 
Another way to look at the data that can provide some additional insight on 
model calibration is to overlay average monthly precipitation and streamflow 
data.  The following figure shows the mean monthly observed runoff and 
average precipitation for the period 2000-2007. 


============================================================
PAGE 220
============================================================

 220 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
 
The hydrograph overlain on precipitation data above reveals a strong 
correlation between precipitation and runoff and suggests that the system is 
dominated by the surface runoff component; runoff highly correlated with 
precipitation is usually because there is little infiltration.  The very low 
baseflows during the dry season suggest a small Deep Storage Capacity, often 
also associated with large seasonal fluctuations in top-bucket storage (Z1), and 
thus large seasonal variations of soil water availability from very wet (high 
values of Z1) to very dry (low values of Z1). This is indeed what we already 
saw in our result Relative Soil Moisture 1 (%).  
Adjust key parameters and conduct model 
sensitivity analysis 
9.   Change Parameter Values 
Prior to making any adjustments in land use calibration parameter values, 
we’ll describe how key land use calibration parameters affect WEAP runoff 
results and consider what factors might impact those parameters. 
0
20
40
60
80
100
120
140
160
Monthly Average of Historical Precipitation 
and Streamflow 2000-2007
Precipitation (mm)
Streamflow (CMS)


============================================================
PAGE 221
============================================================

Adjust key parameters and conduct model sensitivity analysis 
 221 
Stockholm Environment Institute 
 
October 2023 
Uncalibrated 
model 
observations 
Relevant 
Parameters 
Impact on Model 
Model adjustment to consider 
Modeled flows 
(total annual and 
maximum 
monthly) are 
much lower than 
observed values 
 
Modeled base 
flows are a little 
lower than 
observed 
Kc 
Increasing parameter leads to more 
evapotranspiration, and thus less water 
contributing to streamflow. 
Decrease Kc, perhaps 
seasonally, to reflect lower 
evapotranspiration and higher 
runoff.  Note that decreasing Kc 
will impact both peak flows and 
base flows. 
Runoff 
Resistance 
Factor 
Increasing parameter routes less water to 
streamflow as it instead percolates into 
the soil.  
Decrease RRF, to increase the 
proportion of rainfall directed to 
runoff.  RRF has little impact on 
base flows. 
Soil Water 
Capacity 
Increasing parameter increases travel 
time for any water in the upper bucket 
and decreases streamflow. 
Decrease SWC to increase the 
proportion of rainfall directed to 
runoff.  Note that decreasing 
SWC will also slightly decrease 
base flows. 
Preferred 
Flow 
Direction 
0: all water leaving the upper bucket 
flows to lower bucket, and none to river. 
1: all water leaving the upper bucket 
flows to river, and none to lower bucket. 
Increase PFD to increase the 
proportion of rainfall directed to 
runoff.  Increasing PFD will 
decrease base flows. 
Root Zone 
Conductivity 
Increasing parameter shortens travel time 
for any water in the upper bucket (less 
evaporation possible, less loss of water 
from system). 
Increase RZC to increase the 
proportion of rainfall directed to 
runoff.  Increasing RZC will 
decrease base flows. 
Soil moisture in 
the upper bucket 
is consistent from 
year to year 
Initial Z1 
0: Upper bucket begins empty and will 
retain lots of moisture in the early time-
steps. 
100:  Upper bucket begins at full capacity 
and will retain little moisture in the early 
time-steps. 
Make no change! 
Soil Water 
Capacity 
 
Changes in SWC and RZC will 
affect consistency of modeled 
soil moisture in the upper 
bucket. 
Root Zone 
Conductivity 
 
Soil moisture in 
the lower bucket 
is decreasing from 
year to year 
Deep 
Conductivity 
Increasing parameter decreases travel 
time for any water in the lower bucket 
before it flows into the river.  
Lower DC to retain water in the 
lower bucket. 
Deep Water 
Capacity 
Increasing parameter increases travel 
time for any water in the lower bucket 
before it flows into the river. 
Increase the DWC to retain 
water in the lower bucket 
Initial Z2 
0: Lower bucket begins empty and will 
retain lots of moisture in the early time-
steps. 
100:  Lower bucket begins at full capacity 
and will retain little moisture in the early 
time-steps. 
Increase the value of the initial 
condition to decrease initial 
moisture retention and stabilize 
calculations. 
 
 


============================================================
PAGE 222
============================================================

 222 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
The impacts of these parameters on soil water storage and resulting surface 
water flow can be appreciated in the summarized soil moisture equation of 
WEAP, where: 
R = root zone soil water capacity 
Kc = crop coefficient 
RRF = runoff resistance factor 
f = preferred flow direction 
ks = root zone conductivity 
Smax = deep soil water capacity 
ks2 =deep soil conductivity  
 
The table below provides some guidance in considering how land use, crop 
types, elevation, slope, and geology might impact hydrology as well as their 
relationship to calibration factors.  While it is important to understand the 
implications of the various calibration parameters, it is also important to 
understand that some parameters associated with soil moisture accounting 
are not meant to have rigorous physical meaning; rather they are used to help 
describe the general hydrologic response of the watershed. 


============================================================
PAGE 223
============================================================

Adjust key parameters and conduct model sensitivity analysis 
 223 
Stockholm Environment Institute 
 
October 2023 
Parameter 
Impacting factors 
Crop Coefficient, Kc 
Land use, crop type, elevation, season (often varies monthly) 
Runoff Resistance Factor 
Land use, slope, season (can vary monthly) 
Root Zone Conductivity 
Soil type, elevation 
Soil Water Capacity 
Soil type, elevation 
Preferred Flow Direction 
Slope, land use, elevation 
Deep Conductivity 
Geology, elevation 
Deep Water Capacity 
Geology, elevation 
Model results are more sensitive to changes in some soil calibration 
parameters than others.  Examples of model sensitivity to changes in the 
parameters are shown in the graphs below. 
Root Zone Soil Water Capacity (SWC) 
 
0
100
200
300
400
500
600
700
800
900
Jan Feb Mar Apr May Jun
Jul Aug Sep Oct Nov Dec
Discharge (million cubic meters)
Average Monthly Discharge
SWC = 500 mm
SWC = 1000 mm
SWC = 2000 mm


============================================================
PAGE 224
============================================================

 224 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
Crop Coefficient, Kc 
 
Runoff Resistance Factor, RRF 
 
0
200
400
600
800
1000
1200
Jan Feb Mar Apr May Jun
Jul Aug Sep Oct Nov Dec
Discharge (million cubic meters)
Average Monthly Discharge
Kc = 0.5
Kc = 1
Kc = 2
0
200
400
600
800
1000
1200
Jan Feb Mar Apr May Jun
Jul Aug Sep Oct Nov Dec
Discharge (million cubic meters)
Average Monthly Discharge
RRF = 1
RRF = 2
RRF = 4


============================================================
PAGE 225
============================================================

Adjust key parameters and conduct model sensitivity analysis 
 225 
Stockholm Environment Institute 
 
October 2023 
Preferred Flow Direction, f 
 
Root Zone Conductivity, ks 
 
0
100
200
300
400
500
600
700
800
900
Jan Feb Mar Apr May Jun
Jul Aug Sep Oct Nov Dec
Discharge (million cubic meters)
Average Monthly Discharge
PFD  = 0.15
PFD  = 0.5
PFD = 0.85
0
100
200
300
400
500
600
700
800
900
Jan Feb Mar Apr May Jun
Jul Aug Sep Oct Nov Dec
Discharge (million cubic meters)
Average Monthly Discharge
RZC x 0.5
RZC x 1
RZC x 2


============================================================
PAGE 226
============================================================

 226 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
Deep Soil Water Capacity, Smax 
 
Deep Conductivity, ks2 
 
Now we are ready to begin making changes in land use calibration parameters.  
We will adjust initial estimates for the hydrologic parameters related to the 
two land use types in the Tributary Headflow catchment.  We will begin with 
adjusting parameters that affect the upper bucket, focusing on adjusting 
0
100
200
300
400
500
600
700
800
900
Jan
Feb
Mar
Apr
May
Jun
Jul
Aug
Sep
Oct
Nov
Dec
Discharge (million cubic meters)
Average Monthly Discharge
DWC = 500 mm
DWC = 1000 mm
DWC = 2000 mm
0
100
200
300
400
500
600
700
800
900
Jan
Feb
Mar
Apr
May
Jun
Jul
Aug
Sep
Oct
Nov
Dec
Discharge (million cubic meters)
Average Monthly Discharge
DCond  = 50
DCond = 100
DCond = 200


============================================================
PAGE 227
============================================================

Adjust key parameters and conduct model sensitivity analysis 
 227 
Stockholm Environment Institute 
 
October 2023 
parameters to increase the water that the model sends to the river, as modeled 
streamflow was significantly lower than historical observations.   
1) Runoff Resistance Factor  
WEAP gives a default value of 2 for the Runoff Resistance Factor of all land use 
types when a catchment is first added to a model. If we decrease this value, 
we will increase runoff to the river.   
Assume that, for this model, the surface runoff from forest (35% of the area) 
is usually less than from grasslands (65% of the area), perhaps because the 
grasslands have a higher average slope in addition to lacking the forest canopy. 
To characterize this difference, we will use a higher Runoff Resistance Factor for 
forest land than for grassland.  
Create a new scenario, “1 runoff resistance factor” (See the Scenarios Chapter 
to refresh your memory) so that we can evaluate how calibration parameter 
changes affect model results. 
In the following steps, input parameters for the new “runoff resistance 
factor” scenario only  
Forest Runoff Resistance Factor = 3 
Grassland Runoff Resistance Factor = 1  
 
 


============================================================
PAGE 228
============================================================

 228 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
The data inputs differentiate between land use type and increase the runoff 
for the majority of the catchment land area (the grasslands). By increasing 
direct runoff, the catchment will convert more precipitation to river flow. 
Explore model results. We can see that the runoff resistance scenario has 
higher runoff values than the reference scenario, but wet weather average 
monthly total flows are still more than two times higher than modeled flows.  
You may continue to explore model sensitivity to runoff resistance factors by further adjusting 
these values. 
2) Soil Water Capacity 
Another way to increase the amount of precipitation converted to river runoff 
is to reduce the Soil Water Capacity. The default value in WEAP is 1000 mm.  
Create a new scenario, based on the Runoff Resistance Factor Scenario, 
named “2 Soil Water Capacity”.   
For the “Soil Water Capacity” scenario, decrease Soil Water Capacity to the 
following. 
Forest Soil Water Capacity = 600 mm 
Grassland Soil Water Capacity = 500 mm 
Explore model results. We can see that the soil water capacity scenario has 
higher runoff and less evapotranspiration than the reference scenario, but 
wet weather average monthly total flows are still about two times higher 
than modeled flows.  You may explore model sensitivity to soil water capacity by 
further adjusting these values. 
3) Preferred Flow Direction 
Interflow and baseflow are also important contributors to river volume. The 
month of highest streamflow, according to an average of the flow gauge 
record for the years 2000-2007, is January (49.7 CMS on average). The lowest 
is July (1.6 CMS on average), which is likely dominated by baseflow, since 
there is very little precipitation at that time.  
WEAP’s default value for Preferred Flow Direction for both land use types is 
0.15, which directs only 15% of the water from the upper bucket into the 
river as interflow (the remaining 85% percolates into the lower bucket). To 
increase interflow, the user can direct more water from the upper bucket to 


============================================================
PAGE 229
============================================================

Adjust key parameters and conduct model sensitivity analysis 
 229 
Stockholm Environment Institute 
 
October 2023 
flow into the river by increasing the values of the Preferred Flow Direction for 
both land use types.  
Create a new scenario named “3 Preferred Flow Direction”, based on the 
Runoff resistance factor scenario. 
Change the values of Preferred Flow Direction for the Tributary headflow 
catchment to indicate that horizontal flows dominate; the forested area generates more 
horizontal flow than grassland.  
Forest Preferred Flow Direction = 0.7 
Grassland Preferred Flow Direction = 0.6 
Note that this directs less water to the lower bucket, decreasing the lower 
bucket’s soil moisture, which was already showing a trend of decline. We will 
deal with this later. 
Explore model results.  This adjustment did not have a great impact on model 
results. 
4) Root Zone Conductivity 
In our initial results for average monthly Land Class Inflows and Outflows, we 
saw that the highest value for interflow was in March (0.7 million m3/month). 
But we also know from our average monthly Streamflow results that during the 
wet season (roughly December-March) the modeled streamflow was too low 
by 45.9 million m3/month (December) to 109.7 million m3/month (January). 
(To obtain these results, subtract modeled streamflow from observed 
streamflow in the Excel file Monthly Average Streamflow Results.)  
Since the hydrograph shows that river runoff is well correlated with 
precipitation, much of this wet-season river volume should be surface run-
off.   
We can make an initial guess of the monthly interflow volume based on 
observed monthly streamflow volumes, and use that guess, combined with 
an estimate of that the relative storage of the upper bucket (Z1), and our 
estimates of root zone conductivity to mathematically estimate root zone 
conductivity (see Tips at the end of this chapter).  We will adjust the forest 
and root zone conductivity to match those calculated values.  While our 
mathematical calculations are a sound basis for establishing relationships 
between parameters, we must be aware of the uncertainty of our baseline 
assumptions.   


============================================================
PAGE 230
============================================================

 230 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
Create a new “4 Root Zone Conductivity” scenario and enter these values in your model 
for this scenario. The calibration exercise will help suggest how to further change them. 
Forest Root Zone Conductivity = 23.3 mm/month 
Grassland Root Zone Conductivity = 27.2 mm/month 
Explore model results.  Both base flows and peak flows are still low.  In 
addition to mathematically calculating root zone conductivity, it is worthwhile 
to explore model sensitivity to this parameter.   
5) Deep Water Capacity 
Our initial result for Relative Soil Moisture 2 (%) showed a declining trend.  Let’s 
test what happens if we change the default value of lower bucket capacity 
1000 mm to 500 mm.  
Create a “5 Deep Water Capacity” scenario, and change the value of  
Deep Water Capacity = 500 mm 
Explore model results. This adjustment increased the declining trend of 
Relative Soil Moisture 2. We can understand this if we imagine that if the 
same volume of water were to leave the system as before, it would represent 
double the percentage of the total volume in the second bucket. However, 
changing this parameter also will change outflows from the lower bucket. You 
may explore model sensitivity to this parameter. 
6) Deep Conductivity 
You can estimate deep conductivity in a similar way to the method used to 
calculate root zone conductivity (see Tips at the end of the chapter), by using 
observed monthly low flow values in million cubic meters per month, the area 
of the watershed, and relative soil moisture in the bottom bucket. 
Create a “6 Deep Conductivity” Scenario 
Increase the default Deep Conductivity (k2). value (20 mm/month) to 30 mm/month. 
This may encourage the lower bucket to run off water faster, which is also encouraged by 
the fact that we made the bucket smaller. 
Deep Conductivity = 30 mm/month 
Explore model results. Baseflow values have increased but are still half of 
modeled flows. 


============================================================
PAGE 231
============================================================

Adjust key parameters and conduct model sensitivity analysis 
 231 
Stockholm Environment Institute 
 
October 2023 
7) Crop Coefficient 
Crops typically exhibit annual patterns—months when they are growing a lot 
(and evapotranspiring a lot of water) and months when they are growing little, 
or not at all, so Kc is a value that may vary month by month.   
However, for our initial calibration we will assume that in this catchment, 
both the forest and grasslands are perennial and evergreen. We will not adjust 
Kc, the evaporation coefficient (or crop coefficient in agricultural context) nor 
will we vary it by month.  
 
For crops, libraries such as the FAO’s single crop coefficient 
http://www.fao.org/docrep/x0490e/x0490e0b.htm) are useful in suggesting values for Kc. 
However, these values may need to be adjusted depending on the local context of your 
model. 
10.   
View all the Results 
Run the results and look at your favorite chart that you made earlier. 
Go to Favorites in the Main Menu and select “Observed and Modeled Streamflow.” 
  
 
This looks much better than before. The simulated high flows are higher, 
though not quite as high as historical data, and the low flows are still 
approximating historical flows. 


============================================================
PAGE 232
============================================================

 232 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
If your model does not look like this, you may revert to the version “Answer 
key for Catchment Calibration Step 1. 
Check the box for “Annual Total” in the results Chart view. 
   
 
The model is still underpredicting streamflow overall, and the annual trends 
are still not following the observed data very well. Note that modeled values 
for the base year (2000) are not affected by the parameters changed in our 
new scenario. 
Check the box for “Monthly Average” for the results. 


============================================================
PAGE 233
============================================================

Adjust key parameters and conduct model sensitivity analysis 
 233 
Stockholm Environment Institute 
 
October 2023 
  
 
You can compare this to the results you saved earlier in Excel as “Uncalibrated 
Monthly Average Streamflow Results”. The chart above shows us that the model 
is still underestimating streamflow each month, and that this error is more 
pronounced during high-flow months. This may be related to how we are 
modeling runoff. 
Finally, the flow duration curve can be displayed: 
After unchecking “Monthly Average,” select “Percent of Time Exceeded” at 
the bottom of the results view. 


============================================================
PAGE 234
============================================================

 234 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
  
 
In this chart we can see that the model calculated that streamflow is larger 
than 10 MCM about 56% of the time, whereas the observed data show that 
58% of the time, the streamflow is larger than 10 MCM. For a higher flow, 
75 MCM, the model estimates that around 2% of the flows are higher, 
whereas the data show that the number should be about 25%. Again, we see 
that our model is underestimating streamflow.  


============================================================
PAGE 235
============================================================

Adjust key parameters and conduct model sensitivity analysis 
 235 
Stockholm Environment Institute 
 
October 2023 
The Relative Soil Moisture 1 (%) still shows a stable seasonal trend: 
   
 
And the Relative Soil Moisture 2 (%) initially declines quickly, but the rate of 
decline decreases so the model could be stabilizing as it progresses. This 
suggests that it might be a good idea to change the initial condition. 
   
 


============================================================
PAGE 236
============================================================

 236 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
Optimize calibration based on visual and 
statistical assessment 
Once you have tested the sensitivity of the model to key land use calibration 
parameters and you are ready to optimize your calibration, you may use 
statistical parameters to aid you, particularly if you are using automated 
optimization methods. Note that modeling experts always recommend 
reviewing results visually as well as reviewing the results of statistical 
performance metrics. 
WEAP includes built-in statistical calculations of the number of data points, 
the number of missing data points, and ten statistical measures of model 
calibration (D. N. Moriasi et al., 2007; Ferreira et al., 2020; Gupta et al., 2009; 
Yoon et al., 2015). 
The ideal values and interpretation of these ten built-in statistical measures 
are summarized in the table below and further described in the text that 
follows.  


============================================================
PAGE 237
============================================================

Optimize calibration based on visual and statistical assessment 
 237 
Stockholm Environment Institute 
 
October 2023 
Statistical measure 
Ideal and acceptable values 
Interpretation 
Pearson’s correlation 
coefficient, r 
If r = 1 a perfect positive linear 
relationship exists 
describes the degree of collinearity 
between simulated and measured data 
Pearson’s coefficient of 
determination, r2 
The ideal value is 1, values of 
0.5 to 1 are considered 
acceptable 
is an index of the degree of linear 
relationship between observed and 
simulated data 
Nash-Sutcliffe Efficiency 
(NSE) 
The ideal value is 1; values  
> 0.5 = acceptable 
> 0.6 = desired 
> 0.7 = good 
> 0.8 = very good 
how well modeled stream flow 
matches observed streamflow 
NSE on Log Transformed 
Daily Flow (LNS) 
The ideal value is 1 
same as NSE, but with reduced 
sensitivity to high and low values 
Kling-Gupta Efficiency 
(KGE) 
The ideal value is 1.  Desired 
values are above 0.8. 
compiles three metrics: correlation of 
simulated and observed values, model 
bias, and simulation of flow 
variations 
Mean Average Error (MAE)  0 indicates a perfect fit, value 
less than half a standard 
deviation is considered 
acceptable 
the degree to which modeled and 
observed flows match 
Root Mean Square Error 
(RMSE) 
Normalized Root Mean 
Square Error (NRMSE) 
0 indicates a perfect fit; 
optimize by minimizing 
Ratio of the Root Mean 
Squared Error to the 
standard deviation (RSR) 
An ideal value is zero, but 
values less than 0.7 are 
considered good. 
a measure of how much simulated 
flows deviate from observed 
hydrographs 
Percent bias (PBIAS) 
An ideal value is zero, but 
PBias of plus or minus 25% of 
is considered acceptable 
tendency of consistent over or under-
estimation of flows / match of 
simulated to observed total volume 
Pearson’s correlation coefficient (r) is an index of the degree of linear 
relationship between observed and simulated data. It ranges from −1 to 1. If 
r = 0, no linear relationship exists. If r = 1 or −1, a perfect positive or negative 
linear relationship exists.  
𝑟𝑟=
∑
(𝑄𝑄𝑜𝑜(𝑖𝑖) −𝑄𝑄𝑜𝑜𝑜𝑜𝑜𝑜
തതതതതത)(𝑄𝑄𝑖𝑖
𝑠𝑠𝑠𝑠𝑠𝑠− 𝑄𝑄𝑠𝑠𝑠𝑠𝑠𝑠
തതതതതത)
𝑛𝑛
𝑖𝑖=1
ට∑
(𝑄𝑄𝑖𝑖
𝑜𝑜𝑜𝑜𝑜𝑜−𝑄𝑄𝑜𝑜𝑜𝑜𝑜𝑜
തതതതതത)2 ∗ ∑
(𝑄𝑄𝑖𝑖
𝑠𝑠𝑠𝑠𝑠𝑠−𝑄𝑄𝑠𝑠𝑠𝑠𝑠𝑠
തതതതതത)2
𝑛𝑛
𝑖𝑖−1
𝑛𝑛
𝑖𝑖=1
 
Pearson’s coefficient of determination (r2) also compares simulated and 
measured data; it describes the proportion of the variance in measured data 
explained by the model. R2 ranges from 0 to 1, with higher values indicating 
less error variance; typically values greater than 0.5 are considered acceptable.  
𝑟𝑟2 =
⎣
⎢
⎢
⎡
∑
(𝑄𝑄𝑜𝑜(𝑖𝑖) −𝑄𝑄𝑜𝑜(𝚤𝚤)
തതതതതത)(𝑄𝑄𝑐𝑐(𝑖𝑖) −𝑄𝑄𝑐𝑐(𝚤𝚤)
തതതതതത)
𝑛𝑛
𝑖𝑖=1
ට∑
(𝑄𝑄𝑜𝑜(𝑖𝑖) −𝑄𝑄𝑜𝑜(𝚤𝚤)
തതതതതത)2 ∗ ∑
(𝑄𝑄𝑐𝑐(𝑖𝑖) −𝑄𝑄𝑐𝑐(𝚤𝚤)
തതതതതത)2
𝑛𝑛
𝑖𝑖−1
𝑛𝑛
𝑖𝑖=1
⎦
⎥
⎥
⎤
2
 


============================================================
PAGE 238
============================================================

 238 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
The Nash-Sutcliffe Efficiency (NSE) coefficient is commonly used in 
hydrological modeling to evaluate how well modeled stream flow matches 
observed streamflow. The ideal value is 1, values of 0.5 are acceptable; most 
modelers aim for values that are at or above 0.7. 
𝑁𝑁𝑁𝑁𝑁𝑁= 1 − ൥
∑
൫𝑄𝑄𝑖𝑖
𝑜𝑜𝑜𝑜𝑜𝑜−𝑄𝑄𝑖𝑖
𝑠𝑠𝑠𝑠𝑠𝑠൯
2
𝑛𝑛
𝑖𝑖=1
∑
൫𝑄𝑄𝑖𝑖
𝑜𝑜𝑜𝑜𝑜𝑜−𝑄𝑄𝑜𝑜𝑜𝑜𝑜𝑜
തതതതതത൯
2
𝑛𝑛
𝑖𝑖=1
൩ 
NSE on Log Transformed Daily Flow (LNS) is the NSE calculated with 
the logarithm of the daily streamflow (LNS). This transformation reduces the 
sensitivity of NSE to high values and increases its sensitivity to low values. 
𝐿𝐿𝐿𝐿𝐿𝐿= 1 − ൥
∑
൫𝑙𝑙𝑙𝑙𝑙𝑙𝑙𝑙𝑖𝑖
𝑜𝑜𝑜𝑜𝑜𝑜−𝑙𝑙𝑙𝑙𝑙𝑙𝑙𝑙𝑖𝑖
𝑠𝑠𝑠𝑠𝑠𝑠൯
2
𝑛𝑛
𝑖𝑖=1
∑
൫𝑙𝑙𝑙𝑙𝑙𝑙𝑙𝑙𝑖𝑖
𝑜𝑜𝑜𝑜𝑜𝑜−𝑙𝑙𝑙𝑙𝑙𝑙𝑄𝑄𝑜𝑜𝑜𝑜𝑜𝑜
തതതതതതതതതതത൯
2
𝑛𝑛
𝑖𝑖=1
൩ 
Kling-Gupta Efficiency (KGE) aims to capture three different objectives 
of model calibration: correlation of simulated and observed values, 
minimization of model bias, and optimum simulation of flow variations. The 
ideal value is 1; values above 0.8 are desired. 
𝐾𝐾𝐾𝐾𝐾𝐾= 1 −ඨ(𝑟𝑟−1)2 + (𝛼𝛼−1)2 + (𝑄𝑄𝑠𝑠𝑠𝑠𝑠𝑠
തതതതതത
𝑄𝑄𝑖𝑖
𝑜𝑜𝑜𝑜𝑜𝑜−1)2 
Where relative variability is defined as: 
 
𝛼𝛼= ∑
൫𝑄𝑄𝑖𝑖
𝑠𝑠𝑠𝑠𝑠𝑠−𝑄𝑄𝑠𝑠𝑠𝑠𝑠𝑠
തതതതതത൯
𝑛𝑛
𝑖𝑖=1
∑
൫𝑄𝑄𝑖𝑖
𝑜𝑜𝑜𝑜𝑜𝑜−𝑄𝑄𝑜𝑜𝑜𝑜𝑜𝑜
തതതതതത൯
𝑛𝑛
𝑖𝑖=1
 
Mean Absolute Error (MAE) is a simple average of the absolute value of 
the difference between observed and simulated data. An optimum value 
would be zero. A value less than half a standard deviation is considered 
acceptable. 
𝑀𝑀𝑀𝑀𝑀𝑀= 1
𝑛𝑛෍ห𝑄𝑄𝑖𝑖
𝑠𝑠𝑠𝑠𝑠𝑠−𝑄𝑄𝑖𝑖
𝑜𝑜𝑜𝑜𝑜𝑜ห
𝑛𝑛
𝑖𝑖=1
 
Root Mean Square Error (RMSE) is a measure of the mean error between 
simulated and observed flows. An optimum value would be zero. A value less 
than half a standard deviation is considered acceptable.  


============================================================
PAGE 239
============================================================

Optimize calibration based on visual and statistical assessment 
 239 
Stockholm Environment Institute 
 
October 2023 
𝑅𝑅𝑅𝑅𝑅𝑅𝑅𝑅= ඩ1
𝑛𝑛෍൫𝑄𝑄𝑖𝑖
𝑠𝑠𝑠𝑠𝑠𝑠−𝑄𝑄𝑖𝑖
𝑜𝑜𝑜𝑜𝑜𝑜൯
2
𝑛𝑛
𝑖𝑖=1
 
Normalized Root Mean Square Error (NRMSE) is the RMSE divided by 
the range of observed data. For comparison of model results for the same 
data using different parameters it provides no additional insights beyond the 
RMSE alone, but it can be a useful parameter for understanding differences 
in model performance for wet versus dry years or between different basins.  
𝑁𝑁𝑁𝑁𝑁𝑁𝑁𝑁𝑁𝑁=
𝑅𝑅𝑅𝑅𝑅𝑅𝑅𝑅
𝑟𝑟𝑟𝑟𝑟𝑟𝑟𝑟𝑟𝑟 𝑜𝑜𝑜𝑜 𝑜𝑜𝑜𝑜𝑜𝑜𝑜𝑜𝑜𝑜𝑜𝑜𝑜𝑜𝑜𝑜 𝑑𝑑𝑑𝑑𝑑𝑑𝑑𝑑=
ට1
𝑛𝑛∑
൫𝑄𝑄𝑖𝑖
𝑠𝑠𝑠𝑠𝑠𝑠−𝑄𝑄𝑖𝑖
𝑜𝑜𝑜𝑜𝑜𝑜൯
2
𝑛𝑛
𝑖𝑖=1
𝑄𝑄𝑚𝑚𝑚𝑚𝑚𝑚
𝑜𝑜𝑜𝑜𝑜𝑜− 𝑄𝑄𝑚𝑚𝑚𝑚𝑚𝑚
𝑜𝑜𝑜𝑜𝑜𝑜
 
The ratio of the root mean squared error to the standard deviation (RSR) 
is a measure of how much simulated flows deviate from observed 
hydrographs. An ideal value is zero, but values less than 0.7 are considered 
acceptable. 
𝑅𝑅𝑅𝑅𝑅𝑅= 
𝑅𝑅𝑅𝑅𝑅𝑅𝑅𝑅
𝑆𝑆𝑆𝑆𝑆𝑆𝑆𝑆𝑆𝑆𝑜𝑜𝑜𝑜𝑜𝑜
= 
ቈට∑
൫𝑄𝑄𝑖𝑖
𝑜𝑜𝑜𝑜𝑜𝑜−𝑄𝑄𝑖𝑖
𝑠𝑠𝑠𝑠𝑠𝑠൯
2
𝑛𝑛
𝑖𝑖=1
቉
ቈට∑
൫𝑄𝑄𝑖𝑖
𝑜𝑜𝑜𝑜𝑜𝑜−𝑄𝑄𝑜𝑜𝑜𝑜𝑜𝑜
തതതതതത൯
2
𝑛𝑛
𝑖𝑖=1
቉
 
Percent bias (PBIAS) is a measure of the model’s ability to match the total 
volume of flow. An ideal value is zero, but PBias of plus or minus 25% of the 
observed streamflow is considered acceptable.  
𝑃𝑃𝑃𝑃𝑃𝑃𝑃𝑃𝑃𝑃= 100 ∗ ቈ
∑
൫𝑄𝑄𝑖𝑖
𝑜𝑜𝑜𝑜𝑜𝑜−𝑄𝑄𝑖𝑖
𝑠𝑠𝑠𝑠𝑠𝑠൯
𝑛𝑛
𝑖𝑖=1
∑
൫𝑄𝑄𝑖𝑖
𝑜𝑜𝑜𝑜𝑜𝑜൯
𝑛𝑛
𝑖𝑖=1
቉ 
These ten statistical values are listed to the right of streamflow gauge 
comparisons in WEAP. Most modelers do not use all of these values for 
model calibration. They use more than one metric to be sure that their models 
simulate well: high flows, annual total flow volumes, monthly flow seasonality, 
and base flows. Studies analyzing the use of metrics for model calibration 
note that, although r and r2 are well-recognized statistics used for many types 
of models, they are very sensitive to high outliers and insensitive to model 
bias. Most modelers use metrics such as NSE and KGE to capture seasonal 


============================================================
PAGE 240
============================================================

 240 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
variations, coupled with measures such as MAE or RSR to capture peak flows, 
and PBIAS to optimize simulation of total annual flows. 
Go to the streamflow gauge comparison favorite with “Annual Total” and 
“Monthly Average” unchecked, and the “Deep Conductivity” scenario: You 
may select the statistical values displayed by WEAP by clicking on “All 
Statistics” (on the right), then “Selected statistics”, then checking which 
parameters you would like WEAP to display. Select N (number of data 
points), NSE, RSR and PBIAS. 
 
 
If you then click on the statistics tab (on top) you will see only values for the 
statistical measures you selected, and you can export the values to excel or a 
csv by clicking on the Excel icon or CSV on the right.  Note that if you select 
“Annual Total” or “Monthly Average” the number of data points, N, will be 
the number of years or months, while if you leave both blank, you will include 
all data. All statistical parameters will be calculated based on these choices.  
Note that the gold standard for model calibration, and the associated statistics, 
is the full time series of the model at the smallest time step modeled.  
However, monthly average statistics may help us to gain insights on model 
behavior.   


============================================================
PAGE 241
============================================================

Optimize calibration based on visual and statistical assessment 
 241 
Stockholm Environment Institute 
 
October 2023 
 
 
If we compare the model results for these statistical values to the desired 
values, we obtain the following: 
Parameter Model monthly 
value (N=96) 
Model average monthly 
values (N= 12) 
Target values 
NSE 
0.55 
Not applicable 
> 0.5 = acceptable 
> 0.6 = desired 
> 0.7 = good 
> 0.8 = very good 
PBIAS 
-45% 
-45% 
± < 25% = acceptable 
RSR 
0.67 
0.62 
<0.7 = good 
There is a lot more work to be done to improve this calibration. Model bias 
is still particularly low, with the model producing about half observed flows.  
The NSE and RSR also could use improvement. We included both the 
monthly and average monthly statistical values to see if these impact statistical 
results. Note that some statistical values, such as NSE, are not appropriate to 
use for an average monthly time series.   
Save a version of the model as “Catchment Calibration 1” 
Having viewed the results, we have an idea of what to change. 
11.   
Alter Model Parameters 
First, because our streamflow is still too low, we will decrease the Runoff 
Resistance Factor by 20%. This will direct more water to runoff to the river 
immediately. The values were 3 and 1 for forest and grassland, respectively. 


============================================================
PAGE 242
============================================================

 242 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
We will edit them using math operations so we can see in WEAP how the 
new values were calculated. 
In the Data View, multiply Forest and Grassland Runoff Resistance Factor values 
by 0.8 (in the 1 Runoff Resistance Factor scenario). 
 
 
We can also decrease evaporation by speeding up the travel time in the upper 
bucket. We will start by reducing the values for the Soil Water Capacity by 60%. 
This reduces the amount of water that can be stored, which will encourage 
more interflow and should increase peak flows and adjust the PBIAS that 
previously showed underestimation. Soil Water Capacity can also make WEAP 
more responsive to changes on an annual time scale. 
Multiply Forest and Grassland Soil Water Capacity values by 0.4 (in the 2 Soil 
Water Capacity scenario). 


============================================================
PAGE 243
============================================================

Optimize calibration based on visual and statistical assessment 
 243 
Stockholm Environment Institute 
 
October 2023 
 
We will also increase Root Zone Conductivity by 30% to encourage faster flow 
from the top bucket.  
Multiply the Root Zone Conductivity values by 1.3 (in the 4 Root Zone 
Conductivity scenario). 
 


============================================================
PAGE 244
============================================================

 244 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
Finally, we want the Relative Soil Moisture 2 (%) result to be stable over time. 
We saw that the lower bucket was losing water too quickly, so one response 
might be to slow the travel time.  
Multiply the Deep Conductivity by 0.4 (in the 6 Deep Conductivity scenario). 
 
 
12.   
View the Results 
Run the results and in the Results View, go to the Favorite Chart for 
Observed and Modeled Streamflow. 
Save a version of this model as “Calibration 2” 


============================================================
PAGE 245
============================================================

Optimize calibration based on visual and statistical assessment 
 245 
Stockholm Environment Institute 
 
October 2023 
 
If we look at our statistical evaluation parameters, we can see that our selected 
evaluation parameters have all improved, and now all fall within the target 
value ranges.  There are always more improvements to be made; you will have 
to decide how closely your model needs to simulate available historical data 
and how nearly it should represent known conditions. 
Parameter 
Previous model 
monthly value (N=96) 
New model monthly 
value (N=96) 
Target values 
NSE 
0.55 
0.82 
> 0.6 = desired 
> 0.7 = good 
> 0.8 = very good 
PBIAS 
-45% 
-22% 
± < 25% = acceptable 
RSR 
0.67 
0.42 
<0.7 = good 
Save a version of this model as PBIAS -22% 
To further understand your model, look at the various charts we used for 
calibration.  For the monthly streamflow gauge comparison chart above, we 
can see that, interestingly, for some years the peak flows are over-predicted, 
and other years they are under-predicted. Some years the low flows are very 
well matched, whereas other years the model under-predicts the low flows.  


============================================================
PAGE 246
============================================================

 246 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
Click on the box to see the Monthly Average for the observed and modeled streamflow. 
 
Note that the autumn months show a closer fit, on average, than the rest of 
the model. This could suggest an opportunity to edit some variables by month, 
such as the Runoff Resistance Factor, or the Kc values for the land use types.  Also 
note that statistical parameters are now calculated for N=12 (the average 
monthly values). 
We can also verify that the cycle of Relative Soil Moisture 1 (%) is still stable 
over time (you will need to uncheck “Monthly Average”). 


============================================================
PAGE 247
============================================================

Optimize calibration based on visual and statistical assessment 
 247 
Stockholm Environment Institute 
 
October 2023 
 
Relative Soil Moisture 2 (%) also appears to be steady, though the results divide 
the moisture by land use types. These are inevitably different, because they 
are percolating water differently.  
 


============================================================
PAGE 248
============================================================

 248 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
13.   
Identify Compensatory Variables 
Our model calibration has been successful, but we would be right to wonder 
about the factors that we did not change. Could we have obtained similar 
results by altering different variables? When parameters have different 
combinations but the same general calibration results, those parameters are 
called “compensatory.” In WEAP, there are many examples of compensatory 
parameter combinations. However, the issue at stake remains the same: is the 
model capturing the dynamics of the streamflow in response to climatic 
factors? 
As an exercise, we can explore what another set of variables might have 
looked like.  
Return to the Data View and delete the multiplication factor from the Deep 
Conductivity parameter (in the Deep Conductivity scenario), so the value is once again 
30 mm/month.  
We had changed this variable in hopes of providing stability for our result 
Relative Soil Moisture 2 (%), by slowing the water leaving the catchment, and 
keeping soil moisture around its initial value of 30%. 
Instead, we will assume that the water still has a fast travel time, but the initial 
soil moisture value was lower.  
Change the variable for Initial Z2 to 19% (Note: this variable can only be changed in 
Current Accounts.) 


============================================================
PAGE 249
============================================================

Optimize calibration based on visual and statistical assessment 
 249 
Stockholm Environment Institute 
 
October 2023 
 
Because soil moisture exerts a non-linear impact on travel time in the lower 
bucket (higher values of soil moisture cause the bucket to expel water faster), 
specifying a lower soil moisture value in conjunction with a faster 
conductivity rate is another way to maintain stability in the lower bucket soil 
moisture. 
Run the results. View the results for Relative Soil Moisture 2 (%). 
 
 


============================================================
PAGE 250
============================================================

 250 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
This chart looks similar to our prior calibration results. 
Did this alteration in the characterization of our lower bucket change 
statistical results? 
Return to the Favorite Chart for Streamflow Gauge Comparison and view the 
statistical results. 
Parameter 
Calibration l 
model value, 
monthly 
Calibration 2 
model value, 
monthly 
Compensatory 
variable model 
value, monthly 
Target values 
NSE 
0.55 
0.82 
0.82 
> 0.6 = desired 
> 0.7 = good 
> 0.8 = very good 
PBIAS 
-45% 
-22% 
-22% 
± < 25% = 
acceptable 
RSR 
0.67 
0.42 
0.43 
<0.7 = good 
The similarity of the results shows that while the different parameter values 
changed individual results (the soil moisture in the lower bucket over the 
course of the model), the overall model was not greatly impacted. 
In some instances, experienced modelers may be able to consider the model 
and determine that one set of compensatory parameter values is more realistic 
than another. In another case, like this one, either set could be equally good, 
and since they are effectively indistinguishable in terms of the results 
produced, either can be used within the WEAP model. As the saying goes in 
English, there are many ways to skin a cat. 
Model Calibration Tips 
14.   
Use Relative References and Key Assumptions for Large Models 
1) Use Relative References for Parameters for Distinct Land Use Types 
Experienced WEAP modelers recommend setting up the model such that a 
calibration change for one parameter is proportionally reflected in all land use 
types. This practice of relative references recognizes the impacts that land use 
type can have, while simplifying changes to the model. An example is 
illustrated in the following table.  Note that preferred flow direction does not 
use this strategy in this example, as it cannot surpass a value of 1.  Knowing 
how land use types might differ in their hydrologic characteristics requires a 
good understanding of the area, and ideally measurements, if available.  We 


============================================================
PAGE 251
============================================================

Model Calibration Tips 
 251 
Stockholm Environment Institute 
 
October 2023 
also have the option to pick different values for different land use types. Not 
all variables change according to land use type—for instance, Freezing and 
Melting temperatures are the same for the whole catchment, and the lower 
bucket of the Soil Moisture Method is too deep to be affected by land use 
differences on the surface. 
Example Hydrologic Calibration Parameter Set Up 
 
Kc 
Runoff Resistance 
Factor 
Preferred flow 
direction 
Root zone 
conductivity 
Soil Water 
Capacity 
Agriculture 
1.1 * Grassland 
2 
0.85 
20 
1000 
Forest 
1.25 * Grassland 
2 * Agriculture 
0.85 
Agriculture 
2 * Agriculture 
Grassland 
1 
1.5 * Agriculture 
0.85 
Agriculture 
1.5 * Agriculture 
Wetland 
1.25 * Grassland 
3 * Agriculture 
0.5 
Agriculture 
3 * Agriculture 
Urban 
0.7 * Grassland 
0.5 * Agriculture 
0.95 
Agriculture 
0.5 * Agriculture 
Shrubland 
Grassland 
1.5 * Agriculture 
0.85 
Agriculture 
1.5 * Agriculture 
Barren or Sparse 
Vegetation 
0.8 * Grassland 
0.75 * Agriculture 
0.9 
Agriculture 
0.75 * Agriculture 
Open Water 
Grassland 
0.2 * Agriculture 
0.95 
Agriculture 
0.2 * Agriculture 
Snow and Ice 
0.5 * Grassland 
0.2 * Agriculture 
0.95 
Agriculture 
0.2 * Agriculture 
2) Use Key Assumptions for Large Models 
It can be tedious to edit values by catchment, especially when working with 
multiple catchments that might all have the same values within land use type. 
To ease the calibration process for large models, we recommend structuring 
your catchment parameters within Key Assumptions. If you are not familiar 
with Key Assumptions, see the WEAP Tutorial Chapter: Basic Tools. In this 
way, you can easily edit parameters for multiple catchments at a time.   
The more catchments and land use types a model has, the more helpful it will 
be to structure the Key Assumptions for the calibration process. 
3) Use the Monthly Time Series Wizard 
The default for the parameters is for each to have one value for the entire 
year. However, it may make sense to change them by month. This introduces 
an additional 11 values to alter in the calibration process for each parameter. 
However, not all parameters lend themselves to monthly values; it is the 
surface that is most affected by seasonal changes.  
There are particularly compelling reasons to calibrate the following two 
variables monthly: Runoff Resistance Factor, and Kc. If foliage and 
groundcover changes over the course of the year, Kc may vary on a monthly 
basis and landcover might discourage runoff (a higher Runoff Resistance 
Factor) during some time steps more than others. 


============================================================
PAGE 252
============================================================

 252 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
To calibrate based on the monthly values, examining the Monthly Averages 
in Results will show for which months the model returns below-expected 
streamflow, and for which months above-expected streamflow. 
15.   
Use Mathematical Calculations to Estimate Root Zone Conductivity 
and Deep Conductivity 
1) Root Zone Conductivity 
A process you can uses to estimate root zone conductivity is:  
• Identify the highest monthly streamflow and the lowest monthly 
streamflow (m3/month) in the observed timeseries. 
• Assume the lowest monthly streamflow represents the baseflow. 
• Estimate monthly interflow volume (m3/month) as a value higher than 
baseflow and lower than surface water runoff, using the rainfall-runoff 
hydrograph as a rough guide.   
• Divide the interflow volume (m3/month) by the area of the basin (m2) 
for an estimate of the depth of interflow (m/month). 
• Use the equation: Qi = ks * Z12 (where Qi is the depth of the interflow, 
ks is the root zone conductivity, and Z1 is the initial saturation of the 
first bucket in the Soil Moisture Method).  
Review observed average monthly streamflow values in MCM.  The highest 
average monthly streamflow is 133 MCM (January) and the lowest is 4.3 
MCM (July). We will assume the baseflow is 4.3 MCM, and calculate surface 
runoff as 20% of 133, or 27 MCM.  
 
Since the rainfall-runoff hydrograph shows that river runoff is well correlated 
with precipitation, much of this wet-season river volume should be surface 


============================================================
PAGE 253
============================================================

Model Calibration Tips 
 253 
Stockholm Environment Institute 
 
October 2023 
run-off.  We used a starting point assumption of an average monthly interflow 
component of 12 million m3 (MCM) during the wet season.  
The value 12 million m3 in an area of 1500 km2 translates to an equivalent 
depth of 8 mm/month of interflow: 
We then plug this value into the soil moisture method equation that calculates 
interflow, and use it to calculate root zone conductivity: 
Where interflow = 8 mm/mo, Preferred Flow Direction = 0.7 (forest) and 0.6 
(grasslands), and an estimated Relative Soil Moisture 1 (%) value of 70%.  
Rearranging the above equation to solve for Root Zone Conductivity and 
plugging in the above values yields a Root Zone Conductivity for forest of 23.3 
mm/month and for Grassland of 27.2 mm/month.  
2) Deep Conductivity 
A similar process can be used for estimating deep conductivity.   
If you assume that the entire watershed uniformly supplies the 4.3 MCM of 
baseflow and divide this low summer volume by the watershed’s total area 
(1500 km2), you can estimate the equivalent average baseflow runoff depth as 
2.9 mm/month.  
We can relate a baseflow runoff depth to Deep Conductivity and the square of 
the layer’s relative storage (Z2) using the equation from the soil moisture 
method: 
Looking at the result Relative Soil Moisture 2 (%), it is difficult to guess the stable, 
average, long-term relative storage of this bottom layer (Z2). Perhaps it has 
changed now that the Deep Water Capacity is halved. Here we will estimate Z2 
to be 30%.  We calculate a value of 31 mm/month, and round it to 30 
mm/month for our initial estimate of deep conductivity. 
16.   
Calibration Optimization Steps 
The calibration optimization process should follow these steps: 
1) Export and copy results into separate document so you can review them after 
you change the parameters. 
2) Change parameter values. 


============================================================
PAGE 254
============================================================

 254 
 
Catchment Calibration 
October 2023 
 
 
WEAP Tutorial 
3) Run Results. 
4) You might want to save versions of the model as you experiment with changing 
the parameter values. You can go to Area/Save Version to save the ones you 
think are good. That way, if your calibration efforts produce something that is 
not an improvement, you can go back to a previous version. It is recommended 
to save versions without the results because results take up a lot of memory, and 
they can always be recalculated. 
5) Repeat until your criteria for calibration are satisfied. 
6) Quantify the statistical parameters. 
The example in this module demonstrated two iterations of the manual 
calibration process; WEAP’s automatic calibration program PEST is introduced 
in the Snow Hydrology Chapter of this Tutorial.


============================================================
PAGE 255
============================================================

 
 
WEAP 
Water Evaluation And Planning System 
 
Snow Hydrology  
 
A TUTORIAL ON 
Explore the Pre-Existing Model ............................ 256 
Enter Catchment Climate and Calibration 
Data ..................................................................... 258 
Explore the Model Sensitivity ................................. 262 
Calibrate with PEST ............................................ 265 
Appendix .............................................................. 268 
 
October 2023 
 
 
 
 
 


============================================================
PAGE 256
============================================================

 256 
 
Snow Hydrology 
October 2023 
 
 
WEAP Tutorial 
Note: 
For this module you will need to have completed the previous modules (“WEAP in 
One Hour, Basic Tools, and Scenarios) or have a fair knowledge of WEAP (data 
structure, key assumptions, expression builder, creating scenarios). To begin this 
module, go to the Main Menu, select “Revert to Version” and choose the version 
named “Starting Point for Snow Hydrology and PEST Calibration module.”  
This exercise will familiarize you with WEAP’s snow accumulation and melt 
routines of the Soil Moisture Method (SMM). In addition, you will learn how to 
use PEST to help automate the model calibration process.  For this exercise, we 
will model the streamflow produced in a nearby mountain that has snowfall. In 
general, it is a good idea to divide catchments by elevation bands for entering 
temperature data because temperature typically decreases with increasing 
elevation.1 However, for this example, we assume that there is enough uniformity 
in the area to warrant building a single catchment, and that there is a snow gauge 
within the area of this catchment.  
Explore the Pre-Existing Model 
When collaborating with other modelers, it is important to know how to 
explore pre-existing models. 
The snow tutorial module is a historical model that uses weekly time steps. 
This means that we have entered data in the model to accommodate the 
weekly timestep instead of a monthly timestep.  
Using a weekly model assumes that we are looking at a smaller spatial scale 
than a model with a monthly timestep, because WEAP assumes that it will 
take one week for water entering the headflow of the model to arrive at the 
outflow of the model. Weekly and monthly models are thus not generally 
interchangeable; however, we have made the switch for the purpose of this 
example. 
 
1 Dry air cools at about 10°C/km (the ‘dry adiabatic lapse rate’), while moist air usually cools at less than 
6°C/km (the ‘moist adiabatic lapse rate’) 


============================================================
PAGE 257
============================================================

Explore the Pre-Existing Model 
 257 
Stockholm Environment Institute 
 
October 2023 
Go to Main Menu> General/Years and Time Steps 
 
Not only is this a weekly model, but it starts on October 1, 1981. Water years 
in the United States typically start in October. In the dropdown menu “Time 
Step Name Format,” the format “Oct 1 (first date)” is selected, but there are 
other formats available to label the various weeks of the model. 
Close the Years and Time window and go into the Data View to see the data in the 
catchment “Snowy Mountain.”  
The catchment’s land area is dominated by tree cover (62%). 


============================================================
PAGE 258
============================================================

 258 
 
Snow Hydrology 
October 2023 
 
 
WEAP Tutorial 
 
The variables Area, Kc, Soil Water Capacity, Deep Water Capacity, Deep 
Conductivity, Preferred Flow, Initial Z1, Initial Z2, Runoff Resistance Factor, 
and Root Zone Conductivity already have data entered. Most of the root zone 
(upper bucket) variables have the same value for the different land use types, 
with the notable exception of the Runoff Resistance Factor. 
We also see that under Key Assumptions, there is a new assumption: Albedo, 
with both NewSnow and OldSnow values (explained below). 
Enter Catchment Climate and Calibration Data 
1.   Enter Climate Data 
The climate data can be found in a file called SnowyMountain.csv in the 
WEAP Tutorial folder\Additional Files. You can look at this file for an 
example of the data format for a weekly model. 
Use the ReadFromFile function to enter data for precipitation (data column 1), 
temperature (data column 2) and humidity (data column 3) for Snowy Mountain.  You 
may use the ReadFromFile wizard to help you build the expression or type the 
expression in directly.  


============================================================
PAGE 259
============================================================

Enter Catchment Climate and Calibration Data 
 259 
Stockholm Environment Institute 
 
October 2023 
 
 
Enter the data for  
Freezing Point  
-5°C (default) 
Melting Point  
10°C 
Data for wind, cloudiness fraction and latitude are already entered. 
Albedo (i.e., surface reflectance) is a very important parameter for snow 
routines. It controls the net radiation available for snow melt. In this region, 
albedo of old snow needs to be distinguished from albedo of new snow. 
Albedo of old snow is lower (as it gets dirtier) than new snow. You must have 
WEAP version 2016 or newer to access the albedo data tab to enter an 
expression to control the effect of age of snow on albedo. 
Go to the Albedo data tab. Using the Expression Builder to make an expression, enter 
the equation:  
If(PrevTSValue(Snow Depth[m])=0, Albedo Lower Bound,  
    PrevTSValue(Snow Depth[m],1)>PrevTSValue(Snow Depth[m],2),  
           Key\Albedo\NewSnow,  
    Max(PrevTSValue(Albedo)-0.1, Key\Albedo\OldSnow)) 


============================================================
PAGE 260
============================================================

 260 
 
Snow Hydrology 
October 2023 
 
 
WEAP Tutorial 
We have now given WEAP instructions for albedo values for three 
circumstances: 
1) If previous time step had no snow, then Albedo = Albedo 
Lower Bound, which defaults to 0.15 
2) Otherwise, if previous time step had new snow (the snow 
depth in the previous timestep is greater than two timesteps 
earlier), then Albedo = “NewSnow” = 0.8 
3) Otherwise, Albedo = albedo in the previous timestep minus 
0.1 (but not less than OldSnow = 0.4). 
Note that NewSnow and OldSnow albedo values are in the Key Assumptions 
and can be changed to help the model better fit the data. The Appendix for 
this module explains this equation in more detail. 
2.   Enter Observed Snow Data 
We will now add snow accumulation data from the Snowy Mountain snow 
gauge. This gauge is located within the Snowy Mountain catchment. 
In the Snowy Mountain Catchment, under Climate >Snow Accumulation 
Gauge.   
Use the ReadFromFile function to read the data from SnowGauge.csv (in Additional 
Files of the Tutorial folder) 
Note that this file has missing data, so the “Missing Value Method”  in the 
ReadFromFile Wizard will default to “Mark” which leaves the data value 
empty. For more, see the Help menu about the ReadFromFile Wizard. 
The expression will appear as: 
 
3.   View the Results 
Run the model results.  


============================================================
PAGE 261
============================================================

Enter Catchment Climate and Calibration Data 
 261 
Stockholm Environment Institute 
 
October 2023 
 
View the result Catchments/Snow Gauge Comparison 
 
Save the chart as a favorite.  
Look at the same data as a weekly average. 
 
Here we can see that in general, WEAP’s modeled values for snow depth are 
too high between October and February and then too low until July, when 
the snow melts altogether. Compared to the gauge, the model is producing 
and melting snow too early. 


============================================================
PAGE 262
============================================================

 262 
 
Snow Hydrology 
October 2023 
 
 
WEAP Tutorial 
Explore the Model Sensitivity 
Now that you have a working model you can explore the sensitivity of model 
results to changes in the parameters.   
To explore model sensitivity, you will first create a new scenario in which you 
will alter parameter values.  You will then be able to compare the new scenario 
results to the “reference” scenario results and see the impacts of changing the 
parameter values. 
4.   Manual Changes within a Scenario 
We will first examine the impacts of changing the melting point parameter 
for snow. 
Add a new scenario that inherits from Reference called “Melt Temp.” 
 
In the Snowy Mountain catchment, in the Melt Temp scenario, change the “Melting 
Point” value to 8.  Before you run the model, think about how you expect this to change 
the results. 


============================================================
PAGE 263
============================================================

Explore the Model Sensitivity 
 263 
Stockholm Environment Institute 
 
October 2023 
 
Run the model by clicking on Results.   
We can compare snow accumulation to the modeled snow for both scenarios.  
Go to Favorites and choose the chart with Snow Gauge Comparison. View the results 
for the Melt Temp Scenario 
 
View as a weekly average. 


============================================================
PAGE 264
============================================================

 264 
 
Snow Hydrology 
October 2023 
 
 
WEAP Tutorial 
 
The lowered melting temperature reduces the range of temperature in which 
water can exist as snow.  Therefore, the snow accumulation is less. Between 
October and January, this produces similar results to the snow accumulation 
gauge, but after January, we see that the snow is melting too early, like the 
reference scenario. But how do the two scenarios compare to each other?  
Now look at the result “Snow Depth (MWE)”.  Choose “All Scenarios” from the 
dropdown on the right side of the screen.   
 


============================================================
PAGE 265
============================================================

Calibrate with PEST 
 265 
Stockholm Environment Institute 
 
October 2023 
In our “Melt Temp” scenario, the snow is melting even earlier in the year than 
for the Reference scenario. 
When examining the impacts of changing different parameters, it’s useful to 
start with a fairly substantial change (a few degrees C) to get a sense of how 
it will affect the model. Then you can select a more appropriate magnitude of 
change. This activity can be performed for the freezing temperature as well 
as for changes in other parameters. 
Calibrate with PEST 
WEAP links to a parameter estimation tool (PEST) that can help produce 
results that match historical data records by examining a range of parameter 
values and combinations thereof. With PEST, the user can select which 
parameters to calibrate using the historical records available for entry in 
WEAP: streamflow gauges, catchments with snow depth data and reservoir 
levels with volume data. A PEST calibration produces combinations of 
parameter values to enable the model results to approximate the observed 
data. PEST will not always find the best solutions but can be a good place to 
start. To learn more about PEST, see the WEAP help menu: (PEST 
Calibration), or see www.pesthomepage.org. 
Create a new scenario called “PEST calibration” that inherits from Reference 
 
Open PEST Calibration (Advanced > Pest Calibration).  
Click + Add to add the Snowy Mountain variables below with the following 
information: 
Parameter  
 
 
Lower Bound Upper Bound Initial Value  
Melting Point 
0 
10 
5 
Freezing Point 
-10 
0 
-5 


============================================================
PAGE 266
============================================================

 266 
 
Snow Hydrology 
October 2023 
 
 
WEAP Tutorial 
Then select the following: 
Catchments (with snowpack data):  
Snowy Mountain 
Years: 1983-2000 (Choose “Selected”, click the button to select All, then deselect ‘82) 
Scenarios to Calibrate: PEST Calibration 
Modify Parameters:  
Current Accounts 
 
 
Unclick 
Normalize Observation Data  
Unclick 
 
 
When WEAP normalizes observation data, PEST will use the reciprocal of 
each observation value as its weight.  For example, if the observations were 
10, 30 and 25, the weights would be 1/10, 1/30 and 1/25.  This weighting 
will ensure that the larger values, such as flood flows in the river, do not 
outweigh of the smaller values, such as low flows.  This option is essential 
when simultaneously calibrating different types of observations (e.g., 


============================================================
PAGE 267
============================================================

Calibrate with PEST 
 267 
Stockholm Environment Institute 
 
October 2023 
streamflow and reservoir storage), because the two types are not comparable 
(different units, and could be many orders of magnitude different).  It is also 
helpful when calibrating streamflow, so that low flows will have equal weight 
as high flows.  However, we currently have only one record of observation, 
and we will see what results PEST produces when it is not normalizing large 
and small flows. 
Click “Build Files and Run PEST”. 
PEST will take control, running the model many times. 
Once it stops, results for final parameter values found by PEST will show in 
the Scenarios Explorer. You can also see them in the Data View for the PEST 
Calibration Scenario. 
What were the PEST values for the parameters entered above?  
You may receive slightly different results. Our outputs were: 
 
 
Run the results.  
How is the snow simulation vs the gauge?  Is it better or worse than the Reference 
(uncalibrated) scenario? 
 
Parameter 
PEST Calibration Value 
Melting threshold 
6.29 
Freezing Threshold 
-1.38 


============================================================
PAGE 268
============================================================

 268 
 
Snow Hydrology 
October 2023 
 
 
WEAP Tutorial 
Appendix 
Note:  
This model used a custom equation for snow albedo evolution. The same equation 
should NOT be used in other model regions. You will have to figure out what 
makes sense in your own geographic region and timestep. 
Following is an explanation of the snow albedo equation presented in Section 
1.  . 
First, we will tell WEAP that if the previous time step had no snow, WEAP 
will use an Albedo value of Albedo Lower Bound (which defaults to 0.15). At 
the start of the model, there is no previous time step, but there is a parameter 
called “Initial Snow” which WEAP will use as the snow depth of the timestep 
before the model starts. The user can set this value according to the 
circumstances in their system at the start of the model’s time period. 
To tell WEAP the albedo value for no snow, we will use the “If” statement, 
in the format If(test 1, value if test 1is true, test 2, value if test 2 is true, …, value if all 
tests are false).  
If(PrevTSValue(Snow Depth[m])=0, Albedo Lower Bound, 
Now we have to tell WEAP what to do if there was snow in the previous 
timestep.   We want to determine whether there was new snow or old snow, 
as they have different albedo values. As the test 2 part of our “If” statement, 
we will ask WEAP if the snow depth in the previous timestep is greater than 
the snow depth in the time step prior to that. Values 1 and 2 in this 
PrevTSValue expression denote how many timesteps previous to look (one 
or two). In the event that the snow was greater in the most recent time step, 
WEAP will give Albedo the value of NewSnow from the Key Assumptions, 
which was 0.8 in this exercise. 
If(PrevTSValue(Snow Depth[m])=0, Albedo Lower Bound,  
    PrevTSValue(Snow Depth[m],1)>PrevTSValue(Snow Depth[m],2),  
           Key\Albedo\NewSnow,  
However, in the event that there was snow, but it was not new snow, we must 
tell WEAP how to calculate the Albedo value. This will be the value if all tests 
are false part of the “If” statement.  We will ask it to choose the maximum of 
two values:  


============================================================
PAGE 269
============================================================

Appendix 
 269 
Stockholm Environment Institute 
 
October 2023 
1) The albedo of the previous time step minus 0.1 
2) The albedo of the Key Assumption OldSnow (0.4) 
If(PrevTSValue(Snow Depth[m])=0, Albedo Lower Bound,  
    PrevTSValue(Snow Depth[m],1)>PrevTSValue(Snow Depth[m],2),  
           Key\Albedo\NewSnow,  
    Max(PrevTSValue(Albedo)-0.1, Key\Albedo\OldSnow)) 
Therefore, if there is snow on the ground, the value of Albedo will be between 
0.4-0.8, depending on how long it has been since the last new snow.  After 
the last snow has melted, the albedo will fall to 0.15. 
. 


============================================================
PAGE 270
============================================================



============================================================
PAGE 271
============================================================

 
  
WEAP 
Water Evaluation And Planning System 
 
Glaciers 
 
A TUTORIAL ON 
Modeling a Glacier ................................................ 272 
Enter Catchment Climate ...................................... 273 
Effect of Cooling Temperatures ............................... 276 
Effect of Warming Temperatures ............................ 279 
Parameter Sensitivity (Radiation Coefficient) ........... 282 
 
October 2023 
 
 
 
 
 
 
 


============================================================
PAGE 272
============================================================

 272 
 
Glaciers 
October 2023 
 
 
WEAP Tutorial 
Note: 
For this module you will need to have completed the previous modules (“WEAP in 
One Hour, Basic Tools, and Scenarios) or have a fair knowledge of WEAP (data 
structure, key assumptions, expression builder, creating scenarios). To begin this 
module, go to the Main Menu, select “Revert to Version” and choose the version 
named “Starting Point for Glacier module.”  
In this activity, we will show how severe climate conditions which lead to the 
accumulation or melt of ice play out in a glacier’s formation or vanishing. 
After modeling a glacier under one set of conditions, two additional scenarios 
of cooling and warming conditions are explored. Additionally, a simple 
sensitivity analysis regarding the radiation coefficient is conducted to 
investigate the impact of this parameter on glacier melting. 
Modeling a Glacier 
For this exercise, we will model the glaciation of an existing snow depth which 
represents the initial status of the glacier. As we did in the Snow Hydrology 
exercise, we will assume sufficient regularity in the area for a single-catchment 
case study.  
1.   Set Up the Model to Include Glaciers 
With “Snowy Mountain” catchment selected in Data, you should find 
“Model Glaciers?” under the “Advanced” tab.  
                   Advanced > Model Glaciers? 
Check the box of “Model Glaciers?”, and you can see now that a new tab 
called “Glacier” has been generated next to “Climate” tab.  (You may need 
to click on a different tab first for the Glacier tab to appear.)  


============================================================
PAGE 273
============================================================

Enter Catchment Climate 
 273 
Stockholm Environment Institute 
 
October 2023 
 
Enter Catchment Climate 
2.   Change Modeling Years and Enter Climate Data 
The climate data can be found in a file called Glacier.csv in the WEAP 
Tutorial folder\Additional Files. You can look at this file as an example of 
a data format for a weekly model.  We will be using a weekly model with a 
water year starting on October 1, as we did with the Snow Hydrology 
chapter.  You will see that the data begins in water year 2011 and ends in 
2033.  
Change the modeled years to begin in 2012 and end in 2030 (under 
General\Years and Time Steps).   
Set the melting point temperature to 10°C (the default is 5°C), on the 
Climate tab for Snowy Mountain. 
Review the following formula for albedo (also in the climate tab), described 
and input in the Snow Hydrology chapter: 
If(PrevTSValue(Snow Depth[m])=0, Albedo Lower Bound, ~    
PrevTSValue(Snow Depth[m],1)>PrevTSValue(Snow Depth[m],2), ~           
Key\Albedo\NewSnow, ~    Max(PrevTSValue(Albedo)-0.1, 
Key\Albedo\OldSnow)) 


============================================================
PAGE 274
============================================================

 274 
 
Glaciers 
October 2023 
 
 
WEAP Tutorial 
Use the ReadFromFile function to enter data for precipitation (data 
column 1), temperature (data column 2) and humidity (data column 3) for 
Snowy Mountain. You may use the ReadFromFile wizard to help you build 
the expression, or type the expression in directly: 
ReadFromFile(Additional Files\Glacier.csv, “Precipitation[mm]”) 
ReadFromFile(Additional Files\Glacier.csv, “Temperature[C]”) 
ReadFromFile(Additional Files\Glacier.csv, “Humidity [%]”) 
We will keep the remaining tabs under “Climate” at the default values. 
3.   Enter Glacier Data 
Most of the parameters under the “Glacier” tab already have default values 
(i.e., Ice Melting Point: 1°C, Radiation Coefficient: 50%, …). For the sake 
of this example: 
Input an initial Ice Depth of 8 m as shown. 
 
 
The Scaling Factors (b & c) are two parameters that are used to relate 
glacial ice volume to glacial area.  We will leave them at the default values 
(1.36 & 0.048) that were derived from an analysis of 144 glaciers around 
the world (Bahr, D. B., M. F. Meier, and S. D. Peckham, “The physical 


============================================================
PAGE 275
============================================================

Enter Catchment Climate 
 275 
Stockholm Environment Institute 
 
October 2023 
basis of glacier volume-area scaling,” J. Geophys. Res. 102 (B9): 20355–
20362), 1997.  
4.   View the Results 
Run the model.  
 
View the result Glacier Depth 
 
 
When looking at the glacier depth graph, we conclude that although the 
depth showed some fluctuations, there is neither an upward nor a 
downward trend as depth grew and shrank within the approximate range 
of 7 to 8 meters. 


============================================================
PAGE 276
============================================================

 276 
 
Glaciers 
October 2023 
 
 
WEAP Tutorial 
View the result Glacier Volume 
 
Also, if we look at the timeseries of the glacier volume, we see the same 
pattern as the depth, with no significant increasing or decreasing trend. 
Effect of Cooling Temperatures 
With the uncertainty around climate projections growing, a scenario where 
cooler conditions would prevail in the future is explored here to model the 
impact on the glacier dynamics. 
5.   Create a Scenario for Cooling Temperatures 
First, we will add a scenario called “Cooling Temperatures” that is based 
on the “Reference” scenario. 


============================================================
PAGE 277
============================================================

Effect of Cooling Temperatures 
 277 
Stockholm Environment Institute 
 
October 2023 
 
 
6.   Enter Climate Data for the Added “Cooling Temperatures” 
Switch to the “Cooling Temperature” scenario, then add the new climate 
data, which is in a file called Cooling Climate.csv in the WEAP Tutorial 
folder\Additional Files and represents a climate that is cooler than that 
used in the Reference scenario.  
Use the ReadFromFile function to enter data for precipitation (data column 1), 
temperature (data column 2) and humidity (data column 3) for Snowy 
Mountain. You may use the ReadFromFile wizard to help you build the 
expression, or type the expression in directly: 
ReadFromFile(Additional Files\ Cooling Climate.csv, “Precipitation[mm]”) 
ReadFromFile(Additional Files\ Cooling Climate.csv, “Temperature[C]”) 
ReadFromFile(Additional Files\ Cooling Climate.csv, “Humidity [%]”) 


============================================================
PAGE 278
============================================================

 278 
 
Glaciers 
October 2023 
 
 
WEAP Tutorial 
 
We will keep the remaining tabs under both “Climate” and “Glacier” at 
the same default values (Note that there will be no need to input an initial 
glacier depth since it gets inherited from the “Reference” scenario). 
7.   View the Results 
Run the model.  
 
View the result Glacier Depth, choosing “All Scenarios” for the legend. 
 
  


============================================================
PAGE 279
============================================================

Effect of Warming Temperatures 
 279 
Stockholm Environment Institute 
 
October 2023 
Unlike the “Reference” scenario (in red), where no significant trend was 
detected, the “Cooling Temperatures” scenario shows a considerable 
upward trend, with the glacier depth growing from 8 to almost 13 meters 
during the 20-year interval. 
View the resulting Increase in Ice 
Set a comparison by switching from  
“No Comparison” to “Relative to Reference” 
to show the effect of the cooling conditions on the increase in ice when 
using the “Reference” scenario as a baseline. 
  
 
We can clearly see that the cooling conditions have led to the accumulation 
of considerable amounts of ice within the glacier, with the greatest 
advances occurring at the end of year 2026. 
Effect of Warming Temperatures 
Because a warmer climate is a more likely projection, a scenario where 
warmer conditions would prevail in the future is explored here to model 
the impact of the proposed conditions on the glacier dynamics. 


============================================================
PAGE 280
============================================================

 280 
 
Glaciers 
October 2023 
 
 
WEAP Tutorial 
8.   Create a Scenario for Warming Temperatures 
First, we will add a scenario called “Warming Temperatures” that is 
based on the “Reference” scenario. 
 
 
9.   Enter Climate Data for the Added “Warming Temperatures” 
Switch to the “Warming Temperature” scenario. Then, add the climate 
data, which is in a file called Warming Climate.csv in the WEAP Tutorial 
folder\Additional Files.  
Use the ReadFromFile function to enter data for precipitation (data column 1), 
temperature (data column 2) and humidity (data column 3) for Snowy 
Mountain.  You may use the ReadFromFile wizard to help you build the 
expression, or type the expression in directly: 
ReadFromFile(Additional Files\ Warming Climate.csv, “Precipitation[mm]”) 
ReadFromFile(Additional Files\ Warming Climate.csv, “Temperature[C]”) 
ReadFromFile(Additional Files\ Warming Climate.csv, “Humidity [%]”) 
We will keep the remaining tabs under both “Climate” and “Glacier” at 
the same default values. 
10.   
View the Results 
Run the model.  


============================================================
PAGE 281
============================================================

Effect of Warming Temperatures 
 281 
Stockholm Environment Institute 
 
October 2023 
View the result Glacier Depth 
Be sure that you have selected “No comparison.” 
  
 
In contrast to the “Cooling Temperatures” scenario, the “Warming 
Temperature” one leads to a significant downward trend, with the glacier 
depth shrinking from 8 to below 4 meters during the 20-year interval. 
View the result Decrease in Ice (Melt) 
With only the “Warming Temperatures” and “Cooling Temperatures” 
scenarios selected, set a comparison by switching from  
“No Comparison” to “Relative to Reference” 
And select “Decrease in Ice (Melt)” to view changes in the volume of ice 
for each of the two scenarios when compared to the “Reference” scenario. 


============================================================
PAGE 282
============================================================

 282 
 
Glaciers 
October 2023 
 
 
WEAP Tutorial 
  
 
The positive green lines show that the “Warming Temperatures” scenario 
causes significant amounts of ice to melt in comparison with the 
“Reference” scenario. The negative blue lines, for the “Cooling 
Temperatures” scenario, indicate that ice levels increase for this scenario. 
Parameter Sensitivity (Radiation Coefficient) 
Since the Warming Temperature scenario is a more realistic script, given 
the ongoing global warming crisis, the effect of variation of the parameter 
of radiation coefficient is investigated through a simple sensitivity analysis. 
Two sub-scenarios based on the Warming Temperatures scenario are 
added. With a default value of 50% radiation coefficient used in the 
previous scenario, the effects of using two more extreme points (high and 
low) are explored, and the outcomes from these values are analyzed. 
11.   
Create Scenarios for Different Coefficient Radiation Values 
First, we will add 2 scenarios named “High Radiation Coefficient” and 
“Low Radiation Coefficient”, with both scenarios based on the 
“Warming Temperatures” scenario. 


============================================================
PAGE 283
============================================================

Parameter Sensitivity (Radiation Coefficient) 
 283 
Stockholm Environment Institute 
 
October 2023 
 
12.   
Enter Data 
For these sub-scenarios, climate data will be inherited from the “Warming 
Temperatures” scenario. However, the only change will be within the 
glacier data, where the impact of using different values for the radiation 
coefficient will be explored. 
With the “High Radiation Coefficient” scenario selected, we will input a 
test value of 75% for the radiation coefficient under “Glacier” tab for the 
data of “Snowy Mountain” Catchment. 
Radiation Coefficient  
75 % 
 
 


============================================================
PAGE 284
============================================================

 284 
 
Glaciers 
October 2023 
 
 
WEAP Tutorial 
Switching to the “Low Radiation Coefficient” scenario, we will assign a 
radiation coefficient value of 25% under “Glacier” tab for the data of 
“Snowy Mountain” Catchment. 
Radiation Coefficient  
25 % 
 
13.   
View the Results 
Run the model.  
 
 
 
View the result Glacier Depth 
Instead of selecting all the scenarios, select only three of them: Warming 
Temperatures, High Radiation Coefficient, and Low Radiation Coefficient. 
Be sure that you have selected “No comparison.” 


============================================================
PAGE 285
============================================================

Parameter Sensitivity (Radiation Coefficient) 
 285 
Stockholm Environment Institute 
 
October 2023 
  
 
Although all the three selected scenarios show shrinkages in glacier 
depth, the rates at which the glacier recedes vary greatly.  Under the 
original “Warming Temperatures” scenario, the glacier takes almost 14 
years to recede from 8 to 6 meters. For the “High Radiation Coefficient” 
scenario, it takes only 10 years to experience the same shrinkage. For the 
“Low Radiation Coefficient” scenario, the glacier requires the entire 20-
year time series to experience the same shrinkage. This shows the huge 
effect of the radiation coefficient on how fast the glacier could melt. 
Some of the factors that impact radiation, and as a result the glacier melt 
rates, include wind speed, humidity, and sensible heat flux. These factors 
are known to vary geographically. For instance, higher humidity and wind 
speed, as in oceanic regions, result in a higher degree day factor (Degree 
Day Factor is the amount of melting that occurs for each positive degree 
day). Positive Degree Day sum represents the amount of melt per degree. 
When ice melt takes place through sublimation, as in terrestrial locations, 
where dry and high radiation conditions dominate, low degree day factors 
are common. This happens because there is less available energy for melt, 
with considerable amounts of energy being consumed through 
sublimation.  Degree day factors can vary significantly at the local scale, 


============================================================
PAGE 286
============================================================

 286 
 
Glaciers 
October 2023 
 
 
WEAP Tutorial 
including on the same glacier.  For your own analyses, the radiation 
coefficient will be a calibration parameter you can use to help fit 
historical observations to your model. 


============================================================
PAGE 287
============================================================

 
 
WEAP 
Water Evaluation And Planning System 
 
Financial Analysis 
 
A TUTORIAL ON 
Setting up the Cost and Benefit Model .................... 288 
Modeling Cost ....................................................... 290 
Modeling Benefits ................................................... 297 
 
October 2023 
 
 
 
 
 
 


============================================================
PAGE 288
============================================================

 288 
 
Financial Analysis 
October 2023 
 
 
WEAP Tutorial 
Note: 
For this module you will need to have completed the previous modules (“WEAP in 
One Hour, Basic Tools, and Scenarios) or have a fair knowledge of WEAP (data 
structure, Key Assumptions, Expression Builder, creating scenarios). To begin this 
module, go to the Main Menu, select “Revert to Version” and choose the version 
named “Starting Point for all modules after ‘Scenarios’ module.”  
Setting up the Cost and Benefit Model 
1.   Understanding Cost and Benefit Modeling in WEAP 
WEAP models three types of costs: Capital Costs, Fixed Operation & 
Maintenance (O&M) Costs, and Variable O&M Costs. It also models three 
types of benefits: fixed benefits, variable benefits and electricity revenues. 
Costs and Benefits can be assigned to any object (e.g., a demand site, river 
reach, groundwater node, reservoir or hydropower plant). 
For more information on Cost and Benefits, refer to the “Entering Item Cost and 
Benefits” topic in Help.  
2.   Setting the Discount Rate 
In the “General”, “Units” menu, select the “Monetary” tab and enter the 
Discount Rate.  
Discount Rate 
7% 
 


============================================================
PAGE 289
============================================================

Setting up the Cost and Benefit Model 
 289 
Stockholm Environment Institute 
 
October 2023 
 
The Discount Rate is used to compute net present value and accrue monetary quantities 
over time. It is different from the interest rate, which must be entered manually for each loan 
payment computation.  
One needs to decide upfront whether the analysis will be done in real or in nominal dollars 
(with or without considering inflation) since this will have an effect on the discount rate, 
interest rates and cost & benefit growth.  
Determining the Discount Rate is an important matter in economic analyses. Guidelines 
exist that are based on different methods such as the Weighted Average Cost of Capital 
(WACC) or Capital Asset Pricing Model (CAP-M). The US government currently 
recommends a discount rate of 7% for public sector projects (including inflation).  
3.   Changing the Modeling Duration 
Cost modeling makes sense mainly if a long time period is being considered. 
Extend the time period being simulated in WEAP by opening the “General”, 
“Years and Time Steps” dialog box.  Change the “Last Year of Scenarios” 
variable: 
Last Year of Scenarios 
2025 
 
 
Changing the “Last Year of Scenarios” will not affect the “Current Accounts”, the base year 
for all scenarios. It will only affect all the scenarios, including the “Reference” scenario. For 
more details about WEAP and scenarios, refer to the “Scenarios” module of the tutorial. 


============================================================
PAGE 290
============================================================

 290 
 
Financial Analysis 
October 2023 
 
 
WEAP Tutorial 
Modeling Cost 
4.   Enter Demand Site Cost Data 
For the Big City demand site, enter the following data (in Current Accounts) 
in the “Demand Sites” branch of the data tree in the Data view. Click on the 
“Cost” button and enter under the “Capital Costs” tab:  
Capital Costs 
a loan of 120M$, occurring in 2000, payback period 15 
years, interest rate 5% 
Use the Expression Builder to select the built-in function “LoanPayment”; pull this 
function into the expression window and type in the parameters 120000000, 2000, 
15, 5% within the parentheses. The expression should look like: 
“LoanPayment(120000000,2000,15, 5%)” 
  


============================================================
PAGE 291
============================================================

Modeling Cost 
 291 
Stockholm Environment Institute 
 
October 2023 
  
Variable Operating Costs  
0.12$/m3 
 
Fixed Operating Costs 
 
a yearly value of 5M$, growing at a 3% rate 
 
 
 
 
 
starting in 1995 
Use the Expression Builder again, selecting the built-in function “GrowthFrom” 
and entering the corresponding parameters in the parentheses. The formula should 
read: “GrowthFrom(3%,1995,5000000)” 


============================================================
PAGE 292
============================================================

 292 
 
Financial Analysis 
October 2023 
 
 
WEAP Tutorial 
 
5.   Enter System-Wide Cost Data 
We’ll assume that there was a loan made in years earlier than the Current 
Account (base) year which is still being paid back. We’ll assign this cost to the 
entire system, rather than to a specific object. Enter the following data in the 
“Supply and Resources” branch of the data tree in the Data view.  
Capital Costs  
 
a loan of 300M$, occurring in 1989, payback period 
 
 
 
 
20 years, interest rate 6% 
Again, use the Expression Builder and the “LoanPayment” function. The formula 
should read “LoanPayment(300000000,1989,20,6%)” 


============================================================
PAGE 293
============================================================

Modeling Cost 
 293 
Stockholm Environment Institute 
 
October 2023 
 
6.   Evaluate Results 
Run the model and look at the following results:  
Financial/Net Cost: 
What is the difference between real and discounted dollar values for the Big City?  
Select “Financial\Net Cost” from the primary variable pull-down menu and choose Big 
City from the list of items in the menu to the upper left of the chart. Select “Capital 
Cost” from the upper right menu. Make sure the “Reference” scenario is selected from 
the menu above the chart legend. Toggle between the “Real” and “Discounted” options 
using the menu just to the left of the unit menu (set at U.S. dollars).  


============================================================
PAGE 294
============================================================

 294 
 
Financial Analysis 
October 2023 
 
 
WEAP Tutorial 
 
 


============================================================
PAGE 295
============================================================

Modeling Cost 
 295 
Stockholm Environment Institute 
 
October 2023 
 
 
 
While real dollar are actual dollar values, discounted dollar values have been brought back to 
their present value using the discount rate. The further in the future the cost occurs, the 
lower its present value.  
Average Cost of Water 
What makes the cost vary on a monthly basis? On an annual basis? 


============================================================
PAGE 296
============================================================

 296 
 
Financial Analysis 
October 2023 
 
 
WEAP Tutorial 
Select “Financial\Average Cost of Water” from the primary variable pull-down menu. 
Keep the “Reference” scenario selected and click on “Monthly Average.” You should 
have a chart like the one below: 
 
 
 
Monthly variations in average cost of water occur because of the largely varying 
consumption of water (especially in the Agriculture area), while fixed costs remain constant. 
Annual variations are mainly driven by changes in the capital costs (loans are paid back, 
new loans occur).  


============================================================
PAGE 297
============================================================

Modeling Benefits 
 297 
Stockholm Environment Institute 
 
October 2023 
Modeling Benefits 
7.   Enter Demand Site Benefit 
In the “Cost” screen of the Big City Demand Site (Data View), enter the 
following data, which could, for example, correspond to the price water is 
sold for.  
Variable Benefit 
 
0.26$/m3 
 
 
When modeling hydropower reservoirs (refer to the “Reservoir and Hydropower” WEAP 
tutorial module), one can also enter revenues from electricity generation. The related data-
entry tab exists only when pertinent.  
8.   Compare Net Present Cost and Benefit 
Display the Net Present Value of the project.  
How do the Net Present Value of the Costs compare to the Net Present Value of 
the Benefits? 
In Results View, select “Financial\Net Present Value” from the primary variable 
pull-down menu, and choose Big City as the item for viewing. You should have a chart 
like the one below: 
 


============================================================
PAGE 298
============================================================

 298 
 
Financial Analysis 
October 2023 
 
 
WEAP Tutorial 
 
What does that comparison tell you? 
 
The Net Present Value of the costs can be compared to that of the benefit to obtain a sense 
of the economic viability of the system. If the NPV of the costs exceeds the NPV of the 
benefits, then the system is returning a lower profit than average projects (as defined by the 
discount rate). If the NPV of the benefits exceed that of the costs, then the systems is 
generating a profit higher than average projects.  
 


============================================================
PAGE 299
============================================================

 
 
WEAP 
Water Evaluation And Planning System 
 
Linking WEAP to 
MODFLOW 
 
A TUTORIAL ON 
Linking to MODFLOW ..................................... 300 
Running MODFLOW and Viewing Results ........ 330 
Scenario: Increased Population ................................ 333 
Scenario: Irrigation................................................. 336 
Scenario: Artificial Recharge .................................. 342 
 
October 2023 
 
 


============================================================
PAGE 300
============================================================

 300 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
Note: 
For this module you will need to have completed the previous modules (“WEAP in 
One Hour, Basic Tools, and Scenarios) or have a fair knowledge of WEAP (data 
structure, Key Assumptions, Expression Builder, creating scenarios) and of 
MODFLOW. To begin this module, go to the Main Menu, select “Revert to 
Version” and choose the version named “Starting Point for 'Linking WEAP to 
MODFLOW module'.”  
Linking to MODFLOW  
1.   Using MODFLOW for Groundwater Modeling in WEAP 
For situations where the built-in WEAP groundwater model is not 
sufficiently complex, there is the option to link a WEAP model to a 
MODFLOW model. MODFLOW is a three-dimensional finite-difference 
groundwater model created by the U.S. Geological Survey (USGS). When 
properly linked, data and results flow back and forth between WEAP and 
MODFLOW for each calculation timestep. With this tight coupling between 
the models, it is possible to study how changes in local groundwater levels 
affect the overall system (e.g., groundwater-stream interactions, pumping 
problems due to drawdown, lateral groundwater recharge) and vice versa (e.g., 
infiltration and abstraction). However, be advised that building and 
calibrating a MODFLOW model is not a simple task.  
The groundwater models in MODFLOW and WEAP are very different. 
Whereas a WEAP groundwater node is represented as one large “bucket” 
with no parameters to describe internal flows, MODFLOW represents 
groundwater as a multilayered grid of independent cells, each with their own 
flow parameters and equations that are used to model flows between cells, 
and across the aquifer boundaries. 
When WEAP and MODFLOW are dynamically coupled, WEAP will pause 
during calculations after each time step to load information (groundwater 
pumping and recharge, river stage, and surface water runoff, disaggregated to 
cells) into newly created, temporary MODFLOW input files, run 
MODFLOW for one stress period/timestep, and then retrieve results (cell 
heads, storage volume, spring discharges, lateral flow between aquifers, and 
surface water-groundwater flows (RIV and DRN packages), aggregating cells 
to river reaches and groundwater nodes) from the MODFLOW output files. 


============================================================
PAGE 301
============================================================

Linking to MODFLOW 
 301 
Stockholm Environment Institute 
 
October 2023 
The following chart illustrates the flow of information between WEAP and 
MODFLOW once the coupling has been done. 
 
Coupling WEAP and MODFLOW models requires a linkage shapefile (.shp) 
which can be created using WEAP's built-in tool or a Geographic 
Information System (GIS). The linkage shapefile is comprised of rectangles; 
each rectangle represents a cell in the MODFLOW model. Each rectangle 
has a position defined by row and column number and is labeled with the 
name of the coinciding WEAP element(s). For example, for a MODFLOW 
model with 20 rows, 20 columns and 3 layers, there would be 400 features in 
the shapefile. The attribute table of the linkage shapefile (.dbf) contain fields 
for MODFLOW cell row number, MODFLOW cell column number, and 
WEAP groundwater node name. Depending on your model, you might also 
match some or all of the following: Catchment Name, Land Use Name, 
Demand Site Name and River Reach Name.  
The following diagram 2  shows how the linkage shapefile couples 
MODFLOW and WEAP models. 
 
2  Maloszewski, P., Witczak, S., & Malina, G. (Eds.). (2012). Groundwater Quality Sustainability. 
https://doi.org/10.1201/b12715 


============================================================
PAGE 302
============================================================

 302 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
 
There are eight general steps that should be followed to couple the models as 
shown in the figure:  


============================================================
PAGE 303
============================================================

Linking to MODFLOW 
 303 
Stockholm Environment Institute 
 
October 2023 
 
These steps will be followed and explained through the tutorial.  
2.   Example WEAP Model 
 
This module is not an introduction to MODFLOW, which requires specialized knowledge. 
Considerable work is required outside of WEAP to calibrate and prepare a MODFLOW 
model. Refer to the MODFLOW website for more information: 
https://water.usgs.gov/ogw/modflow/. Be aware that MODFLOW 2000 has been 
superseded by a newer version, information is available at 
http://water.usgs.gov/nrp/gwsoftware/modflow2000/modflow2000.html. 
If you are already using MODFLOW, you should be able to link your MODFLOW model to 
WEAP after this module. 
The sample area used for this module differs from those in previous modules. 
It includes: 
• A city whose supply comes entirely from groundwater and discharges 
75% of its wastewater into the river. The other 25% infiltrates into the 
soil and recharges groundwater. 
• A catchment—modeled using Rainfall Runoff (simplified coefficient 
method)—that includes forest, grassland, agriculture and the city. 


============================================================
PAGE 304
============================================================

 304 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
• Rainfed agriculture. 
• A spring-fed river that receives 50% of the surface runoff from the 
catchment.  
• A groundwater node recharged by the other 50% of the surface runoff 
from the catchment. 
 
Note that because WEAP does not spatially disaggregate catchments or 
groundwater nodes; the one catchment node in this example represents the 
entire area inside the red outline without any information about where in the 
catchment the various land classes are. The one groundwater node represents 
the entire aquifer, which extends over the same area as the catchment, and 
does not include information about where the wellfield for the city is (the red 
squares labeled Big City Wellfield). 
Note:  
To properly link a MODFLOW model to a WEAP model, localization of wells and 
land cover classification are needed. Before starting the coupling of the models, 
cartographic information needs to be processed and analyzed using GIS.  


============================================================
PAGE 305
============================================================

Linking to MODFLOW 
 305 
Stockholm Environment Institute 
 
October 2023 
3.   Loading the MODFLOW Model 
Note: 
The first step to start linking the models is to prepare the native files of the 
MODFLOW model. MODFLOW native files can be opened and modified using a 
text editor. The versions of MODFLOW that WEAP is designed to link to are 
MODFLOW 2000, 2005, and NWT. A MODFLOW model consists of many 
different “packages,” most of which are optional. However, not all packages are 
used or allowed by WEAP. For details on how each package is linked to WEAP, see 
MODFLOW Link Technical Details. 
In addition, you need to consider that models with more than one stress period are 
allowed, but only data from the first stress period will be used by WEAP. When 
WEAP writes the new DIS package, the length of the stress period will be changed 
to match the length of the WEAP timestep. In MODFLOW, the stress period is 
divided into the number of specified time steps. There is a tradeoff in the choice of 
number of MODFLOW timesteps. If there are too few the solver may not 
converge on the correct solution. On the other hand, more timesteps add more 
computation and slow the model down. If the original MODFLOW stress period 
length is much longer than the WEAP timestep (e.g., annual vs. monthly), you 
probably want to reduce the number of MODFLOW timesteps per stress period— 
it will calculate faster and create smaller files. In general, a daily timestep could be 
used in MODFLOW. However, if there is rapid change in head it might be wise to 
use a shorter timestep. 
Once you have the MODFLOW native files, the MODFLOW name file (*.NAM 
or *.MFN) and all other allowed package files must be copied into the WEAP area 
subfolder of your project. It is recommended not to include any MODFLOW result 
files due to their size. 


============================================================
PAGE 306
============================================================

 306 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
For this example, the MODFLOW native files were already prepared. The 
files are contained in a subdirectory named MODFLOW within the Tutorial 
area subdirectory.  
 
We’ll now load a MODFLOW model. 
Go to “Advanced\MODFLOW Link (Groundwater Flow)” on the Main menu.  
Then, in the “Link to MODFLOW Groundwater Model” window, check the “Link 
to MODFLOW” checkbox and choose MODFLOW 2000.  
Next, browse for the “MODFLOW Name File”. Typically, the “Name” file has an 
extension of .nam or .mfn. For this example, it is tutorial.mfn.  
Review the displayed information of the MODFLOW model. 


============================================================
PAGE 307
============================================================

Linking to MODFLOW 
 307 
Stockholm Environment Institute 
 
October 2023 
 
After you have specified the MODFLOW version and the name file, WEAP 
will read in the MODFLOW model and display information about which 
packages are used under the “View/Edit Packages” button. This button can 
be used to open and edit the MODFLOW native files.  
The name file lists the packages that contain data for the various aspects of 
the MODFLOW model, such as recharge, pumping and river interactions. 
Take a look at some of the packages for this model— 
Click on the “View/Edit Packages” button and choose “MODFLOW Name File: 
tutorial.mfn”. You will see the list of files/packages. Click the cancel button to close the 
name file and look at another package, such as the “MODFLOW Discretization file: 
tutorial.dis.” The discretization file contains basic information about the model, such as 
the number of layers, rows, and columns; and the width of each row and column.  
As you can see in the screenshot above, WEAP has read in this information 
already: 20 rows, 20 columns, 1 layer, and 1000 meters width for both rows 
and columns. 
General information of the MODFLOW model is shown under the 
MODFLOW heading such as how many rows, columns, layers, active cells, 
and inactive cells the model has, row and column width, the number of stress 


============================================================
PAGE 308
============================================================

 308 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
periods, and the value for inactive and dry cells. The same window will show 
the linked elements once the models are coupled under the WEAP heading. 
Note that initially WEAP does not know how to link the MODFLOW model 
to the WEAP model, as can be seen in the screen above, e.g., “WARNING: 
Active cells linked to WEAP groundwater node: None are linked” and “1 
groundwater nodes (0 are linked to MODFLOW cells).”  
WEAP’s built-in tool is available on the “Link to MODFLOW Groundwater 
Model” 
window 
when 
using 
the 
“Advanced\MODFLOW 
Link 
(Groundwater Flow)” option on the Main menu.  
Click on the “Choose shape file that has MODFLOW linkage information” button.  
 
In the next window, for “Background Shape File with MODFLOW Linkage 
Information” choose “< Create New Shape File >”.  
 
In the next window, the File Name box contains the filename for the new 
shape file. Either use the default filename (“MODFLOW Linkage.shp”) or 
enter another name. Shape files always have a .shp extension. 
For now, enter “MODFLOW Created Linkage.shp” as the name. 
WEAP automatically fills in the number of rows and columns, and the row 
height and column width, read from the MODFLOW discretization file. 
However, it is mandatory to enter the origin coordinates of the shape file (X, 
Y – longitude, latitude), and the rotation angle of the cells to create the linkage 
shapefile properly. WEAP suggests a pair of origin coordinates based on the 
extension of your area, these coordinates need to be checked and modified if 
needed. 


============================================================
PAGE 309
============================================================

Linking to MODFLOW 
 309 
Stockholm Environment Institute 
 
October 2023 
 
If you know the values for latitude, longitude, and rotation, you can enter the 
numbers directly. If you do not know the values, you can click on the map to 
set the origin (lower left corner). You will see a purple box on the map that 
indicates the area of all the cells. As long as you hold down the left mouse 
key, the purple box will move with the mouse in the lower left corner; release 
when the box is correctly positioned. You can zoom in on the map (using the 
zoom slider below the inset map on the left, the mouse wheel, or control-
click and drag on the map) to help achieve greater precision in placement of 
the area. 
Enter 285,000 for X origin, 1,165,000 for Y origin, and 0 for rotation. Click the 
Create button to create it. 
After the shapefile has been created, WEAP will display it and allow you to 
customize its appearance on the schematic. If you don’t see anything, try 
changing the Outline Width or Outline Color under Appearance. As you can 
see from the screen below, the new shape file is a 20x20 grid of 400 cells.  


============================================================
PAGE 310
============================================================

 310 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
 
After customizing the appearance, click the OK button.  
WEAP will add this layer to your Schematic and return you to the “Choose 
shape file that has MODFLOW linkage information” window. 
Apart from WEAP creating the polygon features of the linkage shapefile, it 
also adds the necessary fields in the attribute table—Row, Column, row and 
column joined (Row_Column), active cell indication (Is_Active), Area, 
Perimeter and fields for linking WEAP elements (groundwater nodes, 
catchments and their land cover classes, demand sites, and rivers) to each cell: 
GW, Catchment, Land_Use, DemandSite, and RiverReach.  
Note: 
Fields in the attribute table represent catchments, land cover, groundwater nodes, 
rivers, and demand sites to be linked. Fields can be customized. Remember to 
choose GIS-compatible field names, e.g. up to 10 characters long. 
When customizing the shapefile appearance (double-click on the map layer), if you 
uncheck “Visible on Inset Map” the linkage shapefile on the Schematic will draw 
faster and it will not obscure everything else on the inset map. 
By default, the linkage filename created by WEAP is “MODFLOW Linkage.shp” 
and it will be in your area subdirectory. If you create the linkage shapefile using GIS 
software, copy it into the WEAP area subdirectory. 
The linkage shapefile will also be used to display MODFLOW results in WEAP. 


============================================================
PAGE 311
============================================================

Linking to MODFLOW 
 311 
Stockholm Environment Institute 
 
October 2023 
4.   Linking WEAP elements to MODFLOW Cells Using the Linkage File 
Note: 
This step will guide you through editing the attribute table of the linkage shapefile. 
A pre-filled shapefile is included in the Tutorial files. If you prefer to use the 
existing shapefile rather than spending time to fill in all the information in the 
attribute table, go to step 5. 
In general, drinking water (cities), mining and industry water demands are 
represented by “demand site” elements. Irrigation water demand can be 
represented by using a “demand site” or a “catchment”. When catchments 
are used, infiltration into the aquifer due to irrigation can be represented with 
a Runoff/infiltration link. The water supply comes from surface water and/or 
wells in an aquifer represented in WEAP as a “groundwater” element. Rivers 
can be fed by springs and surface runoff from the catchments. At the same 
time, they can be hydraulically connected to groundwater. In addition, 
catchments may be characterized in WEAP by land cover classification (e.g. 
forest, grassland, crops). Return flows from demand sites and infiltration 
from catchments can be added in the recharge package. This is added evenly 
only to cells linked to demand sites or catchments—the same cells linked to 
perform groundwater extraction. By default, cells linked to demand sites and 
catchments are used for both extraction and recharge of groundwater. 
Linking WEAP elements to MODFLOW cells is done by filling in the proper 
field of the attribute table (catchment, land cover, groundwater, river, and 
demand site) of each polygon feature with the exact name of the WEAP 
element to be linked to a particular MODFLOW cell. MODFLOW cells are 
identified in the linkage shapefile using row and column number.  
You may edit this table in several different ways. To edit inside WEAP, right-
click on the MODFLOW Linkage map layer, click “Edit” above the attribute 
table, and type the values directly into the table. You can also prepare the 
table in Excel and use it in a GIS (make sure WEAP is not open when you 
edit the attribute table file, or the file will be locked) or directly in any GIS, 
such as QGIS.  
Cells representing wells, rivers, drains, and aquifers in the MODFLOW files 
can be made into shapefiles. UrbanWellfield.shp, RIVER.shp, SPRING.shp, 
and Land_Classes.shp store locations of wells, MODFLOW river cells 
(RIVER package), drain cells (DRAIN package), and land cover classes of the 
catchment, respectively. The shapefiles are in the model’s WEAP area folder.  


============================================================
PAGE 312
============================================================

 312 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
For example, if a groundwater node in WEAP needs to be linked, you first 
identify the spatial extent of the aquifer in the MODFLOW model. Then, 
select the polygon features in the linkage file that overlap the aquifer and enter 
the exact name of the groundwater node in the appropriate attribute table 
field. Repeat these steps to link catchments, land cover classes, rivers. 
Note: 
- Demand site linkages must be specified for cells representing the aquifer or 
specific cells representing well locations. (Extraction and infiltration will be applied 
evenly to all cells). 
- Demand site sub-branches can be linked to MODFLOW cells by appending the 
name of the branch to the name of the demand site in the attribute field for 
linking demand sites using the following syntax: [Demand site name]\[Sub-
branch name]. If you link one sub-branch, you must link them all for that 
demand site. Also, you must link at the lowest level of disaggregation, not an 
intermediate level. Do not add any space character before or after the backslash. 
- Catchment and land cover, groundwater, and river elements can be linked to one 
and only one active MODFLOW cell. For a given row and column, every layer 
will be linked to the same cell. An active MODFLOW cell can be linked to more 
than one demand site element; to do so you will need to add as many fields as 
demand site elements to link. This will need to be done when a well is used by 
more than one user. It is recommended to use a number after the field name 
(e.g. DemandS1, DemandS2). 
- When the River (RIV) MODFLOW package is used, a subset of WEAP's river 
reaches must be linked. Append the name of the river reach to the name of the 
river in the attribute field for linking rivers using the following syntax: [River 
name],[Reach name]. Do not add any space character before or after the comma.  
- Before linking MODFLOW drain cells you must identify them using the Drain 
(DRN) MODFLOW package and add a river to represent each drain. Then, 
MODFLOW drain cells can be linked in the linkage shapefile following the 
same procedure as described for rivers.  
In this WEAP model, there is only one groundwater node to be linked.  
Edit the table using your preferred GIS assigning the name “Groundwater” for each 
cell that corresponds to an aquifer in the MODFLOW model. In this case, all the 
active cells represent one aquifer. The name must be entered in the “GW” field of the 
attribute table.  


============================================================
PAGE 313
============================================================

Linking to MODFLOW 
 313 
Stockholm Environment Institute 
 
October 2023 
Repeat this process to assign the name of the catchment in the Catchment field. In this 
case, the catchment cells are the same cells representing the aquifer.  
If you use the GW or Catchment field to customize the linkage file 
appearance in GIS, you will see the following: 
 
The “Select by location” tool in any GIS is useful for selecting specific cells 
based on their location relative to features in another layer. The file 
Land_Classes.shp stores the land cover distribution within the catchment.   
Use the Land_Classes.shp shapefile to link land cover classes. Fill in the Land_Use 
field specifying the land class cover name (Farm, City, Forest, Grass) as appropriate.  
Once you have finished you should have the following: 


============================================================
PAGE 314
============================================================

 314 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
 
Note: 
Land cover names in the land cover shapefile may differ from the branch names 
used in WEAP to define land cover classes within a catchment. WEAP names must 
be used for filling in the attribute table of the linkage file.  
To link the demand site “Big City” the well cells must be identified.  
Use the UrbanWellfield.shp shapefile to assign the demand site name only to the cells 
with wells (see figure below).  


============================================================
PAGE 315
============================================================

Linking to MODFLOW 
 315 
Stockholm Environment Institute 
 
October 2023 
 
Finally, river reaches must be linked. First, MODFLOW drain cells (DRAIN 
package) must be identified and a river per drain added in WEAP. Use the 
SPRING.shp shapefile to check where the MODFLOW drain cells are. 
Consecutive drain cells are considered a drain. In this case, there is only one 
drain cell, and a river called “Springs Eternal” (see figure below).  
 
 


============================================================
PAGE 316
============================================================

 316 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
Note: 
WEAP has a useful tool when filling in the attribute table—the “guess linkages” 
buttons for groundwater, demand sites, rivers, and drains. WEAP tries to guess 
which MODFLOW cell could be linked to a WEAP element based on proximity on 
the schematic. For example, as shown in the figure below, clicking on “Guess River 
Point Linkages” asks WEAP to identify the closest polygon features in the linkage 
file that overlap WEAP river reaches and active cells in the River (RIV) package 
(blue squares). When finished, the river reach names will be written by WEAP into 
the river shapefile field (e.g. “RiverReach” field). 
 
- Before using this tool, edit the river course or the localization of the WEAP 
element of interest to match the MODFLOW cells to be linked.  
- “Guess River Point Linkages” and “Guess Drain Cell Linkages” buttons will 
work properly only if the course of the river overlaps the river and drain cells 
(RIVER and DRAIN packages). When the tool is used, each Demand Site will 
be linked to only one cell; Groundwater nodes will be linked to all active cells.  
- After using this tool, you should review which nodes and cells WEAP has 
guessed to make sure that they are correct. The easiest way to do this is to 
display the linkages on the WEAP schematic or in a GIS. If the attribute table 
has errors, using a GIS to edit the linkage file is recommended.  
- All withdrawals from and returns to a groundwater node, demand site, or 
catchment will be distributed evenly from/to all linked cells. 
- River reach names are added to the attribute table considering the WEAP 
language. If the language is changed, the linkage shapefile will not work. WEAP 
must be run using the language used to generate the linkage shapefile. 


============================================================
PAGE 317
============================================================

Linking to MODFLOW 
 317 
Stockholm Environment Institute 
 
October 2023 
Link the river reaches using the “Guess River Point Linkages” button.  
First, check that your linkage file “MODFLOW Created Linkage.shp” is in WEAP; 
if not, add it.  
The “Guess River Point Linkages” button is in the “Link to MODFLOW 
Groundwater Model” window.  
In the Advanced menu, choose “Link to MODFLOW Groundwater Model”. Then 
click on “Choose shape file that has MODFLOW linkage information”. In the next 
window, for “Background Shape File with MODFLOW Linkage Information” 
choose “MODFLOW Created Linkage.shp”. Next, Click “Guess River Point 
Linkages”. Select yes on the pop-up window to allow WEAP to overwrite any river 
reach values already in the shapefile.  
Once this is done, WEAP will indicate how many cells were linked to river 
reaches.  
Repeat the process using the “Guess Drain Cell Linkages” button. Click OK to close 
the window. Click Close on the “Link to MODFLOW Groundwater Model” window 
to return to the schematic.  
You can display the river reaches that were linked to MODFLOW Drain and 
River cells by updating the shapefile appearance (see figure below).  
Right-click MODFLOW Created Linkage shapefile to edit the Map Layer. 
 


============================================================
PAGE 318
============================================================

 318 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
Choose “Row_Column” for the Column in the Label tab, and set the Size to 40%. 
Click OK to close the window. 
 
At this point, the linkage shapefile is complete. Names of Groundwater nodes, 
catchments and land cover classification, demand sites, and river reaches have 
been added to the attribute table of the linkage shapefile. 
If you have completed this section, you can skip ahead to Section 6.   


============================================================
PAGE 319
============================================================

Linking to MODFLOW 
 319 
Stockholm Environment Institute 
 
October 2023 
Note: 
When infiltration is applied to cells without extraction, it is necessary to add a 
“dummy demand.” An example is shown in the figure below. In this example, well 
pumping occurs at a small number of cells (blue) while infiltration from water use is 
distributed over a larger number of cells (green). The demand site named “Real 
demand” represents the original demand in WEAP and should be connected in the 
linkage shapefile to the cells shown in blue (representing the location of wells). The 
demand site “Dummy demand” is the new demand that must be added in WEAP 
to represent infiltration to different cells and should be connected in the linkage 
shapefile to the cells shown in green (representing the infiltration area). 
 
“Real demand” can have more than one transmission link or return flow. In the 
case of more than one return flow, the following expression for “Maximum Flow 
Volume” must be added in the transmission link from “Real demand” to “Dummy 
demand”: “PrevTSValue(Demand Sites\[Real Demand Name]):Total Node 
Outflow[m^3])*Supply and Resources\Return Flows\from [Real Demand Name]): 
\to [Groundwater element name]:Return Flow Routing[% share]/100. The unit of 
the variable must be changed according to the time step of the model (e.g. month 
for a monthly model). The above is not necessary if “Real demand” has only one 
return flow per groundwater element. 
It is important that: a) the priority of “Dummy demand” be lower than that of 
“Real demand”, b) the water demand of “Dummy demand” be higher at all time 
steps than that of “Real demand.” (A significantly high value is recommended, such 
as 1 Billion m3.) And c) the “Dummy demand” consumption must be set to 0%.  


============================================================
PAGE 320
============================================================

 320 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
According to the scheme, although the water demand of the “Dummy demand” is 1 
Billion m3, WEAP will supply it only with the water not consumed by “Real 
demand.” In this case, assuming that the water supply of the “Real Demand” was 
100% and using the data shown in the figure, the infiltration into the aquifer would 
be: 3000 m3/month (supply)*20% (100% -consumption)*60% (return flow routing 
from the “Real demand” to “GW”) =360 m3/month. This result would be the same 
without the implementation of the “Dummy demand,” but because infiltration is 
modelled into different cells compared to the extraction (pumping) cells, it is 
necessary to use this scheme. 
5.   Use an Existing Shapefile 
Rather than spending the time now to fill in all the information in the attribute 
table (as described in the previous section), we can use an existing shape file 
with all this information already filled in.  
On the “Choose shape file that has MODFLOW linkage information” window, select 
“< Add existing shape file as new map layer >” for the “Background Shape File with 
MODFLOW Linkage Information.” In the dialog box that appears, select 
“linkage.shp” (in the Tutorial directory) as the linkage shapefile to use. Click Open. 
 
On the “Map Layer” screen, change the name to “MODFLOW Linkage.” On the 
“Label” tab, choose “R_C” for the Column, and set the Size to 40%. Click OK to 
close the window.  


============================================================
PAGE 321
============================================================

Linking to MODFLOW 
 321 
Stockholm Environment Institute 
 
October 2023 
 
Now you need to specify which of the fields in the Linkage attribute table will 
be used for the linkage, and to which MODFLOW and WEAP items they 
correspond. Based on the attribute table of the linkage shapefile, WEAP 
automatically guesses which fields are used for what. For example, WEAP 
has assigned the fields “Row” and “Col” as the MODFLOW row and column 
values. In fact, in this example, WEAP was able to correctly guess all the fields: 
 
If it did not guess correctly, you would select the appropriate field for each 
item (e.g., River Reach Name Field is RIVERREACH).  
Click OK to close this window. 


============================================================
PAGE 322
============================================================

 322 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
6.   Verify MODFLOW Model has linked to WEAP Model 
Note: 
- Make sure to check the box at the bottom of the “Link to MODFLOW 
Groundater Model” window (“Save every MODFLOW input and output file 
created”) so that results will be available to view in WEAP and you will be able 
to run them in MODFLOW to examine the results in more detail, or to make 
slight changes to the inputs.  
- WEAP creates a set of new temporary input files for each timestep and scenario. 
All temporary filenames start with “!MF!” to distinguish them from other files. 
- Any changes you make directly to the temporary input files will be lost the next 
time WEAP does its calculations, so save them in another directory if you want 
to preserve them.  
- If the MODFLOW model includes confined layers, you can group one or more 
layers into distinct aquifers for reporting purposes. Click the “Define Aquifers” 
button to specify how many aquifers exist and which layers correspond to which 
aquifers. This option is not available if the model has only one layer. 
In the “Link to MODFLOW Groundwater Model” window under the 
WEAP heading, verify how many WEAP elements were linked to 
MODFLOW cells (the text in parentheses shows this information in the 
figure below). Not all elements need to be linked; it depends on your model 
schematic. Note that WEAP reports the linkage shapefile and how many of 
the WEAP and MODFLOW items have been linked, e.g., “1 groundwater 
nodes (1 are linked to MODFLOW cells)”.  
All active cells must be linked to WEAP elements. This can be verified under 
the MODFLOW heading as “Active cells linked to WEAP groundwater node: 
All are linked.”  
Click Close to return to the Schematic. 


============================================================
PAGE 323
============================================================

Linking to MODFLOW 
 323 
Stockholm Environment Institute 
 
October 2023 
 
Depending on which steps you completed above (Section 4 or Section 5), two 
layers “MODFLOW Linkage” and “MODFLOW Created Linkage” might 
now be in the list of background layers in the schematic view, ordered at the 
top. Note that WEAP can only link to one MODFLOW layer at a time; even 
though both are shown, WEAP will only extract data from the layer specified 
in the “Choose Shape File that has MODFLOW Linkage Information” 
window (In Advanced/MODFLOW Link (Groundwater Flow)/Choose 
Shape file that has MODFLOW linkage button). If you want to change the 
order of the layers in the element window, right-click on the layer name and 
choose “Move Down.” 


============================================================
PAGE 324
============================================================

 324 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
 
Take a moment now to view the other information contained in the linkage 
file.  
Right-click on “MODFLOW linkage” layer, choose “Set label to” and pick one of 
the other fields, such as “Land_Class.”  
This will show you which of the four land classes (Grass, City, Forest, Farm) 
each cell is assigned to. Since the catchment is connected to the groundwater 
node and modelled by using Rainfall Runoff (simplified coefficient method), 
the cells linked to the catchment will be recharged by surface runoff from the 
catchment. Label by “DemandSite” to see from which cells the Big City 
demand site will pump. These same cells will be recharged by the water 
discharge of Big City. Label by “GW_Node” to see which MODFLOW cells 
are linked to the WEAP groundwater node. Finally, choose the field 
“RiverReach” to see which cells are linked to the WEAP river reaches of 
“Blue River”. 
Finally, you should review data previously entered as WEAP variables related 
to groundwater or influenced by surface water–groundwater interaction. The 
table below shows the list of variables and some considerations: 


============================================================
PAGE 325
============================================================

Linking to MODFLOW 
 325 
Stockholm Environment Institute 
 
October 2023 
Element 
Variable 
Unit 
Comments 
Catchments- 
Rainfall Runoff 
(soil moisture 
method) 
Preferred Flow 
Direction 
  
In Rainfall Runoff (soil moisture method) mode 
if the catchment has a runoff infiltration link 
connected to a groundwater node, this controls 
flow from the first bucket to the second bucket 
(0 = 100% horizontal, 1 = 100% vertical). 
Demand Sites and 
Catchments 
Consumption 
% 
Defines the percentage of gross demand that 
will flow through the return flow link (from the 
demand site to a river or groundwater node), or 
through the transmission link (when the demand 
site is connected to another demand site or to a 
wastewater treatment plant). 
Demand Sites and 
Catchments 
including irrigation 
areas 
Demand Priority 
  
Controls the order in which WEAP extracts 
water from available water sources (rivers, 
groundwater) to meet demands. 
Groundwater 
Initial Storage 
Million 
m^3 
Used to track absolute volume of groundwater 
storage in WEAP but has no effect on 
MODFLOW results. 
Groundwater 
Maximum 
Withdrawal 
Million 
m^3 
Used to set restrictions according to operating 
rules. 
Groundwater 
Natural Recharge 
Million 
m^3 
Existing data must be deleted. Leave empty. 
Groundwater 
Storage Capacity 
Million 
m^3 
Existing data must be deleted. Leave empty. 
Reservoirs 
Loss to 
Groundwater 
Million 
m^3 
Existing data must be deleted. Leave empty. 
 
An alternative solution is to include a dummy 
demand extracting water from the reservoir and 
discharging it to the groundwater node. 
 
Return Flows 
Gain from 
Groundwater 
Million 
m^3 
Existing data must be deleted. Leave empty. 
 
An alternative solution is to include a dummy 
demand extracting water from the groundwater 
node and discharging it to the same discharge 
point of the demand site where this return flow 
is connected. 
Return Flows 
Loss to 
Groundwater 
% 
Existing data must be deleted. Leave empty. 
 
An alternative solution is to include a dummy 
demand extracting water from the demand site 
and discharging it to the groundwater node. 
Return Flows 
Return Flow 
Routing 
% 
share 
Defines the percentage of flow that discharges 
to different elements (rivers, groundwater nodes, 
wastewater treatment plants). 


============================================================
PAGE 326
============================================================

 326 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
Element 
Variable 
Unit 
Comments 
River 
Groundwater 
Inflow 
Million 
m^3 
Deactivated when MODFLOW coupling is 
being used.  
 
When MODFLOW is not using the River (RIV) 
or Drain (DRN) package, it does not model 
surface water–groundwater interaction. An 
alternative solution is to include a dummy 
demand extracting water from the groundwater 
node and discharging it to the river.  
River 
Groundwater 
Outflow 
% 
Deactivated when MODFLOW coupling is 
being used.  
 
When MODFLOW is not using the River (RIV) 
or Drain (DRN) package, it does not model 
surface water–groundwater interaction. An 
alternative solution is to include a dummy 
demand extracting water from the river and 
discharging it to the groundwater node. 
Runoff and 
Infiltration 
Groundwater to 
Groundwater Flow 
Million 
m^3 
Existing data must be deleted. Leave empty. 
 
This is modeled by MODFLOW. 
Transmission Links Loss to 
Groundwater 
% 
Existing data must be deleted. Leave empty. 
 
An alternative solution is to include a dummy 
demand extracting water from the demand site 
and discharging it to the groundwater node. 
Transmission Links Supply Preference 
  
Defines the preference when a demand site or a 
catchment with irrigation has multiple sources.  
Check that the information entered for Initial Storage, Natural Recharge, and 
Storage Capacity of the groundwater node are empty. 
7.   Set the Flow-Stage-Width 
Surface water–groundwater interaction requires the stage-discharge rating 
curve, which represents the relationship between the water level and the 
streamflow at a given point in a river. It is specified as Flow-Stage-Width 
under the Physical tab. This tab is visible only when a river reach is selected 
in the data tree.  
Go to Data View and then to Supply and Resources/River/Blue 
River/Reaches/Below Blue River Headflow and review the Flow-Stage-
Width data. Note that you’ll need to enter your own values when building 
new models. 


============================================================
PAGE 327
============================================================

Linking to MODFLOW 
 327 
Stockholm Environment Institute 
 
October 2023 
 
Note:  
The expressions should be filled in for as many river reaches as possible. However, 
if information is limited, WEAP can calculate the surface water–groundwater 
interaction by entering the expression only in the first river reach.  
8.   Set Pump Layer  
One final step to link the WEAP and MODFLOW models is to specify from 
which MODFLOW layer the Big City demand site will pump. In general, a 
demand site or catchment node can pump from a single layer, pump from 
many layers (in equal or different proportions), or have pumping be handled 
as negative recharge in the MODFLOW recharge file. Our MODFLOW 
Linkage has only one data layer (which you can verify in the first line of text 
under MODFLOW in the Advanced/ MODFLOW Link (Groundwater 
Flow) window and where the number of rows, columns and layers are 
reported). Because there is only one layer, the pumping choices are from layer 
1, or as negative recharge (enter pump layer = 0 for negative recharge). We 
want to pump from layer 1.  
Go to the Data View, select “Big City” on the data tree, then click on the “Pumping” 
category at the top and enter “1” for the Pump Layer. 


============================================================
PAGE 328
============================================================

 328 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
 
You have now linked the WEAP model to the MODFLOW model. 


============================================================
PAGE 329
============================================================

Linking to MODFLOW 
 329 
Stockholm Environment Institute 
 
October 2023 
Note:  
Pumping to satisfy demand sites or catchment land classes (irrigation) can either be 
handled as pumping in the well file, or as negative recharge in the recharge file. 
When using injection wells for artificial recharge of demand site return flow, specify 
MODFLOW layer(s) in which to inject water. The pump layer and injection layer 
are specified in the Data View under the pumping tab for demand sites and under 
the Irrigation tab for catchments. 
- Pump Layer and Injection Layer are only used when linking MODFLOW to 
WEAP.  
- When layer>0 is specified, WEAP will add cells to the well file if they are not 
already there. Specify layer=255 for a cell to have pumping or injection equally 
from all layers in that cell. The well package will be modified.  
- Leave blank or specify layer=0 for handling withdrawals as negative recharge 
(pumping) or return flows as positive recharge (injection). The recharge package 
will be modified.  
- Use the PumpLayer function to specify fractions pumped from (pumping) or to 
(injection) different layers.  
- Pumping and injection can vary by scenario and over time.  
- Injection Layers can only be used for Demand Site return flows, not for 
Catchment infiltration. 
- If the setting (in General, Basic Parameters) for “MODFLOW Pumping if Dry 
or Inactive Cells” is “Do not reapportion pumping from dry or inactive cells,” 
WEAP will reduce groundwater pumping by demand sites and catchments from 
these drying cells accordingly. This will result in Unmet Demands and will be 
included in the MODFLOW “Pumping Reduction” reports. 
- On the Basic Parameters screen you can choose whether all demand site and 
catchment subbranches will pump from the same MODFLOW layer or set of 
layers. For Injection Layer, WEAP will use the same setting as for MODFLOW 
Pumping for Demand Sites. 


============================================================
PAGE 330
============================================================

 330 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
Running MODFLOW and Viewing Results 
9.   View Results 
Click the Results button to calculate and view results. Notice that at each calculation 
timestep, WEAP runs MODFLOW. 
Results for MODFLOW are in the “Supply and Resources / Groundwater / 
MODFLOW” category in the pull-down menu just above the chart.  
Look at the results for Supply and Resources / Groundwater / MODFLOW / Cell 
Head.  
This report shows the vertical head for each MODFLOW cell. Cell head and 
other MODFLOW results can be overlaid on the map or displayed as a 3-
dimensional surface. Make sure that “Surface” is selected as the chart type 
(the first icon in the menu bar to the right of the legend), and that the “Y=0” 
button is not selected. The cell head for one timestep is shown (January 2000). 
Experiment with the sliders below the chart to rotate or tilt the surface. Click 
the “Rotate” button to animate the chart. Click “3-D” to switch between a 3-
D surface and 2-D plan view. You can also click on the 3-D surface and drag 
the mouse to rotate the view. 
 


============================================================
PAGE 331
============================================================

Running MODFLOW and Viewing Results 
 331 
Stockholm Environment Institute 
 
October 2023 
 
Can you see the impact of pumping from the Big City Wellfield? (This view exaggerates the 
variation in head—click the “Y=0” button to see a view without vertical exagerration. It 
is usually better to turn off Y=0 to highlight differences.) 
In addition to cell head, you can also look at the following results from 
MODFLOW: Flow Field (Darcy Velocity Vectors), Pumping Reduction 
(how much pumping has been reduced due to dry cells), Recharge, 
Pumping, Leakage to River, Drain flow, Flow Right Face (flow from the 
column to the right/higher column number), Flow Front Face (flow from the 
row below/higher row number), Flow Lower Face (flow from layer 
below/higher layer number), Constant Head Flow, Pump Head, Pump Head 
at Sub-Branches (if linked to Demand Site sub-branches), and Number of 
Dry Cells. For recharge, positive values represent inflow into the cell, whereas 
for pumping, drain flow and leakage to river, positive values represent 
outflow from the cell. 
Click on the Map tab to see the head values on the map, with a graph below.  
Activate the “Display chart below map” button on the right (x-y plot icon).  
Below the map, a chart shows how head results for a single cell vary over time, 
one line for each scenario.  


============================================================
PAGE 332
============================================================

 332 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
Click on some of the cells at the Big City Wellfield to see how they vary.  
There is a seasonal fluctuation in cell head (higher in winter, lower in summer) 
due to increased pumping and lower rainfall in the summer), and an overall 
trend downward from 2000 to 2010. You can click and drag the mouse over 
the cells and the graph will update in real-time as you move the mouse. This 
is a good way to get a quick understanding of how cells in different areas of 
the model behave differently over time. Note that the option to toggle Y=0 
is now at the bottom right menu.  
 
Look at a few other MODFLOW results, such as Recharge Volume, Pumping, Drain 
Flow, and Leakage to River.  
Note that pumping and recharge occur on the same cells linked to the “Big 
City” demand site and the irrigated land area (Farm) of the “Catchment”.  


============================================================
PAGE 333
============================================================

Scenario: Increased Population 
 333 
Stockholm Environment Institute 
 
October 2023 
 
10.   
Calibration and Validation 
Calibration and validation should be performed by comparing simulated and 
observed levels in the exploratory wells. The simulated level in a specific cell 
can be exported from WEAP by going to the Results View and choosing the 
variable Supply and Resources \ Groundwater \ MODFLOW \ Cell Head. 
Graph the time series of simulated and observed levels using a programming 
language or a spreadsheet such as Microsoft Excel.  
A separate section of the Tutorial will guide you through surface water 
calibration.  
A model can be assumed to be calibrated when the streamflow record 
obtained from gauge stations is similar to the simulated streamflow in WEAP 
and the groundwater level recorded in the exploratory wells is similar to the 
simulated levels in MODFLOW. 
Scenario: Increased Population 
Now that we have a MODFLOW model linked to our WEAP model, we can 
create some WEAP scenarios and explore how they might affect groundwater. 


============================================================
PAGE 334
============================================================

 334 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
11.   
Create Scenario 
Switch to the Data View and create a new scenario underneath “Reference.” Call it 
“Increased Population” (Main menu: Area, Manage Scenarios). 
 
Under the Water Use tab, change the expression for the Annual Activity Level for Big 
City from “Growth(1%)” to “Growth(5%)”. 
 
 


============================================================
PAGE 335
============================================================

Scenario: Increased Population 
 335 
Stockholm Environment Institute 
 
October 2023 
12.   
Evaluate Results 
To explore the results, go to Results and look for the impact of the increased 
pumping from Big City on groundwater levels (Make sure you have selected 
the following dropdown menu options in the Map view: Scenario: Increased 
Population, Layer: 1, January, 2000, Row 4, Colum 9). As you can see, the 
slow downward trend of the Reference scenario is accelerated in the 
Increased Population scenario. This is especially evident in the cells on or 
near the Big City Wellfield. 
 
The effect, although smaller, can even be seen far away from the wellfield, 
e.g., in Row 16, Column 6 (in the lower left corner of the model). 


============================================================
PAGE 336
============================================================

 336 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
 
Scenario: Irrigation 
The crops on this Farm are currently rainfed, but there is not enough rainfall 
in the summer to meet evapotranspiration demand. Look at the results for 
evapotranspiration shortfall for the Farm branch in the reference scenario.  
In the Chart view, select the following dropdown menu options: Catchments/ET 
Shortfall, Million, Cubic Meter, Scenario: Reference, All months, Branch: Demand 
Sites and Catchments/Catchment/Farm, No comparison, Monthly Average. Show 
All Branches in the legend and All Years (at the bottom of the chart). 


============================================================
PAGE 337
============================================================

Scenario: Irrigation 
 337 
Stockholm Environment Institute 
 
October 2023 
 
13.   
Create Scenario 
Investigate the impact of adding irrigation from groundwater pumping, both 
on the groundwater levels and on crop yields.  
Switch to the Schematic View and go to Area/Manage Scenarios. Create a new scenario 
underneath “Reference,” call it “Irrigation.” 
 
There are several steps to take to activate irrigation for the Farm landclass 
and for the MODFLOW cells associated with the Farm. 


============================================================
PAGE 338
============================================================

 338 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
14.   
Add Transmission Link 
Add a transmission link from the groundwater node to the catchment, and uncheck 
“Active in Base Year?”  
 
When you add this link, WEAP will automatically set the catchment as having 
irrigation. 
 
You can leave the priority as 1. 
 
15.   
Set Land Class as Irrigated 
Go to the Data View (make sure that the Irrigation scenario is selected in the “Data 
for” dropdown box at the top) and change “Irrigated” to 1 for the Farm, and “Irrigation 
Fraction” to 50 (50% irrigation efficiency).  


============================================================
PAGE 339
============================================================

Scenario: Irrigation 
 339 
Stockholm Environment Institute 
 
October 2023 
 
For the transmission link, set the Startup Year to 2003.  
 
16.   
Set MODFLOW Layer for Irrigation 
We want MODFLOW to pump the irrigation water from layer 1.  
Click on the “Catchment” branch in the data tree, then click on the “Irrigation” category 
at the top and the “Pump Layer” variable tab. Enter a value of 1. 


============================================================
PAGE 340
============================================================

 340 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
 
17.   
Evaluate Results 
Go to the Results View. Verify that irrigation begins in 2003, reducing the ET 
Shortfall to zero. (Remember to uncheck Monthly Average.) 
 
 
What happens to crop yields, now that they receive all the water they need?  
Look at the Catchment report for Annual crop Production, comparing the yield across 
scenarios by selecting the Irrigation and Reference Scenarios in the dropdown menu at the 


============================================================
PAGE 341
============================================================

Scenario: Irrigation 
 341 
Stockholm Environment Institute 
 
October 2023 
bottom and selecting All Branches in the dropdown menu to the right. Make sure you have 
selected the following dropdown menu options: Million, Kilogram, All Years, Branch: 
Demand Sites and Catchments/Catchment/Farm, No comparison. 
  
Now look at the impact of irrigation on groundwater.  
View the MODFLOW Cell Head Results for July 2010 on the Map tab. Click on 
a cell in the map in the Farm to see the largest effect, or a cell far away from the Farm 
to see a smaller effect. 
 


============================================================
PAGE 342
============================================================

 342 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
Compare the pumping rates for the Farm and for Big City.  
Select the following dropdown menu options: Meter, Scenario: Irrigation, July, 2010, 
Layer: 1. 
 
Scenario: Artificial Recharge 
For a final scenario, explore the impact of artificial recharge on groundwater.  
 
Artificial recharge, or “Aquifer Storage and Recovery” (ASR), involves injecting water into 
an aquifer through wells or by surface spreading and infiltration and then pumping it out 
when needed. The aquifer essentially functions as a water bank. Deposits are made in times 
of surplus, typically during the rainy season, and withdrawals occur when available water 
falls short of demand.  
In this example, the water will come from outside the catchment area and not 
vary seasonally. 
18.   
Create Scenario 
Switch to the Schematic View and create a new scenario underneath “Reference,” call it 
“Artificial Recharge”. 
19.   
Load Shapefile Layer 
On the Main Menu, select Schematic, Add Vector Layer.  


============================================================
PAGE 343
============================================================

Scenario: Artificial Recharge 
 343 
Stockholm Environment Institute 
 
October 2023 
 
Choose the file artificial_recharge.shp. Give it the name “Artificial Recharge” and 
change its appearance so that the Style is “Solid” and the “Fill color” is light blue.  
Note that the cells are in column 6, rows 13-15. 
 
20.   
Edit Linkage Shapefile 
So that WEAP can tell MODFLOW which cells will receive the artificial 
recharge, we need to edit the linkage shapefile.  


============================================================
PAGE 344
============================================================

 344 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
In the Schematic View, double-click on “MODFLOW Linkage”, select the Table tab 
and click the Edit button. Scroll down to find the artificial recharge cells: column 6, 
rows 13, 14 and 15. For these three cells, type into the field labeled DEMANDSITE 
the name of the artificial recharge demand site: “Artificial Recharge”. Click OK to save 
changes and return to the schematic view.  
 
  
Verify this new linkage information:  
Set the label for the MODFLOW Linkage layer to DEMANDSITE.  
You should see the artificial recharge cells labeled, and the Big City Wellfield: 


============================================================
PAGE 345
============================================================

Scenario: Artificial Recharge 
 345 
Stockholm Environment Institute 
 
October 2023 
 
21.   
Create Other Supply and Demand Site 
Create an “other supply” node called “Other Supply” in the upper left corner.  
Create a new demand site—place it on top of one of the blue artificial recharge cells. 
Call it “Artificial Recharge” and uncheck “Active in Current Accounts?” 
 
Add a transmission link from Other Supply to Artificial Recharge. Then add a Return 
Flow link from Artificial Recharge to the Groundwater node. 


============================================================
PAGE 346
============================================================

 346 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
 
22.   
Enter Supply and Demand Data 
Go to the Data View, select scenario “Artificial Recharge,” and then click on the 
branch for demand site Artificial Recharge in the tree. Set the Startup Year to 2005. 
 
For Water Use, set the Annual Activity Level to 1 (Tip: First select “No Unit” as 
the Unit), Annual Water Use Rate to 25 Million cubic meters (the annual capacity of 
the injection wells), and the Consumption to 0%. 


============================================================
PAGE 347
============================================================

Scenario: Artificial Recharge 
 347 
Stockholm Environment Institute 
 
October 2023 
 
Click on the branch for the other supply, and then enter 1 CMS for the inflow. 
 
23.   
Evaluate Results 
Run the model and look at results for recharge depth and cell head.  
Make sure you have selected the following dropdown menu options: Meter, 
Scenario: Artificial Recharge, January, 2010, Layer: 1.  


============================================================
PAGE 348
============================================================

 348 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 
Does the artificial recharge have much impact on groundwater levels at the recharge site? Is 
the impact greater closer to the Big City Wellfield or irrigation? Can you think of another 
site for the artificial recharge that would better alleviate the drawdown from pumping? 
 
 
Groundwater levels at the recharge site are much higher than Reference 
(Select the following dropdown menu options: MODFLOW Cell Head, 
Meter, Scenario: Artificial Recharge, March, 2010, Layer: 1, Row 14, Column 
6):  


============================================================
PAGE 349
============================================================

Scenario: Artificial Recharge 
 349 
Stockholm Environment Institute 
 
October 2023 
 
Groundwater levels by the Wellfield are almost the same as in Reference 
(Click on the cell at Row 4, Column 8): 
 


============================================================
PAGE 350
============================================================

 350 
 
Linking WEAP to MODFLOW 
October 2023 
 
 
WEAP Tutorial 


============================================================
PAGE 351
============================================================

Scenario: Artificial Recharge 
 351 
Stockholm Environment Institute 
 
October 2023 
 
 


============================================================
PAGE 352
============================================================



============================================================
PAGE 353
============================================================

 
 
WEAP 
Water Evaluation And Planning System 
 
Linking WEAP to 
LEAP 
 
A TUTORIAL ON 
Linking WEAP and LEAP ............................... 354 
Scenario: Hydropower Generation from 
WEAP ................................................................ 359 
Scenario: Demand for Cooling Water from 
LEAP ................................................................. 370 
Scenario: Electricity Demand from WEAP ............ 376 
 
October 2023 
 


============================================================
PAGE 354
============================================================

 354 
 
Linking WEAP to LEAP 
October 2023 
 
 
WEAP Tutorial 
Note: 
For this module you will need to have completed the previous modules (“WEAP in 
One Hour, Basic Tools, and Scenarios) or have a fair knowledge of WEAP (data 
structure, Key Assumptions, Expression Builder, creating scenarios). To begin this 
module, go to the Main Menu, select “Revert to Version” and choose the version 
named “Starting Point for 'Linking WEAP to LEAP’ module.”  
Linking WEAP and LEAP 
1.   Introduction to LEAP 
LEAP, the Low Emissions Analysis Platform, is a widely-used software tool 
for energy policy analysis and climate change mitigation assessment 
developed at the Stockholm Environment Institute. 
LEAP is an integrated modeling tool that can be used to track energy 
consumption, production and resource extraction in all sectors of an 
economy.  It can be used to account for both energy sector and non-energy 
sector greenhouse gas (GHG) emission sources and sinks.  In addition to 
tracking GHGs, LEAP can also be used to analyze emissions of local and 
regional air pollutants, making it well-suited to studies of the climate co-
benefits of local air pollution reduction. 
For more information on LEAP and to download the software, visit 
https://leap.sei.org.   
2.   Coupled Water-Energy Models in WEAP and LEAP 
We are going to examine a simple water-energy system; first the water side of 
the system using WEAP, then the energy side using LEAP. Then we will link 
the WEAP and LEAP models to examine the interaction between the two 
sides and see how this interaction influences the results we obtain. 
3.   WEAP Model 
In the WEAP “Schematic” view there is a city situated near a river with its 
own wastewater treatment plant. A reservoir harnesses hydropower from the 
river. The demand for water comes from two sources: municipal demand 
from the city, and demand for thermal cooling from a coal power plant also 


============================================================
PAGE 355
============================================================

Linking WEAP and LEAP 
 355 
Stockholm Environment Institute 
 
October 2023 
situated near the river. The municipal demand has the first demand priority 
(1) compared to the thermal cooling demand (2).  
 
Already we can see links between the water and energy systems in this model. 
The reservoir and coal power plant utilize water to generate electricity. On 
the other hand, the wastewater treatment plant uses energy in its treatment 
process. Energy is also needed for processes like pumping for transmission. 
4.   View WEAP Results 
Switch to the “Results” view. Click the pull-down menu at the top left, select 
“Supply and Resources” > “Reservoir” > “Hydropower Generation.” This 
allows us to see the variation in hydropower generated by the reservoir over 
time. Change the unit to Kilowatt-Hour. Remember that you can change the 
chart type to a line or bar graph by clicking the “Chart Type” button on the 
right-hand side of the window. 
You can also view the monthly average or the annual total hydropower 
generated by checking the corresponding box at the top of the window. From 
these options, we can see that hydropower generation peaks during the 
summer and varies from year to year. 


============================================================
PAGE 356
============================================================

 356 
 
Linking WEAP to LEAP 
October 2023 
 
 
WEAP Tutorial 
Monthly Average: 
 
Annual Total: 
 
5.   LEAP Model 
Now we will open the energy modeling program, LEAP, to see the current 
sources of energy for Big City.  Under the Area Menu, open the WEAP-
LEAP Tutorial and revert to version “Starting point for WEAP-LEAP 
Tutorial.” 


============================================================
PAGE 357
============================================================

Linking WEAP and LEAP 
 357 
Stockholm Environment Institute 
 
October 2023 
Open the “Analysis” view in LEAP, which can be found on the left-hand side 
of the window. This is similar to the “Data” view in WEAP. In the “Scenario” 
pull-down window toward the top, make sure the “REF: No WEAP Link” 
scenario is selected. 
In the Data tree under “Transformation” > “Electricity” > “Processes,” there 
are three processes that generate electricity: hydropower from the reservoir, 
the coal steam power plant, and energy imports. If you select the “Merit 
Order” tab, you can see that hydropower is dispatched first, followed by 
energy from coal. Any remaining shortfalls are made up with imports, which 
is last in the merit order. 
 
The energy production capacities for these plants are under the “Exogenous 
Capacity” tab.  


============================================================
PAGE 358
============================================================

 358 
 
Linking WEAP to LEAP 
October 2023 
 
 
WEAP Tutorial 
 
For each energy production process, the portion of maximum energy 
production that is available can be found under the “Maximum Availability” 
tab. In the “No WEAP Link” scenario, the maximum availability of the 
hydropower plant has been entered as 100%. LEAP is assuming that all water 
demand for hydropower will be met, as it has no information on the amount 
of water available for hydropower generation. 
 


============================================================
PAGE 359
============================================================

Scenario: Hydropower Generation from WEAP 
 359 
Stockholm Environment Institute 
 
October 2023 
6.   View LEAP Results 
Switch to the “Results” view, found under the “Analysis” button on the left-
hand side of the window. From the top pull-down window, select the variable 
“Transformation: Average Power Dispatched.”  
In 2014 (selected from the right dropdown menu or the bottom scroll bar), 
almost a third of all electricity produced comes from hydropower, running at 
its full rated capacity of 45 MW. This is unrealistic if there is insufficient water 
to satisfy the demand for electricity. 
 
Scenario: Hydropower Generation from WEAP 
In order to have a more realistic representation of hydropower, we will now 
link LEAP to WEAP, so that LEAP can read the hydropower results 
calculated by WEAP.  In this way, LEAP can determine how much electricity 
could, in reality, be generated from hydropower. 
7.   Create Scenario in WEAP 
In WEAP, choose the menu item Area, Manage Scenarios to create a new 
scenario under the “No LEAP Link” scenario, and name it “Hydro Gen from 
WEAP.”   


============================================================
PAGE 360
============================================================

 360 
 
Linking WEAP to LEAP 
October 2023 
 
 
WEAP Tutorial 
 
8.   Create Scenario in LEAP 
In LEAP, return to the Analysis View and click the “Scenarios” button (with 
a blue S icon) toward the top of the window. Add a scenario by clicking the 
green plus button in the upper left corner, and name the scenario “Hydro 
Gen from WEAP.” In the “Based on” pull-down window under the 
Inheritance tab, select “No WEAP Link.” This will ensure that the new 
scenario inherits the characteristics of the “No WEAP Link” scenario. Close 
the window. 
 


============================================================
PAGE 361
============================================================

Scenario: Hydropower Generation from WEAP 
 361 
Stockholm Environment Institute 
 
October 2023 
 
9.   Linking WEAP and LEAP 
In LEAP, go to the Analysis View and then, under the Advanced menu, select 
“Link to WEAP Water Model.” The window that pops up is the link manager. 
After checking the box in this window, you associate the LEAP area with the 
correct WEAP area. It is also where you match LEAP and WEAP scenarios 
and time steps. 
Check the “Link to WEAP water model” box at the top. Where it says <Select 
a WEAP Area >, choose “Tutorial.”  When first linked, LEAP or WEAP will 
attempt to match up the scenarios and timesteps from the two models if they 
have the same name.  The timesteps should all be automatically matched, as 
well as the “Hydro Gen from WEAP” scenarios.  The “No WEAP Link” and 
“No LEAP Link” scenarios will not link (their names are different), but this 
is correct—those two scenarios are not linked. You can click the Error Check 
button to double-check for any errors. Then, close the window. 


============================================================
PAGE 362
============================================================

 362 
 
Linking WEAP to LEAP 
October 2023 
 
 
WEAP Tutorial 
 
Now we shall follow the same steps for WEAP. In WEAP, under the 
Advanced menu, select “Link to LEAP Energy Model.” A window just like 
the LEAP link manager should pop up. Check the “Link to LEAP” box, and 
verify that the LEAP Area, scenarios and timesteps are linked correctly. Close 
the window. 


============================================================
PAGE 363
============================================================

Scenario: Hydropower Generation from WEAP 
 363 
Stockholm Environment Institute 
 
October 2023 
 
10.   
Time Slices 
In this example, the LEAP timeslices have already been set to monthly.  But 
when you create your own LEAP area, you will need to setup the timeslices 
to match those in the WEAP area to be linked (typically, monthly).  In the 
LEAP Analysis view, go to the “General” menu at the top of the window and 
select “Time Slices.” If this had been a new area, the default would be 8 
seasonal day and night time slices. To change this, click “Setup.” 
In the “Setup Time Slices” window that appears, choose “Detailed” and then 
OK.  


============================================================
PAGE 364
============================================================

 364 
 
Linking WEAP to LEAP 
October 2023 
 
 
WEAP Tutorial 
 
Change “Main slices” to “12 Months.” Make sure “Daily slices” is “Whole 
day” and “Weekly slices” is “Whole week.” To save these settings, click OK.  
However, because the time slices are already monthly, you can just click 
Cancel. 
 
11.   
Reading WEAP Result into LEAP 
In 
the 
LEAP 
“Analysis” 
view, 
open 
the 
Data 
tree 
to 
“Transformation”>“Electricity”>“Processes.” Making sure that the new 
“Hydro Gen From WEAP” scenario is selected, choose the “Maximum 
Availability” tab. Select the Reservoir with Hydro branch and click on the 
Expression Builder tab (shown with an orange E) further down on the screen.  
Use the “Branch/Variable” button below the Expressions Builder tab to 
enter branches from WEAP: 


============================================================
PAGE 365
============================================================

Scenario: Hydropower Generation from WEAP 
 365 
Stockholm Environment Institute 
 
October 2023 
 
Choose the “Reservoir with Hydropower” branch and click Next. 
 
Select the “Hydropower Generation” result variable (you may need to scroll 
down) and click Finish.  You might need to change the unit of “Hydropower 
Generation” from GJ to MW by specifying in the expression, as shown below. 
Fill in the rest of the expression: put 100*Min(1,  before the WEAPValue 
function and )/Exogenous Capacity[MW]) after it.  The completed expression 
should be:  
100*Min(1,WEAPValue(Supply and Resources\River\Green 
River\Reservoirs\Reservoir with Hydropower:Hydropower 
Generation[MW])/Exogenous Capacity[MW]) 
Click the “Submit” button at the top left corner of the Expression Builder. 


============================================================
PAGE 366
============================================================

 366 
 
Linking WEAP to LEAP 
October 2023 
 
 
WEAP Tutorial 
 
Note that you can also type this in. Spaces in names must be included for WEAP 
and LEAP to recognize the expression. 
The WEAPValue function tells LEAP to look at data or results calculated by 
WEAP.  
Run results in both WEAP and LEAP and then return to this Reservoir with 
Hydropower equation. The graph in the Chart tab below the expressions 
shows that the hydropower maximum availability in 2011 and 2014, as 
calculated by WEAP, is actually much lower than 100%. This restricts the 
amount of electricity LEAP can dispatch from hydropower.   


============================================================
PAGE 367
============================================================

Scenario: Hydropower Generation from WEAP 
 367 
Stockholm Environment Institute 
 
October 2023 
 
12.   
View LEAP Results 
To see how hydropower results from WEAP affects the LEAP electricity 
dispatch, switch to the “Results” view. Now that WEAP and LEAP are linked 
and depend upon each other’s results, they will each need to make sure that 
the other’s results are up to date.  In the LEAP confirmation dialog to run 
calculations, it notes that WEAP also needs to calculate and gives you the 
option to do that too. 
 
 
In this initial version of the linked WEAP-LEAP modeling system, the flow of calculations is 
not fully automatic. In models which have links in both directions, the user is responsible 
for running the models several times until the system converges, or recognizing the cases 
where the results diverge or oscillate between two or more different states. We hope to 
automate this process in future versions. 
Note: Your results for this tutorial may not exactly match those shown here, depending on 
how many times you iterate the calculations in LEAP and WEAP. 


============================================================
PAGE 368
============================================================

 368 
 
Linking WEAP to LEAP 
October 2023 
 
 
WEAP Tutorial 
Select the “Transformation: Average Power Dispatched” variable from the 
pull-down window under the Chart tab. Select the “Hydro Gen from WEAP” 
scenario from the “Scenario” pull-down window under that. Using the pull-
down windows at the right and bottom of the window, select “All Branches” 
for the vertical axis of the chart, and “All Time Slices” for the horizontal axis. 
 
As we can see from the chart, there is much less hydropower and much more 
coal steam in this scenario due to the restriction given by WEAP. 
We can verify that the outputs generated by WEAP indeed match the inputs 
to LEAP. Switching to the Table tab in the LEAP “Results” view, note that 
for January 2014, the amount of hydropower generated by the reservoir is 
6.55 MW. Note that you may have to change the decimal display by clicking 
the button on the right. The units can be changed by clicking the vertical 
Megawatts tab on the left. 


============================================================
PAGE 369
============================================================

Scenario: Hydropower Generation from WEAP 
 369 
Stockholm Environment Institute 
 
October 2023 
 
In WEAP, under the Table tab of the “Results” view, the value for January 
2014 is also 6.55 MW (make sure the units displayed are MW by using the 
dropdown menu in the upper right). 
 


============================================================
PAGE 370
============================================================

 370 
 
Linking WEAP to LEAP 
October 2023 
 
 
WEAP Tutorial 
Scenario: Demand for Cooling Water from LEAP 
As mentioned before, the coal power plant downstream from the city uses 
cooling water in its electricity generation process. The demand for water from 
the coal plant is determined by how much electricity it generates in LEAP. 
13.   
Create Scenario 
Create a new scenario in both WEAP and LEAP named “Cooling Water 
Demand from LEAP.” The new scenario should inherit the properties of the 
“Hydro Gen from WEAP” scenario. Check the link manager to ensure that 
these new scenarios are linked to each other (“Advanced”>“Link to WEAP” 
or “Link to LEAP” depending on whether you are in LEAP or WEAP). 
14.   
Enter Water Use in WEAP 
In the WEAP “Data” view, go to the Key Assumption for Cooling Water 
Requirements per MHW \ Coal Steam on the Data tree, and enter 25000 gal 
(make sure the “Cooling Water Demand from LEAP” scenario is selected): 
 
Select Demand Sites \ Coal Power Plant on the tree.  On the “Monthly 
Demand” tab under “Water Use,” enter the following LEAP function: 


============================================================
PAGE 371
============================================================

Scenario: Demand for Cooling Water from LEAP 
 371 
Stockholm Environment Institute 
 
October 2023 
LEAPValue(Transformation\Electricity\Processes\Coal Steam:Average Power 
Dispatched[MW]) * Days * 24 * Key\Cooling Water Requirements per 
MWH\Coal Steam[m^3] 
Note: 
You may use the “LEAP Branches” tab on WEAP’s Expression Builder to help 
build the LEAPValue part of the expression.  If you do, you will need to change the 
unit from Kilowatt to MW: 
 
Multiplying by Days * 24 converts power (MW) to energy (Megawatt-hours); 
multiplying by the water requirement per MWH gives the volume of water 
needed by the coal power plant to function.  
The chart shows the variation in cooling water demand, depending on how 
much electricity is generated by the coal power plant. 


============================================================
PAGE 372
============================================================

 372 
 
Linking WEAP to LEAP 
October 2023 
 
 
WEAP Tutorial 
  
Note: If LEAP has not yet calculated this scenario, you will not see any results 
here. 
15.   
View WEAP Results 
In the “Results” view, select the “Reservoir Storage Volume and Zones” 
variable 
in 
the 
top 
pull-down 
window 
(“Supply 
and 
Resources”>“Reservoir”>“Storage Volume and Zones”). The graph shows 
the storage volume (red) against the different reservoir zones. Look at it first 
for Hydro Gen from WEAP for all years. 


============================================================
PAGE 373
============================================================

Scenario: Demand for Cooling Water from LEAP 
 373 
Stockholm Environment Institute 
 
October 2023 
 
Change the scenario to “Cooling water demand from WEAP.” Now we can 
see that the reservoir level dropping lower over time due to the new demand 
for cooling water. 
 
If we view the “Demand Site Coverage” variable (Demand>Coverage), we 
observe that demand coverage for the coal plant is less than 100% in several 
month. This means that there is not enough water to satisfy the coal plant’s 
demand. 


============================================================
PAGE 374
============================================================

 374 
 
Linking WEAP to LEAP 
October 2023 
 
 
WEAP Tutorial 
 
 
[Results vary] 
16.   
Enter WEAP Expression in LEAP 
We will now see how this WEAP restriction affects the results in LEAP. Go 
to the LEAP “Analysis” view and select the “Cooling Water Demand from 
LEAP” scenario from the pull-down window. Under the “Maximum 
Availability” tab, enter the following WEAP input expression for the Coal 
Steam branch: 
70 * WEAPValue(Demand Sites\Coal Power Plant:Coverage[%]) / 100 
This is the demand coverage for the coal power plant. The chart shows that, 
in months where the coverage is below 100%, the maximum availability will 
be less than 70%. 


============================================================
PAGE 375
============================================================

Scenario: Demand for Cooling Water from LEAP 
 375 
Stockholm Environment Institute 
 
October 2023 
 
17.   
View Results in LEAP 
Switching to the “Results” view, select the “Cooling Water Demand from 
LEAP” scenario. In 2014, there is insufficient water to satisfy the cooling 
water demand, which reduces the generating capacity of the coal plant. We 
can see that at times, imports (in red) are now required to make up for the 
lack in coverage by hydropower and coal steam. 
 


============================================================
PAGE 376
============================================================

 376 
 
Linking WEAP to LEAP 
October 2023 
 
 
WEAP Tutorial 
Scenario: Electricity Demand from WEAP 
The water sector uses electricity to treat, pump and transmit water. 
Depending on how much water is used and treated, the demand for electricity 
changes accordingly. 
18.   
Create Scenario in WEAP 
In WEAP, create a new scenario called “Electricity Demand from WEAP,” 
inheriting the characteristics of the “Cooling water demand from LEAP” 
scenario. Here we are going to focus on two demands for electricity by the 
water sector. 
The first is the transmission link from the river to the city. In the Data tree, 
open “Supply and Resources,” “Transmission Links” and “to City.” 
You will create two new user-defined variables, “Electricity per Cubic Meter” 
and “Total Electricity,” to model electricity used by water pumping and 
treatment.  Right click on an existing variable tab (e.g., Maximum Flow 
Volume) and choose “Create.”  
 
First, create a new category named “Electricity”—select < Add New Category> 
to add it. 


============================================================
PAGE 377
============================================================

Scenario: Electricity Demand from WEAP 
 377 
Stockholm Environment Institute 
 
October 2023 
 
Next, enter the following information and click Save: 
 
Once you have created the variable, enter data in the “Electricity Demand 
from WEAP” scenario for the energy needed for pumping and treatment to 
the City (1 kWh / cubic meter) and the Coal Power Plant (0.2 kWh / cubic meter).  
Tip: just click on the transmission link in the lower left map to jump to that 
branch in the tree. 


============================================================
PAGE 378
============================================================

 378 
 
Linking WEAP to LEAP 
October 2023 
 
 
WEAP Tutorial 
 
Create another variable named “Total Electricity”: 
 
Note: This variable will be a read-only calculated result--the default 
expression you enter (Electricity per Cubic Meter * PrevTSValue(Flow) ) will 
calculate the total electricity used by the transmission link in the previous 
timestep. Because this is the default expression, it will be used for all 
transmission links. 


============================================================
PAGE 379
============================================================

Scenario: Electricity Demand from WEAP 
 379 
Stockholm Environment Institute 
 
October 2023 
The second electricity demand in this model is from the Wastewater 
Treatment Plant.  Find this in the Data tree under “Water Quality” and 
“Wastewater Treatment.”  We will model it the same way as we did the 
transmission links.  Add two new user-defined variables: “Electricity per 
Cubic Meter” and “Total Electricity,” with the following definitions: 
 
 
The default expression for the read-only result variable Total Electricity is  


============================================================
PAGE 380
============================================================

 380 
 
Linking WEAP to LEAP 
October 2023 
 
 
WEAP Tutorial 
Electricity per Cubic Meter[kWh] * PrevTSValue(Wastewater Treatment Plant 
Total Inflow[m^3]) 
Enter data in the “Electricity per Cubic Meter,” in the “Electricity Demand 
from WEAP” scenario: 0.1 kWh / cubic meter.   
19.   
Add Key Assumption in WEAP 
These two electricity demands can be summed up in one key assumption. 
Add a new key assumption in the Data tree and name it “Electricity Use by 
Water Sector.” (Right click on the “Key Assumptions” branch and choose 
“Add,” and select Kilowatt-Hours for the unit.).  Enter the following 
expression in the Current Accounts: 
(Supply and Resources\Transmission Links:Total Electricity[kWh] + Water 
Quality\Wastewater Treatment:Total Electricity[kWh]) 
20.   
Create Scenario in LEAP 
Open the “Analysis” view in LEAP and create a scenario named “Electricity 
Demand from WEAP.”  Go to the Link to WEAP screen and link this 
scenario to the corresponding scenario in WEAP.  In the Data tree, go to 
branch Demand \ Water Sector. Enter this expression in “Final Energy 
Intensity Time Sliced” (make sure the “Electricity Demand from WEAP” 
scenario is selected): 
WEAPValue(Key\Electricity Use by Water Sector[kWh]) 
  


============================================================
PAGE 381
============================================================

Scenario: Electricity Demand from WEAP 
 381 
Stockholm Environment Institute 
 
October 2023 
You will need to run calculations before you can see these results in the Data 
View. 
21.   
View Results and Compare Scenarios 
In the “Results” view of LEAP, you can compare the energy demand across 
scenarios. Choose the “Energy Demand Final Units” variable from the top 
pull-down window, and “All Scenarios” for the legend. The “Electricity 
Demand from WEAP” scenario should show a variation in demand, while 
the other scenarios show straight lines because they do not take into account 
the changing electricity demand from the water sector. You may have to click 
the Y0 icon to the right to see the same view. 
 
In WEAP, look at the results for Reservoir storage by scenario. You may have 
to run them to or three times to see the following chart. Because of the 
electricity demand from WEAP, LEAP must dispatch the coal plant more, 
which increases the cooling water requirement, which further reduces the 
reservoir level.  Even in this simple example, you can see the complexity that 
can be modeled by linking WEAP and LEAP. 


============================================================
PAGE 382
============================================================

 382 
 
Linking WEAP to LEAP 
October 2023 
 
 
WEAP Tutorial 
        
